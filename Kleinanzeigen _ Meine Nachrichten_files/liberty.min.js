/*! For license information please see liberty.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.liberty=t():e.liberty=t()}(self,()=>(()=>{var e={79(e,t,r){var i=r(3702),n=r(80),s=r(4739),o=r(8655),a=r(1175);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},80(e,t,r){var i=r(6025),n=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=i(t,e);return!(r<0||(r==t.length-1?t.pop():n.call(t,r,1),--this.size,0))}},181(e){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},289(e,t,r){var i=r(2651);e.exports=function(e){return i(this,e).get(e)}},294(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},346(e){e.exports=function(e){return null!=e&&"object"==typeof e}},361(e){var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var i=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==i||"symbol"!=i&&t.test(e))&&e>-1&&e%1==0&&e<r}},392(e){e.exports=function(e,t){return null==e?void 0:e[t]}},659(e,t,r){var i=r(1873),n=Object.prototype,s=n.hasOwnProperty,o=n.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),r=e[a];try{e[a]=void 0;var i=!0}catch(e){}var n=o.call(e);return i&&(t?e[a]=r:delete e[a]),n}},695(e,t,r){var i=r(8096),n=r(2428),s=r(6449),o=r(3656),a=r(361),c=r(7167),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=s(e),d=!r&&n(e),u=!r&&!d&&o(e),g=!r&&!d&&!u&&c(e),f=r||d||u||g,h=f?i(e.length,String):[],p=h.length;for(var y in e)!t&&!l.call(e,y)||f&&("length"==y||u&&("offset"==y||"parent"==y)||g&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||a(y,p))||h.push(y);return h}},938(e){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},945(e,t,r){var i=r(79),n=r(8223),s=r(3661);e.exports=function(e,t){var r=this.__data__;if(r instanceof i){var o=r.__data__;if(!n||o.length<199)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new s(o)}return r.set(e,t),this.size=r.size,this}},999(e,t,r){var i=r(9302),n=r(6800);e.exports=function(e){return i(function(t,r){var i=-1,s=r.length,o=s>1?r[s-1]:void 0,a=s>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,a&&n(r[0],r[1],a)&&(o=s<3?void 0:o,s=1),t=Object(t);++i<s;){var c=r[i];c&&e(t,c,i,o)}return t})}},1033(e){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},1042(e,t,r){var i=r(6110)(Object,"create");e.exports=i},1175(e,t,r){var i=r(6025);e.exports=function(e,t){var r=this.__data__,n=i(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}},1331(e,t,r){var i=r(2552),n=r(8879),s=r(346),o=Function.prototype,a=Object.prototype,c=o.toString,l=a.hasOwnProperty,d=c.call(Object);e.exports=function(e){if(!s(e)||"[object Object]"!=i(e))return!1;var t=n(e);if(null===t)return!0;var r=l.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==d}},1420(e,t,r){var i=r(79);e.exports=function(){this.__data__=new i,this.size=0}},1549(e,t,r){var i=r(2032),n=r(3862),s=r(6721),o=r(2749),a=r(5749);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},1791(e,t,r){var i=r(6547),n=r(3360);e.exports=function(e,t,r,s){var o=!r;r||(r={});for(var a=-1,c=t.length;++a<c;){var l=t[a],d=s?s(r[l],e[l],l,r,e):void 0;void 0===d&&(d=e[l]),o?n(r,l,d):i(r,l,d)}return r}},1811(e){var t=Date.now;e.exports=function(e){var r=0,i=0;return function(){var n=t(),s=16-(n-i);if(i=n,s>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},1873(e,t,r){var i=r(9325).Symbol;e.exports=i},1882(e,t,r){var i=r(2552),n=r(3805);e.exports=function(e){if(!n(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},1961(e,t,r){var i=r(9653);e.exports=function(e,t){var r=t?i(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},2032(e,t,r){var i=r(1042);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},2428(e,t,r){var i=r(7534),n=r(346),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,c=i(function(){return arguments}())?i:function(e){return n(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},2552(e,t,r){var i=r(1873),n=r(659),s=r(9350),o=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?n(e):s(e)}},2651(e,t,r){var i=r(4218);e.exports=function(e,t){var r=e.__data__;return i(t)?r["string"==typeof t?"string":"hash"]:r.map}},2749(e,t,r){var i=r(1042),n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:n.call(t,e)}},2824(e,t,r){var i=r(7805),n=r(3290),s=r(1961),o=r(3007),a=r(5529),c=r(2428),l=r(6449),d=r(3693),u=r(3656),g=r(1882),f=r(3805),h=r(1331),p=r(7167),y=r(4974),v=r(9884);e.exports=function(e,t,r,m,b,w,A){var R=y(e,r),S=y(t,r),E=A.get(S);if(E)i(e,r,E);else{var T=w?w(R,S,r+"",e,t,A):void 0,k=void 0===T;if(k){var I=l(S),_=!I&&u(S),O=!I&&!_&&p(S);T=S,I||_||O?l(R)?T=R:d(R)?T=o(R):_?(k=!1,T=n(S,!0)):O?(k=!1,T=s(S,!0)):T=[]:h(S)||c(S)?(T=R,c(R)?T=v(R):f(R)&&!g(R)||(T=a(S))):k=!1}k&&(A.set(S,T),b(T,S,m,w,A),A.delete(S)),i(e,r,T)}}},2865(e,t,r){var i=r(9570),n=r(1811)(i);e.exports=n},2903(e,t,r){var i=r(3805),n=r(5527),s=r(181),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return s(e);var t=n(e),r=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&r.push(a);return r}},2949(e,t,r){var i=r(2651);e.exports=function(e,t){var r=i(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}},3007(e){e.exports=function(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}},3040(e,t,r){var i=r(1549),n=r(79),s=r(8223);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(s||n),string:new i}}},3221(e){e.exports=function(e){return function(t,r,i){for(var n=-1,s=Object(t),o=i(t),a=o.length;a--;){var c=o[e?a:++n];if(!1===r(s[c],c,s))break}return t}}},3243(e,t,r){var i=r(6110),n=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=n},3290(e,t,r){e=r.nmd(e);var i=r(9325),n=t&&!t.nodeType&&t,s=n&&e&&!e.nodeType&&e,o=s&&s.exports===n?i.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,i=a?a(r):new e.constructor(r);return e.copy(i),i}},3360(e,t,r){var i=r(3243);e.exports=function(e,t,r){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},3488(e){e.exports=function(e){return e}},3605(e){e.exports=function(e){return this.__data__.get(e)}},3656(e,t,r){e=r.nmd(e);var i=r(9325),n=r(9935),s=t&&!t.nodeType&&t,o=s&&e&&!e.nodeType&&e,a=o&&o.exports===s?i.Buffer:void 0,c=(a?a.isBuffer:void 0)||n;e.exports=c},3661(e,t,r){var i=r(3040),n=r(7670),s=r(289),o=r(4509),a=r(2949);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}c.prototype.clear=i,c.prototype.delete=n,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},3693(e,t,r){var i=r(4894),n=r(346);e.exports=function(e){return n(e)&&i(e)}},3702(e){e.exports=function(){this.__data__=[],this.size=0}},3805(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},3862(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},4218(e){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},4335(e){e.exports=function(e,t){return function(r){return e(t(r))}}},4509(e,t,r){var i=r(2651);e.exports=function(e){return i(this,e).has(e)}},4739(e,t,r){var i=r(6025);e.exports=function(e){var t=this.__data__,r=i(t,e);return r<0?void 0:t[r][1]}},4840(e,t,r){var i="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=i},4894(e,t,r){var i=r(1882),n=r(294);e.exports=function(e){return null!=e&&n(e.length)&&!i(e)}},4901(e,t,r){var i=r(2552),n=r(294),s=r(346),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return s(e)&&n(e.length)&&!!o[i(e)]}},4974(e){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},5083(e,t,r){var i=r(1882),n=r(7296),s=r(3805),o=r(7473),a=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,d=c.toString,u=l.hasOwnProperty,g=RegExp("^"+d.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!s(e)||n(e))&&(i(e)?g:a).test(o(e))}},5250(e,t,r){var i=r(7217),n=r(7805),s=r(6649),o=r(2824),a=r(3805),c=r(7241),l=r(4974);e.exports=function e(t,r,d,u,g){t!==r&&s(r,function(s,c){if(g||(g=new i),a(s))o(t,r,c,d,e,u,g);else{var f=u?u(l(t,c),s,c+"",t,r,g):void 0;void 0===f&&(f=s),n(t,c,f)}},c)}},5288(e){e.exports=function(e,t){return e===t||e!=e&&t!=t}},5481(e,t,r){var i=r(9325)["__core-js_shared__"];e.exports=i},5527(e){var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},5529(e,t,r){var i=r(9344),n=r(8879),s=r(5527);e.exports=function(e){return"function"!=typeof e.constructor||s(e)?{}:i(n(e))}},5749(e,t,r){var i=r(1042);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},6009(e,t,r){e=r.nmd(e);var i=r(4840),n=t&&!t.nodeType&&t,s=n&&e&&!e.nodeType&&e,o=s&&s.exports===n&&i.process,a=function(){try{return s&&s.require&&s.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a},6025(e,t,r){var i=r(5288);e.exports=function(e,t){for(var r=e.length;r--;)if(i(e[r][0],t))return r;return-1}},6110(e,t,r){var i=r(5083),n=r(392);e.exports=function(e,t){var r=n(e,t);return i(r)?r:void 0}},6449(e){var t=Array.isArray;e.exports=t},6547(e,t,r){var i=r(3360),n=r(5288),s=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var o=e[t];s.call(e,t)&&n(o,r)&&(void 0!==r||t in e)||i(e,t,r)}},6649(e,t,r){var i=r(3221)();e.exports=i},6721(e,t,r){var i=r(1042),n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return n.call(t,e)?t[e]:void 0}},6757(e,t,r){var i=r(1033),n=Math.max;e.exports=function(e,t,r){return t=n(void 0===t?e.length-1:t,0),function(){for(var s=arguments,o=-1,a=n(s.length-t,0),c=Array(a);++o<a;)c[o]=s[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=s[o];return l[t]=r(c),i(e,this,l)}}},6800(e,t,r){var i=r(5288),n=r(4894),s=r(361),o=r(3805);e.exports=function(e,t,r){if(!o(r))return!1;var a=typeof t;return!!("number"==a?n(r)&&s(t,r.length):"string"==a&&t in r)&&i(r[t],e)}},6924(e,t,r){var i=r(5250),n=r(999)(function(e,t,r,n){i(e,t,r,n)});e.exports=n},7167(e,t,r){var i=r(4901),n=r(7301),s=r(6009),o=s&&s.isTypedArray,a=o?n(o):i;e.exports=a},7217(e,t,r){var i=r(79),n=r(1420),s=r(938),o=r(3605),a=r(9817),c=r(945);function l(e){var t=this.__data__=new i(e);this.size=t.size}l.prototype.clear=n,l.prototype.delete=s,l.prototype.get=o,l.prototype.has=a,l.prototype.set=c,e.exports=l},7241(e,t,r){var i=r(695),n=r(2903),s=r(4894);e.exports=function(e){return s(e)?i(e,!0):n(e)}},7296(e,t,r){var i,n=r(5481),s=(i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!s&&s in e}},7301(e){e.exports=function(e){return function(t){return e(t)}}},7334(e){e.exports=function(e){return function(){return e}}},7473(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},7534(e,t,r){var i=r(2552),n=r(346);e.exports=function(e){return n(e)&&"[object Arguments]"==i(e)}},7670(e,t,r){var i=r(2651);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},7805(e,t,r){var i=r(3360),n=r(5288);e.exports=function(e,t,r){(void 0!==r&&!n(e[t],r)||void 0===r&&!(t in e))&&i(e,t,r)}},7828(e,t,r){var i=r(9325).Uint8Array;e.exports=i},8096(e){e.exports=function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}},8223(e,t,r){var i=r(6110)(r(9325),"Map");e.exports=i},8630(e,t,r){var i;!function(e){!function(){var t="object"==typeof globalThis?globalThis:"object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),i=n(e);function n(e,t){return function(r,i){Object.defineProperty(e,r,{configurable:!0,writable:!0,value:i}),t&&t(r,i)}}void 0!==t.Reflect&&(i=n(t.Reflect,i)),function(e,t){var r=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,n=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!o&&!a,l={create:o?function(){return V(Object.create(null))}:a?function(){return V({__proto__:null})}:function(){return V({})},has:c?function(e,t){return r.call(e,t)}:function(e,t){return t in e},get:c?function(e,t){return r.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},d=Object.getPrototypeOf(Function),u="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var i=this._keys.length,n=r+1;n<i;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,D(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,i)},t.prototype.values=function(){return new r(this._keys,this._values,n)},t.prototype.entries=function(){return new r(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!D(this._cacheKey,e)){this._cacheIndex=-1;for(var r=0;r<this._keys.length;r++)if(D(this._keys[r],e)){this._cacheIndex=r;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function n(e,t){return t}function o(e,t){return[e,t]}}(),g="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function e(){this._map=new u}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}(),f="function"==typeof WeakMap?WeakMap:function(){var e=l.create(),t=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=n(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=n(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return n(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=n(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var t;do{t="@@WeakMap@@"+o()}while(l.has(e,t));return e[t]=!0,t}function n(e,i){if(!r.call(e,t)){if(!i)return;Object.defineProperty(e,t,{value:l.create()})}return e[t]}function s(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function o(){var e=function(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):s(t,e),t}return s(new Array(e),e)}(16);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var t="",r=0;r<16;++r){var i=e[r];4!==r&&6!==r&&8!==r||(t+="-"),i<16&&(t+="0"),t+=i.toString(16).toLowerCase()}return t}}(),h=i?Symbol.for("@reflect-metadata:registry"):void 0,p=function(){var e;return!T(h)&&I(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[h]),T(e)&&(e=function(){var e,r,i,n;T(h)||void 0===t.Reflect||h in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=function(e){var t=e.defineMetadata,r=e.hasOwnMetadata,i=e.getOwnMetadata,n=e.getOwnMetadataKeys,s=e.deleteMetadata,o=new f;return{isProviderFor:function(e,t){var r=o.get(e);return!(T(r)||!r.has(t))||!!n(e,t).length&&(T(r)&&(r=new g,o.set(e,r)),r.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:n,OrdinaryDeleteMetadata:s}}(t.Reflect));var s=new f,o={registerProvider:a,getProvider:l,setProvider:p};return o;function a(t){if(!Object.isExtensible(o))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case T(r):r=t;break;case r===t:break;case T(i):i=t;break;case i===t:break;default:void 0===n&&(n=new g),n.add(t)}}function c(t,s){if(!T(r)){if(r.isProviderFor(t,s))return r;if(!T(i)){if(i.isProviderFor(t,s))return r;if(!T(n))for(var o=F(n);;){var a=B(o);if(!a)return;var c=N(a);if(c.isProviderFor(t,s))return M(o),c}}}if(!T(e)&&e.isProviderFor(t,s))return e}function l(e,t){var r,i=s.get(e);return T(i)||(r=i.get(t)),T(r)?(T(r=c(e,t))||(T(i)&&(i=new u,s.set(e,i)),i.set(t,r)),r):r}function d(e){if(T(e))throw new TypeError;return r===e||i===e||!T(n)&&n.has(e)}function p(e,t,r){if(!d(r))throw new Error("Metadata provider not registered.");var i=l(e,t);if(i!==r){if(!T(i))return!1;var n=s.get(e);T(n)&&(n=new u,s.set(e,n)),n.set(t,r)}return!0}}()),!T(h)&&I(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,h,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}(),y=function(e){var t=new f,r={isProviderFor:function(e,r){var i=t.get(e);return!T(i)&&i.has(r)},OrdinaryDefineOwnMetadata:function(e,t,r,n){i(r,n,!0).set(e,t)},OrdinaryHasOwnMetadata:function(e,t,r){var n=i(t,r,!1);return!T(n)&&O(n.has(e))},OrdinaryGetOwnMetadata:function(e,t,r){var n=i(t,r,!1);if(!T(n))return n.get(e)},OrdinaryOwnMetadataKeys:function(e,t){var r=[],n=i(e,t,!1);if(T(n))return r;for(var s=F(n.keys()),o=0;;){var a=B(s);if(!a)return r.length=o,r;var c=N(a);try{r[o]=c}catch(e){try{M(s)}finally{throw e}}o++}},OrdinaryDeleteMetadata:function(e,r,n){var s=i(r,n,!1);if(T(s))return!1;if(!s.delete(e))return!1;if(0===s.size){var o=t.get(r);T(o)||(o.delete(n),0===o.size&&t.delete(o))}return!0}};return p.registerProvider(r),r;function i(i,n,s){var o=t.get(i),a=!1;if(T(o)){if(!s)return;o=new u,t.set(i,o),a=!0}var c=o.get(n);if(T(c)){if(!s)return;if(c=new u,o.set(n,c),!e.setProvider(i,n,r))throw o.delete(n),a&&t.delete(i),new Error("Wrong provider for target.")}return c}}(p);function v(e,t,r){if(m(e,t,r))return!0;var i=z(t);return!k(i)&&v(e,i,r)}function m(e,t,r){var i=G(t,r,!1);return!T(i)&&O(i.OrdinaryHasOwnMetadata(e,t,r))}function b(e,t,r){if(m(e,t,r))return w(e,t,r);var i=z(t);return k(i)?void 0:b(e,i,r)}function w(e,t,r){var i=G(t,r,!1);if(!T(i))return i.OrdinaryGetOwnMetadata(e,t,r)}function A(e,t,r,i){G(r,i,!0).OrdinaryDefineOwnMetadata(e,t,r,i)}function R(e,t){var r=S(e,t),i=z(e);if(null===i)return r;var n=R(i,t);if(n.length<=0)return r;if(r.length<=0)return n;for(var s=new g,o=[],a=0,c=r;a<c.length;a++){var l=c[a];s.has(l)||(s.add(l),o.push(l))}for(var d=0,u=n;d<u.length;d++)l=u[d],s.has(l)||(s.add(l),o.push(l));return o}function S(e,t){var r=G(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function T(e){return void 0===e}function k(e){return null===e}function I(e){return"object"==typeof e?null!==e:"function"==typeof e}function _(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",i=x(e,n);if(void 0!==i){var s=i.call(e,r);if(I(s))throw new TypeError;return s}return function(e,t){if("string"===t){var r=e.toString;if(L(r)&&!I(n=r.call(e)))return n;if(L(i=e.valueOf)&&!I(n=i.call(e)))return n}else{var i;if(L(i=e.valueOf)&&!I(n=i.call(e)))return n;var n,s=e.toString;if(L(s)&&!I(n=s.call(e)))return n}throw new TypeError}(e,"default"===r?"number":r)}function O(e){return!!e}function C(e){var t=_(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function P(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function L(e){return"function"==typeof e}function j(e){return"function"==typeof e}function D(e,t){return e===t||e!=e&&t!=t}function x(e,t){var r=e[t];if(null!=r){if(!L(r))throw new TypeError;return r}}function F(e){var t=x(e,s);if(!L(t))throw new TypeError;var r=t.call(e);if(!I(r))throw new TypeError;return r}function N(e){return e.value}function B(e){var t=e.next();return!t.done&&t}function M(e){var t=e.return;t&&t.call(e)}function z(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===d)return t;if(t!==d)return t;var r=e.prototype,i=r&&Object.getPrototypeOf(r);if(null==i||i===Object.prototype)return t;var n=i.constructor;return"function"!=typeof n||n===e?t:n}function G(e,t,r){var i=p.getProvider(e,t);if(!T(i))return i;if(r){if(p.setProvider(e,t,y))return y;throw new Error("Illegal state.")}}function V(e){return e.__=void 0,delete e.__,e}e("decorate",function(e,t,r,i){if(T(r)){if(!P(e))throw new TypeError;if(!j(t))throw new TypeError;return function(e,t){for(var r=e.length-1;r>=0;--r){var i=(0,e[r])(t);if(!T(i)&&!k(i)){if(!j(i))throw new TypeError;t=i}}return t}(e,t)}if(!P(e))throw new TypeError;if(!I(t))throw new TypeError;if(!I(i)&&!T(i)&&!k(i))throw new TypeError;return k(i)&&(i=void 0),function(e,t,r,i){for(var n=e.length-1;n>=0;--n){var s=(0,e[n])(t,r,i);if(!T(s)&&!k(s)){if(!I(s))throw new TypeError;i=s}}return i}(e,t,r=C(r),i)}),e("metadata",function(e,t){return function(r,i){if(!I(r))throw new TypeError;if(!T(i)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;A(e,t,r,i)}}),e("defineMetadata",function(e,t,r,i){if(!I(r))throw new TypeError;return T(i)||(i=C(i)),A(e,t,r,i)}),e("hasMetadata",function(e,t,r){if(!I(t))throw new TypeError;return T(r)||(r=C(r)),v(e,t,r)}),e("hasOwnMetadata",function(e,t,r){if(!I(t))throw new TypeError;return T(r)||(r=C(r)),m(e,t,r)}),e("getMetadata",function(e,t,r){if(!I(t))throw new TypeError;return T(r)||(r=C(r)),b(e,t,r)}),e("getOwnMetadata",function(e,t,r){if(!I(t))throw new TypeError;return T(r)||(r=C(r)),w(e,t,r)}),e("getMetadataKeys",function(e,t){if(!I(e))throw new TypeError;return T(t)||(t=C(t)),R(e,t)}),e("getOwnMetadataKeys",function(e,t){if(!I(e))throw new TypeError;return T(t)||(t=C(t)),S(e,t)}),e("deleteMetadata",function(e,t,r){if(!I(t))throw new TypeError;if(T(r)||(r=C(r)),!I(t))throw new TypeError;T(r)||(r=C(r));var i=G(t,r,!1);return!T(i)&&i.OrdinaryDeleteMetadata(e,t,r)})}(i,t),void 0===t.Reflect&&(t.Reflect=e)}()}(i||(i={}))},8655(e,t,r){var i=r(6025);e.exports=function(e){return i(this.__data__,e)>-1}},8879(e,t,r){var i=r(4335)(Object.getPrototypeOf,Object);e.exports=i},9302(e,t,r){var i=r(3488),n=r(6757),s=r(2865);e.exports=function(e,t){return s(n(e,t,i),e+"")}},9325(e,t,r){var i=r(4840),n="object"==typeof self&&self&&self.Object===Object&&self,s=i||n||Function("return this")();e.exports=s},9344(e,t,r){var i=r(3805),n=Object.create,s=function(){function e(){}return function(t){if(!i(t))return{};if(n)return n(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=s},9350(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},9570(e,t,r){var i=r(7334),n=r(3243),s=r(3488),o=n?function(e,t){return n(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:s;e.exports=o},9653(e,t,r){var i=r(7828);e.exports=function(e){var t=new e.constructor(e.byteLength);return new i(t).set(new i(e)),t}},9817(e){e.exports=function(e){return this.__data__.has(e)}},9884(e,t,r){var i=r(1791),n=r(7241);e.exports=function(e){return i(e,n(e))}},9935(e){e.exports=function(){return!1}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={id:i,loaded:!1,exports:{}};return e[i](s,s.exports,r),s.loaded=!0,s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var i={};return(()=>{"use strict";var e;r.r(i),r.d(i,{commandQueue:()=>cs,enableDebug:()=>as,version:()=>ls}),r(8630),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(e||(e={}));const t=e;var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)};function s(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}function l(e){return!!e.useClass}function d(e){return!!e.useFactory}var u=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,i=!1;return new Proxy({},this.createHandler(function(){return i||(t=e(r.wrap()),i=!0),t}))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach(function(r){t[r]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t[0]=e(),Reflect[r].apply(void 0,c(t))}}),t},e}();function g(e){return"string"==typeof e||"symbol"==typeof e}function f(e){return"object"==typeof e&&"token"in e&&"transform"in e}function h(e){return!!e.useToken}function p(e){return null!=e.useValue}const y=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(y),m=function(){this.scopedResolutions=new Map};var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(y),w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(y);const A=function(){this.preResolution=new b,this.postResolution=new w};var R=new Map,S=function(){function e(e){this.parent=e,this._registry=new v,this.interceptors=new A,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,r,i){var n;if(void 0===i&&(i={lifecycle:t.Transient}),this.ensureNotDisposed(),n=function(e){return l(e)||p(e)||h(e)||d(e)}(r)?r:{useClass:r},h(n))for(var s=[e],o=n;null!=o;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+c(s,[a]).join(" -> "));s.push(a);var u=this._registry.get(a);o=u&&h(u.provider)?u.provider:null}if((i.lifecycle===t.Singleton||i.lifecycle==t.ContainerScoped||i.lifecycle==t.ResolutionScoped)&&(p(n)||d(n)))throw new Error('Cannot use lifecycle "'+t[i.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:n,options:i}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),g(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,r){if(this.ensureNotDisposed(),g(e)){if(g(r))return this.register(e,{useToken:r},{lifecycle:t.Singleton});if(r)return this.register(e,{useClass:r},{lifecycle:t.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var i=e;return r&&!g(r)&&(i=r),this.register(e,{useClass:i},{lifecycle:t.Singleton})},e.prototype.resolve=function(e,t,r){void 0===t&&(t=new m),void 0===r&&(r=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&g(e)){if(r)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var n=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,n,"Single"),n}if(function(e){return"function"==typeof e||e instanceof u}(e))return n=this.construct(e,t),this.executePostResolutionInterceptor(e,n,"Single"),n;throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,i;if(this.interceptors.preResolution.has(e)){var n=[];try{for(var s=o(this.interceptors.preResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var c=a.value;"Once"!=c.options.frequency&&n.push(c),c.callback(e,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,n)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var i,n;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var a=o(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;"Once"!=l.options.frequency&&s.push(l),l.callback(e,t,r)}}catch(e){i={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,s)}},e.prototype.resolveRegistration=function(e,r){if(this.ensureNotDisposed(),e.options.lifecycle===t.ResolutionScoped&&r.scopedResolutions.has(e))return r.scopedResolutions.get(e);var i,n=e.options.lifecycle===t.Singleton,s=e.options.lifecycle===t.ContainerScoped,o=n||s;return i=p(e.provider)?e.provider.useValue:h(e.provider)?o?e.instance||(e.instance=this.resolve(e.provider.useToken,r)):this.resolve(e.provider.useToken,r):l(e.provider)?o?e.instance||(e.instance=this.construct(e.provider.useClass,r)):this.construct(e.provider.useClass,r):d(e.provider)?e.provider.useFactory(this):this.construct(e.provider,r),e.options.lifecycle===t.ResolutionScoped&&r.scopedResolutions.set(e,i),i},e.prototype.resolveAll=function(e,t,r){var i=this;void 0===t&&(t=new m),void 0===r&&(r=!1),this.ensureNotDisposed();var n=this.getAllRegistrations(e);if(!n&&g(e)){if(r)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),n){var s=n.map(function(e){return i.resolveRegistration(e,t)});return this.executePostResolutionInterceptor(e,s,"All"),s}var o=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,o,"All"),o},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var r=o(this._registry.entries()),i=r.next();!i.done;i=r.next()){var n=a(i.value,2),s=n[0],c=n[1];this._registry.setAll(s,c.filter(function(e){return!p(e.provider)}).map(function(e){return e.instance=void 0,e}))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var r,i;this.ensureNotDisposed();var n=new e(this);try{for(var s=o(this._registry.entries()),c=s.next();!c.done;c=s.next()){var l=a(c.value,2),d=l[0],u=l[1];u.some(function(e){return e.options.lifecycle===t.ContainerScoped})&&n._registry.setAll(d,u.map(function(e){return e.options.lifecycle===t.ContainerScoped?{provider:e.provider,options:e.options}:e}))}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return n},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.dispose=function(){return e=this,t=void 0,i=function(){var e;return function(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(t){var r=t.dispose();r&&e.push(r)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((i=i.apply(e,t||[])).next())});var e,t,r,i},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof u)return e.createProxy(function(e){return r.resolve(e,t)});var i,n=function(){var i=R.get(e);if(!i||0===i.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var n=i.map(r.resolveParams(t,e));return new(e.bind.apply(e,c([void 0],n)))}();return"function"!=typeof(i=n).dispose||i.dispose.length>0||this.disposables.add(n),n},e.prototype.resolveParams=function(e,t){var r=this;return function(i,n){var s,o,l,d;try{return"object"==typeof(d=i)&&"token"in d&&"multiple"in d?f(i)?i.multiple?(s=r.resolve(i.transform)).transform.apply(s,c([r.resolveAll(i.token,new m,i.isOptional)],i.transformArgs)):(o=r.resolve(i.transform)).transform.apply(o,c([r.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?r.resolveAll(i.token,new m,i.isOptional):r.resolve(i.token,e,i.isOptional):f(i)?(l=r.resolve(i.transform,e)).transform.apply(l,c([r.resolve(i.token,e)],i.transformArgs)):r.resolve(i,e)}catch(e){throw new Error(function(e,t,r){var i,n,s,o,l=a(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return i="Cannot inject the dependency "+(o=t,(null===(s=void 0===l?null:l)?"at position #"+o:'"'+s.split(",")[o].trim()+'" at position #'+o)+' of "')+e.name+'" constructor. Reason:',void 0===n&&(n="    "),c([i],r.message.split("\n").map(function(e){return n+e})).join("\n")}(t,n,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}(),E=new S;const T=function(e){return function(t){R.set(t,function(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata("injectionTokens",e)||{};return Object.keys(r).forEach(function(e){t[+e]=r[e]}),t}(t)),e&&e.token&&(Array.isArray(e.token)?e.token.forEach(function(e){E.register(e,t)}):E.register(e.token,t))}},k=function(){return function(e){T()(e),E.registerSingleton(e)}};if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");var I;!function(e){e.PROD="production",e.NONPROD="none",e.DEV="development"}(I||(I={}));let _=class{libertyJsLoggingApplicationKey="libertyjs";getVersion(){return this.requireEnvVar("49.15.1","PACKAGE_VERSION")}isProduction(){return this.requireEnvVar("production","LIBERTY_ENV")===I.PROD}getLoggingApplicationKey(){return this.libertyJsLoggingApplicationKey}getAdvertisingWebRendererUrl(){return this.requireEnvVar("https://www.kleinanzeigen.de/liberty/advertising-web-renderer/umd/advertisingWebRenderer.min.js","ADVERTISING_WEB_RENDERER_URL")}getReportingServiceBaseUrl(){return this.requireEnvVar("https://gateway.kleinanzeigen.de/liberty/reporting/liberty-metrics","REPORTING_SERVICE_BASE_URL")}getReportingExposurePercentage(){return parseInt(20,10)}requireEnvVar(e,t){if(""===e||void 0===e)throw new Error(`${t} not set`);return e}};_=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k()],_);const O=_;var C;!function(e){e.V1="v1",e.CONTROL="c",e.DEFAULT="d"}(C||(C={}));const P=new Map([["B",C.CONTROL],["C",C.V1]]);class L{constructor(e,t){this.context=e,this.queryString=t}isDebuggingEnabled(){return this.isQueryStringParamPresent()||this.isLocalStorageItemPresent()}isQueryStringParamPresent(){return"true"===this.getQuery(this.buildContext())}isLocalStorageItemPresent(){try{return"true"===window.localStorage.getItem(this.buildContext())}catch{return!1}}getQuery(e){const t=new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(this.queryString);return t?decodeURIComponent(t[1]):null}buildContext(){return`${this.context}_debug`}}const j={DEBUG:"#8bc34a",ERR:"#ff0000"};function D(){}class x{constructor(e,t,r){this.context=t,this.queryString=r,this.logLogger=this.getMethodOrNoop(e,"log"),this.errorLogger=this.getMethodOrNoop(e,"error"),this.isDebuggingEnabled=new L(t,r).isDebuggingEnabled()}isDebuggingEnabled;logLogger;errorLogger;debug(...e){this.isDebuggingEnabled&&this.log(this.logLogger,"DEBUG",...e)}error(...e){this.log(this.errorLogger,"ERR",...e)}log(e,t,...r){e(`%c${this.context}`,this.style(t),`${t}:`,...r)}getMethodOrNoop(e,t){if(!e||"object"!=typeof e)return D;const r=e[t];return"function"!=typeof r?D:r}style(e){return`display: inline-block; color: #fff; background: ${j[e]}; padding: 1px 4px; border-radius: 3px;`}}class F{trackJsInstance;constructor(e){this.trackJsInstance=this.createInstanceAndTrackUsage(e)}error(e){this.trackJsInstance.track(e)}createInstanceAndTrackUsage(e){const{trackJsErrorLoggerFactory:t,application:r,version:i,metadata:n}=e;if(!t)throw new Error("trackJsErrorLoggerFactory needs to be provided");return t.createLoggerInstance({application:r,version:i,metadata:n||[]})}}class N{constructor(e){this.options=e,this.window=window,this.console=console;const{trackJsErrorLoggerFactory:t,application:r}=this.options;if(this.consoleLogger=new x(this.console,r,this.getQueryString()),t)try{this.trackJsErrorLogger=new F(this.options)}catch(e){throw this.consoleLogger.error("TrackJS instantiation failed: ",e),e}else this.consoleLogger.debug("Remote error logging is disabled.")}window;console;consoleLogger;trackJsErrorLogger;debug(...e){this.consoleLogger.debug(...e)}error(e){if(!e)return;this.consoleLogger.error("[KA frontend-logging ConsoleLogger]",e);const t=this.getAsError(e);try{this.trackJsErrorLogger?.error(t)}catch(e){throw this.consoleLogger.error("Error logging failed: ",e),e}}getAsError(e){return e instanceof Error||"object"==typeof e&&null!==e?e:new Error(""+e)}getQueryString(){return this.window.location.search}}let B=class{env;customErrorLogger;kaLogger;constructor(e){this.env=e}init(e,t,r,i,n,s){if(this.customErrorLogger=s,t&&!r)throw new Error("TrackJs enabled but no trackJsErrorLoggerFactory given");this.kaLogger=new N({trackJsErrorLoggerFactory:t?r:void 0,application:this.env.getLoggingApplicationKey(),version:this.env.getVersion(),metadata:[{key:"hostApplicationName",value:e},{key:"libertyTrafficSplitGroup",value:i},{key:"adblock",value:n?"on":"off"}]})}debug(...e){if(!this.kaLogger)throw console.debug(e),new Error("Logger not yet initialized.");this.kaLogger?.debug(...e)}error(e){if(this.customErrorLogger&&this.customErrorLogger(e),!this.kaLogger)throw console.error(e),new Error("Logger not yet initialized.");this.kaLogger?.error(e)}};B=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[O])],B);const M=B;const z={features:{},adblockEnabled:!1,slots:[],activeLabsExperiments:{},prebid:{defaultTimeout:0,bidderSettings:{},config:{}},user:{hashedUserEmailByAlgorithm:{}}},G={lazy:!1};let V=class{logger;config;options;featureOptions;trackers;luckyNumber;constructor(e){this.logger=e}initialize(e,t,r,i=[],n){this.config=e,this.options=Object.assign({},z,t),this.trackers=i,this.featureOptions=r,this.luckyNumber=n}getOptions(){return this.requireValue(this.options,"store.options")}getFeatureOptions(){return this.requireValue(this.featureOptions,"store.options.features")}getUserOptions(){return this.getOptions().user}getClient(){return this.getOptions().client}getActiveExperiments(){return this.getOptions().activeLabsExperiments||{}}isAdblockerEnabled(){return this.getOptions().adblockEnabled}isConsentGiven(e){const t=this.config?.gdprConsentInterpretationFlags;return void 0!==t&&(t[e]??!1)}isFeatureEnabled(e){return!!this.getFeatureOptions()[e]}getIabCategoryIds(){return this.getConfig().iab2CategoryIds??[]}getLibertyExperiments(){return this.getConfig().experiments??[]}getLibertyExperimentByName(e){return this.getLibertyExperiments().find(t=>t.name===e)}getClickTrackingImprovementLabsVariant(){return function(e){const t=e.getExperimentVariant("clv_click_tracking_desk")??e.getExperimentVariant("clv_click_tracking_mweb");return t?P.get(t)??C.DEFAULT:C.DEFAULT}(this)}getExperimentVariant(e){const t=this.getOptions().activeLabsExperiments||{};if(Object.keys(t).includes(e))return t[e];this.logger.debug(`"${e}" is not an active experiment.`)}getPlatform(){return this.getConfig().platform}getTrackers(){return this.requireValue(this.trackers,"store.trackers")}getPageType(){return this.getConfig().pageType}getGroupName(){return this.getConfig().groupName}getQueries(){return this.getConfig().queries}getPageLevelSettings(e){const{pageLevelSettings:t}=this.getConfig(),r=t.find(t=>t.type===e);return void 0===r?{}:r.settings}getPrebidOptions(){return this.getOptions().prebid}getSlotSize(e){const{maxWidth:t,maxHeight:r}=this.getSlotOptionsByPositionName(e);if(t&&r)return{maxWidth:t,maxHeight:r}}getRefreshIntervalTime(){return this.getConfig().pageLevelSettings.map(e=>e.settings.refreshInterval).filter(e=>e)[0]}getSlotOptionsByPositionName(e){const t=(this.getOptions().slots||[]).find(t=>t.positionNameMatcher.test(e));return{...G,...t}}getSlotConfigs(){return this.getConfig().slots||[]}getTrackingFeature(){return this.getFeatureOptions().tracking}getFirstPartyRenderingFeature(){return this.getFeatureOptions().firstPartyRendering}getLuckyNumber(){return this.luckyNumber}getQuery(e){if(!Array.isArray(e)||0===e.length)throw Error("[Store] No advertisers given to Store#getQuery");const t=e[0].type;return this.getPageLevelSettings(t).query}getConfig(){return this.requireValue(this.config,"store.config")}requireValue(e,t){if(void 0===e)throw new Error(`Access to ${t} error. Store not yet initialized.`);return e}};V=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M])],V);const W=V;let U=class{window;set(e){this.window=e}get(){return void 0===this.window?window:this.window}};U=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k()],U);const q=U;let $=class{document;set(e){this.document=e}get(){return void 0===this.document?document:this.document}whenDomReady(){return new Promise(e=>{const t=this.get();"complete"!==t.readyState&&"interactive"!==t.readyState||e();const r=()=>{e(),E.resolve(q).get().removeEventListener("DOMContentLoaded",r)};E.resolve(q).get().addEventListener("DOMContentLoaded",r)})}};$=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k()],$);const K=$;var H;!function(e){e.AAX="aax",e.CLICK_TRACKING="clickTracking",e.CLICK_DETECTION_IMPROVEMENT_LABS_VARIANT="clickTrackingImprovementLabsVariant",e.USE_SMART_FLOOR_PRICE="useSmartFloorPrice",e.TRACKING="tracking",e.REFRESHMENT="refreshment"}(H||(H={}));const Q=H;let Y,J=class{logger;windowWrapper;constructor(e,t){this.logger=e,this.windowWrapper=t}start(e,t){void 0!==Y&&this.logger.debug("Refresh interval already running, did you forget stopping it first?"),this.logger.debug(`Start refresh interval of ${e}ms...`),Y=this.windowWrapper.get().setInterval(()=>{t()},e)}stop(){void 0!==Y&&(this.logger.debug("Stop refresh interval"),this.windowWrapper.get().clearInterval(Y),Y=void 0)}};J=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,q])],J);const Z=J;let X=class{store;intervalLoader;logger;constructor(e,t,r){this.store=e,this.intervalLoader=t,this.logger=r}enableRefreshing(e,t){const r=this.store.getRefreshIntervalTime();this.setupIntervalRefresh(r,e,t)}setupIntervalRefresh(e,t,r){this.intervalLoader.stop(),this.store.isFeatureEnabled(Q.REFRESHMENT)?e&&this.intervalLoader.start(e,()=>{const e=r.filter(e=>e.getRefreshCapability().isRefreshPossible());t.fill(e)}):this.logger.debug("Feature refreshment is disabled!")}};X=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,Z,M])],X);const ee=X;var te;!function(e){e.ADSENSE_WEB="adsense_web",e.AFFILIATESHUB_WEB="affiliateshub_web",e.DISPLAY_WEB="display_web",e.DISPLAY_WEB_PREBID="display_web_prebid",e.ADBLOCK_CRITEO_WEB="adblock_criteo_web",e.DISPLAY_WEB_AAX="display_web_aax",e.IGNITE_WEB="ignite_web",e.IGNITE_MWEB="ignite_mweb",e.DISPLAY_WEB_AMAZON="display_web_amazon",e.DISPLAY_WEB_UNIFIED_AUCTION="display_web_unified_auction",e.BING_WEB="bing_web",e.FIRST_PARTY_PLA="first_party_pla"}(te||(te={}));const re=te,ie=Object.values(te);var ne;!function(e){e.AD_BLOCKER_ACTIVE="adblockerActive",e.ADVERTISER_REQUESTS="advertiserRequests",e.ADVERTISER_CLICKS="advertiserClicks",e.DONE_TIME="doneTime",e.ADVERTISER_FILLS="advertiserFills",e.DURATION_FROM_FIRST_JS_TO_LIBERTY_INIT="durationFromFirstJsToLibertyInit",e.MISSING_QUERY="missingQuery",e.FILL_PREPARATION_COMPLETED="fillPreparationCompleted",e.INTERSTITIAL_EVENT="interstitialEvent",e.INTERSTITIAL_IMPRESSION="interstitialImpression"}(ne||(ne={}));const se=ne;var oe;let ae=oe=class{logger=E.resolve(M);observers;advertiserRequests;missingQuery;advertiserClicks;advertiserFills;adblockerActive;startTime;endTime;constructor(){this.observers=[],this.advertiserRequests=oe.initializeCounterByAdvertiserTypes(),this.missingQuery=oe.initializeCounterByAdvertiserTypes(),this.adblockerActive=0,this.advertiserClicks=[],this.advertiserFills=[],this.startTime=void 0,this.endTime=void 0,this.notifyObservers=this.notifyObservers.bind(this)}static initializeCounterByAdvertiserTypes(){return ie.reduce((e,t)=>(e[t]=0,e),{})}recordInterstitialEvent(e){const t=e.join("_");this.notifyObservers({type:se.INTERSTITIAL_EVENT,value:t})}recordInterstitialImpression(e){const t=0===e.length?"empty":e.join("_");this.notifyObservers({type:se.INTERSTITIAL_IMPRESSION,value:t})}incrementAdvertiserRequestMetric(e){this.validate(e.type),this.advertiserRequests[e.type]+=1,this.notifyObservers({type:se.ADVERTISER_REQUESTS,value:this.buildAdvertiserData(e)})}incrementMissingQuery(e){this.validate(e),this.missingQuery[e]+=1,this.notifyObservers({type:se.MISSING_QUERY,value:{advertiserType:e}})}incrementAdvertiserFillMetric(e,t){const r={...this.buildAdvertiserData(e),slotRefreshCount:e.slotRefreshCount,slotInitLoadingDuration:this.normalizeDuration(t?.slotInitLoadingDuration),slotHeaderBiddingLoadingDuration:this.normalizeDuration(t?.slotHeaderBiddingLoadingDuration),slotGamLoadingDuration:this.normalizeDuration(t?.slotGamLoadingDuration),slotLoadingDuration:this.normalizeDuration(t?.slotLoadingDuration),slotTotalLoadingDuration:this.normalizeDuration(t?.slotTotalLoadingDuration)};this.advertiserFills.push(r),this.notifyObservers({type:se.ADVERTISER_FILLS,value:r})}getAdvertiserFills(){return this.advertiserFills}incrementAdvertiserClickMetric(e){const t=this.buildAdvertiserData(e);this.advertiserClicks.push(t),this.notifyObservers({type:se.ADVERTISER_CLICKS,value:t})}recordExecutionStart(e){this.startTime=(new Date).getTime(),this.notifyObservers({type:se.DURATION_FROM_FIRST_JS_TO_LIBERTY_INIT,value:this.startTime-e})}recordExecutionEnd(){this.endTime=(new Date).getTime(),void 0!==this.startTime&&this.notifyObservers({type:se.DONE_TIME,value:this.endTime-this.startTime})}getAdvertiserClicks(){return this.advertiserClicks}setAdblockerActive(){this.adblockerActive=1,this.notifyObservers({type:se.AD_BLOCKER_ACTIVE,value:1})}sendFillPreparationsCompleted(){this.notifyObservers({type:se.FILL_PREPARATION_COMPLETED,value:null})}setAdblockerInactive(){this.adblockerActive=0,this.notifyObservers({type:se.AD_BLOCKER_ACTIVE,value:0})}getAdblockerActiveMetric(){return this.adblockerActive}getAdvertiserRequestsMetrics(){return this.advertiserRequests}getMissingQueryMetrics(){return this.missingQuery}onChange(e){this.observers.push(e)}buildAdvertiserData(e){return{adSettingId:e.adSettingId,adSettingName:e.adSettingName,advertiserType:e.type,positionName:e.positionName,positionId:e.positionId,positionTrackingCode:e.trackingCode,isBackfill:e.isBackfill}}notifyObservers(e){this.logger.debug("Publish event",e),this.observers.forEach(t=>{t(e)})}validate(e){if(void 0===this.advertiserRequests[e])throw new Error(`Unknown advertiser type '${e}'. Pick one of: ${ie}`)}normalizeDuration(e){return!e||e<0?0:e}};ae=oe=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[])],ae);const ce=ae;class le{clickDetector;enabled;metrics=E.resolve(ce);constructor(e,t){this.clickDetector=e,this.enabled=t}setupClickTracking(e){this.enabled&&e.onLoadDone(t=>{t.isFilled&&this.clickDetector.startDetectingClicks(e.containerId,()=>{this.metrics.incrementAdvertiserClickMetric(t.advertiser)})})}}class de{isMouseIn;keyPressedCount;clickDetectorListener;logger;constructor(e){this.isMouseIn=!1,this.keyPressedCount=0,this.logger=e}startDetectingClicks(e,t){this.clickDetectorListener=t;const r=document.getElementById(e);if(null===r){const t=new Error(`Container #${e} not found for click tracking.`);throw this.logger.error(t),t}this.setupOnVisibilityChangeEventListenerToDetectClicks(),this.setupMouseEnterAndLeaveEventsToEnableVisibilityChangeListener(r)}setupMouseEnterAndLeaveEventsToEnableVisibilityChangeListener(e){document.addEventListener("keydown",()=>{this.keyPressedCount+=1}),document.addEventListener("keyup",()=>{this.keyPressedCount-=1}),e.addEventListener("mouseenter",()=>{this.isMouseIn=!0}),e.addEventListener("mouseleave",()=>{this.isMouseIn=!1})}setupOnVisibilityChangeEventListenerToDetectClicks(){window.document.addEventListener("visibilitychange",()=>{this.isMouseIn&&document.hidden&&0===this.keyPressedCount&&this.triggerClick()}),window.addEventListener("beforeunload",()=>{this.isMouseIn&&0===this.keyPressedCount&&this.triggerClick()})}triggerClick(){this.clickDetectorListener&&this.clickDetectorListener()}}class ue{isMouseIn;keyPressedCount;clickDetectorListener;constructor(){this.isMouseIn=!1,this.keyPressedCount=0}startDetectingClicks(e,t){this.clickDetectorListener=t;const r=document.getElementById(e);if(null===r)throw new Error(`Container #${e} not found for click tracking.`);this.observeIframesAndRemoveListenersIfIframeIsRemoved(r),this.setupOnVisibilityChangeEventListenerToDetectClicks(),this.setupMouseEnterAndLeaveEventsToEnableVisibilityChangeListener(r)}observeIframesAndRemoveListenersIfIframeIsRemoved(e){const t=new MutationObserver(r=>{r.forEach(r=>{r.removedNodes.forEach(()=>{this.removeListeners(e),t.disconnect()})})});t.observe(e,{subtree:!1,childList:!0})}removeListeners(e){document.removeEventListener("keydown",this.handleKeydown,!1),document.removeEventListener("keyup",this.handleKeyup,!1),window.document.removeEventListener("visibilitychange",this.handleVisibilityChange,!1),e.removeEventListener("mouseenter",this.handleMouseEnter,!1),e.removeEventListener("mouseleave",this.handleMouseLeave,!1)}setupMouseEnterAndLeaveEventsToEnableVisibilityChangeListener(e){document.addEventListener("keydown",this.handleKeydown,!1),document.addEventListener("keyup",this.handleKeyup,!1),e.addEventListener("mouseenter",this.handleMouseEnter,!1),e.addEventListener("mouseleave",this.handleMouseLeave,!1)}handleKeydown=()=>{this.keyPressedCount+=1};handleKeyup=()=>{this.keyPressedCount-=1};handleMouseEnter=()=>{this.isMouseIn=!0};handleMouseLeave=()=>{this.isMouseIn=!1};handleVisibilityChange=()=>{this.isMouseIn&&document.hidden&&0===this.keyPressedCount&&this.triggerClick()};setupOnVisibilityChangeEventListenerToDetectClicks(){window.document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("beforeunload",()=>{this.isMouseIn&&!this.keyPressedCount&&this.triggerClick()})}triggerClick(){this.clickDetectorListener&&this.clickDetectorListener()}}var ge;!function(e){e.BROWSER_NAVIGATION_START="libertyPerformanceBrowserNavigationStart",e.SLOT_LOADING_START="slotLoadingStart",e.SLOT_BIDDING_ENDED="slotBiddingEnded",e.SLOT_RENDER_ENDED_EVENT="slotRenderEndedEvent",e.SLOT_LOADING_ENDED="slotLoadingEnded"}(ge||(ge={}));let fe=class{logger;windowWrapper;constructor(e,t){this.logger=e,this.windowWrapper=t}loadingAll(e){e.forEach(e=>{this.markSlot(ge.SLOT_LOADING_START,e.containerId)})}loading(e){return this.markSlot(ge.SLOT_LOADING_START,e)}biddingDone(e){return this.markSlot(ge.SLOT_BIDDING_ENDED,e)}renderingDone(e){return this.markSlot(ge.SLOT_RENDER_ENDED_EVENT,e)}loadingDone(e){return this.markSlot(ge.SLOT_LOADING_ENDED,e)}markSlot(e,t){try{this.getPerformance().mark(this.createSlotMarkName(e,t))}catch(e){this.logger.debug("Browser does not support performance measurement. Ignoring...",e)}}createSlotMarkName(e,t){return`${e}-${t}`}getPerformance(){return this.windowWrapper.get().performance}};fe=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,q])],fe);const he=fe;let pe=class{logger;libertyPerformanceMarker;constructor(e,t){this.logger=e,this.libertyPerformanceMarker=t}getPerformanceDurationList(e){if("function"==typeof this.libertyPerformanceMarker.getPerformance().measure)return{slotInitLoadingDuration:this.getDuration("slotInitLoading",ge.BROWSER_NAVIGATION_START,ge.SLOT_LOADING_START,e),slotHeaderBiddingLoadingDuration:this.getDuration("libertyHeaderBidding",ge.SLOT_LOADING_START,ge.SLOT_BIDDING_ENDED,e),slotGamLoadingDuration:this.getDuration("libertyGamLoading",ge.SLOT_BIDDING_ENDED,ge.SLOT_RENDER_ENDED_EVENT,e),slotGamFirstPartyDuration:this.getDuration("libertySlotThirdParty",ge.SLOT_RENDER_ENDED_EVENT,ge.SLOT_LOADING_ENDED,e),slotLoadingDuration:this.getDuration("libertySlotLoading",ge.SLOT_LOADING_START,ge.SLOT_LOADING_ENDED,e),slotTotalLoadingDuration:this.getDuration("libertyTotalSlotLoading",ge.BROWSER_NAVIGATION_START,ge.SLOT_LOADING_ENDED,e)};this.logger.debug("performance.measure is undefined! Browser does not support performance measurement. Ignoring...")}getDuration(e,t,r,i){try{const n=this.libertyPerformanceMarker.getPerformance().measure(e,this.getStartSlotPerformanceMark(t,i),this.getSlotPerformanceMark(r,i)).duration;return Math.round(n)}catch(e){return 0}}getStartSlotPerformanceMark(e,t){return e===ge.BROWSER_NAVIGATION_START?this.getNavigationStartMark():this.getSlotPerformanceMark(e,t)}getNavigationStartMark(){return this.libertyPerformanceMarker.getPerformance().getEntriesByName(ge.BROWSER_NAVIGATION_START).length>0?ge.BROWSER_NAVIGATION_START:void 0}getSlotPerformanceMark(e,t){return this.libertyPerformanceMarker.createSlotMarkName(e,t)}};pe=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,he])],pe);const ye=pe,ve="liberty-filled",me="liberty-unfilled";class be{isVisible(e){return!1!==e.checkVisibility?.()}setVisibility(e,t){t?(e.classList.remove(me),e.classList.add(ve)):(e.classList.add(me),e.classList.remove(ve))}cleanVisibility(e){e.classList.remove(me),e.classList.remove(ve)}}const we=[/^id$/,/^data-liberty-.*$/,/^class$/,/^tabindex$/,/^aria-hidden$/];class Ae{positionName;documentWrapper=E.resolve(K);htmlSlotVisibility=E.resolve(be);constructor(e){this.positionName=e}isPresentInDom(){return!!this.getDomElement()}isVisible(){const e=this.getDomElementOrThrow();return this.htmlSlotVisibility.isVisible(e)}setContainerId(e){this.checkTheValidityOfTheContainerId(e),this.getDomElementOrThrow().id=e}cleanContainer(){const e=this.getDomElementOrThrow(),t=e.attributes;for(let r=t.length-1;r>=0;r--){const i=t[r].name;!we.some(e=>e.test(i))&&e.removeAttribute(i)}}setVisibility(e){const t=this.domElementWithParent();this.htmlSlotVisibility.setVisibility(t,e)}cleanVisibility(){const e=this.domElementWithParent();this.htmlSlotVisibility.cleanVisibility(e)}getDomElementOrThrow(){const e=this.getDomElement();if(null===e)throw new Error(`DOM element ${this.domElementQuery()} does not exist`);return e}domElementWithParent(){const e=this.getDomElementOrThrow(),t=e.getAttribute("data-liberty-parent-selector");return t?this.getParentElementFor(e,t):e}getParentElementFor(e,t){const r=e.closest(t);if(!r)throw new Error(`Slot ${this.positionName}: No parent element found for "${t}"`);return r}getDomElement(){return this.documentWrapper.get().querySelector(this.domElementQuery())}checkTheValidityOfTheContainerId(e){const t=this.documentWrapper.get().getElementById(e);if(null!==t&&t!==this.getDomElement())throw new Error(`A DOM element with ID ${e} already exists. Make sure to use a non-existing ID.`);if(!/^[a-zA-Z_]/.test(e))throw new Error(`A DOM element with ID ${e} is not valid. Must start with a letter (a-z or A-Z) or an underscore (_)`)}domElementQuery(){return`[data-liberty-position-name="${this.positionName}"]`}}var Re;!function(e){e.AMAZON_PUBLISHER_SERVICES_NATIVE_TAG="aps",e.AMAZON_PUBLISHER_SERVICES_TAG="apstag",e.ADVERTISING_WEB_RENDERER="AdvertisingWebRenderer",e.PREBID="pbjs",e.GOOGLE_TAG="googletag",e.ADSENSE="_googCsa",e.CRITEO="Criteo",e.AAX="aax"}(Re||(Re={}));const Se=Re;let Ee=class{windowWrapper;constructor(e){this.windowWrapper=e}loadFromWindow({identifier:e,name:t}){const r=this.extractWindowElement(e);if(!r)throw new Error(`${t} with ID window.${e} is not present and thus could not be loaded.`);return r}extractWindowElement(e){return this.windowWrapper.get()[e]}};Ee=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[q])],Ee);const Te=Ee;let ke=class{windowLoader;constructor(e){this.windowLoader=e}load(){return this.windowLoader.loadFromWindow({identifier:Se.ADSENSE,name:"Adsense"})}};ke=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Te])],ke);const Ie=ke;class _e{advertisers;promisesByContainerId;constructor(e){this.advertisers=e,this.promisesByContainerId=this.initializePromisesByContainerId(e)}containsContainerId(e){return this.promisesByContainerId.has(e)}containsAdvertiserType(e){return this.advertisers.some(t=>t.type===e)}getAllContainerIds(){return Array.from(this.promisesByContainerId.keys())}getCurrentAdvertiser(e){const t=this.advertisers.find(t=>t.getContainerId()===e);if(void 0===t)throw new Error(`Advertiser for container ${e} not found to communicate fetch result.`);return t}markContainerAs(e,t,r={}){this.getPromiseOrThrow(e,`Container #${e} is not initialized for marking it as (un)filled.`).resolve({containerId:e,advertiser:this.getCurrentAdvertiser(e),filled:t,fillInformation:r})}markAllContainersAsUnfilled(e){e.forEach(e=>{this.markContainerAs(e,!1)})}reject(e){this.getPromiseOrThrow(e,`Container #${e} is not initialized for marking it as (un)filled.`).reject({containerId:e,advertiser:this.getCurrentAdvertiser(e),filled:!1,fillInformation:{}})}abortAll(){this.advertisers.forEach(e=>{this.markContainerAs(e.getContainerId(),!1)})}getPromises(){return[...this.promisesByContainerId.values()].map(e=>e.promise)}getPromiseOrThrow(e,t){const r=this.promisesByContainerId.get(e);if(void 0===r)throw new Error(t);return r}initializePromisesByContainerId(e){const t=new Map;return e.forEach(e=>{let r=null,i=null;const n={promise:new Promise((e,t)=>{r=e,i=t}),resolve:r,reject:i};t.set(e.getContainerId(),n)}),t}}class Oe{fetchAd(e){return this.fetchAds([e])[0]}fetchAds(e){if(!Array.isArray(e)||0===e.length)return[];const t=new _e(e);return this._fetch(e,t),t.getPromises()}_fetch(e,t){throw new Error("Not implemented")}}let Ce=class extends Oe{adsenseTagLoader;logger=E.resolve(M);environment=E.resolve(O);store=E.resolve(W);metrics=E.resolve(ce);constructor(e){super(),this.adsenseTagLoader=e}getAdvertiserType(){return re.ADSENSE_WEB}_fetch(e,t){if(!this.isValid(e))return void this.abortAll(t,e);const r=this.adsenseTagLoader.load(),i=this.getSortedAdvertisers(e),n=this.getAdvertiserConfigSettings(i);r("ads",{adtest:this.environment.isProduction()?"off":"on",...this.getPageLevelSettingsFromStore(i),adLoadedCallback:(e,r)=>{t.markContainerAs(e,r)},ivt:!1},n),this.logger.debug(`[AdsenseFetcher] Load ads for ${i.length} slot(s) of type ${i.map(e=>e.type)[0]}`)}getSortedAdvertisers(e){const t=[],r=e.map(e=>`#${e.getContainerId()}`).join(","),i=document.querySelectorAll(r);return Array.from(i).forEach(r=>{const i=e.find(e=>e.getContainerId()===r.id);i?t.push(i):this.logger.error(`[AdsenseFetcher] ${r.id} not found in advertisers list`)}),t}getAdvertiserConfigSettings=e=>e.map(e=>e.settings.width?e.settings:this.injectDomElementWidth(e));injectDomElementWidth(e){const t=document.getElementById(e.getContainerId()),r=t?.getBoundingClientRect().width;return void 0!==r?{...e.settings,width:r}:(this.logger.error(`[AdsenseFetcher] width not defined for slot ${e.getContainerId()}`),e.settings)}isValid(e){const t=this.store.getQuery(e);return!!t?.trim()}abortAll(e,t){e.abortAll(),t.forEach(e=>this.metrics.incrementMissingQuery(e.type));const r=t.map(e=>e.type);this.logger.error(`[Adsense] Abort due to missing query for advertiser types { ${r} }`)}getPageLevelSettingsFromStore(e){return this.store.getPageLevelSettings(e[0].type)}};Ce=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Ie])],Ce);const Pe=Ce;let Le=class{documentWrapper;constructor(e){this.documentWrapper=e}loadScriptOnce(e){if(this.isScriptTagInDocument(e))return;const t=this.documentWrapper.get().createElement("script");t.type="text/javascript",t.async=!0,t.src=e,this.documentWrapper.get().head.appendChild(t)}isScriptTagInDocument(e){return void 0!==Array.from(document.scripts).find(t=>t.src===e)}};Le=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[K])],Le);const je=Le;let De=class{windowWrapper;scriptLoader;constructor(e,t){this.windowWrapper=e,this.scriptLoader=t}load(){const e=this.initializeStub(),t=this.buildAaxEndpoint(e);return this.scriptLoader.loadScriptOnce(t),window[Se.AAX]}initializeStub(){this.windowWrapper.get()[Se.AAX]=this.windowWrapper.get()[Se.AAX]||{};const e=this.windowWrapper.get()[Se.AAX];return e.cmd=e.cmd||[],e.initTime=(new Date).getTime(),e.pubId="AAX255244",e.ver="1.2",e.hst=window.location.hostname,e}buildAaxEndpoint(e){return`https://c.aaxads.com/aax.js?pub=${e.pubId}&hst=${e.hst}&ver=${e.ver}`}};De=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[q,je])],De);const xe=De;let Fe=class{store;environment;scriptLoader;windowWrapper;constructor(e,t,r,i){this.store=e,this.environment=t,this.scriptLoader=r,this.windowWrapper=i}load(){const e=this.initializeStub(),t=this.getAdvertisingWebRendererUrl();return this.scriptLoader.loadScriptOnce(t),e}initializeStub(){this.windowWrapper.get()[Se.ADVERTISING_WEB_RENDERER]=this.windowWrapper.get()[Se.ADVERTISING_WEB_RENDERER]||{};const e=this.windowWrapper.get()[Se.ADVERTISING_WEB_RENDERER];return e.slotSettingsQueue=e.slotSettingsQueue||[],e}getAdvertisingWebRendererUrl(){const e=this.store.getFirstPartyRenderingFeature();return e?.advertisingWebRendererUrl?e.advertisingWebRendererUrl:this.environment.getAdvertisingWebRendererUrl()}};Fe=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,O,je,q])],Fe);const Ne=Fe;let Be=class{windowWrapper;logger;constructor(e,t){this.windowWrapper=e,this.logger=t}load(){return this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_NATIVE_TAG]||this.initAps(),this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_NATIVE_TAG]}initAps(){try{const e=((e="5080")=>{window._aps=window._aps||new Map,window._aps.has(e)||window._aps.set(e,{queue:[],store:new Map([["listeners",new Map]])});const t={accountID:e,record:function(e,t){return new Promise((r,i)=>{window._aps?.get(this.accountID)?.queue.push(new CustomEvent(e,{detail:{...t,resolve:r,reject:i}}))})},read:function(e){return this.record("bootstrap/store/willRead",{name:e}),window._aps?.get(this.accountID)?.store.get(e)},run:function(e,t){return window._aps?.get("_system")?.store?.get("listeners")?.has(e)?this.record(e,t):this.record("bootstrap/run/willDrop",{name:e,detail:t})},react:function(e,t){return window._aps?.get(this.accountID)?.store.get("listeners")?.set(e,t),this.record("bootstrap/react/didExecute",{name:e})}};return t.record("bootstrap/version/declare",{version:5}),t})();window.aps=e}catch(e){this.logger.error(`Could not initialize Amazon Publisher Services tag. ${e}`)}}};Be=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[q,M])],Be);const Me=Be;let ze=class{windowWrapper;logger;store;constructor(e,t,r){this.windowWrapper=e,this.logger=t,this.store=r}load(){return this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_TAG]||(this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_TAG]=this.buildProxy()),this.initTag(),this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_TAG]}buildProxy(){return{_Q:[],init:this.proxyToTag("init",e=>this.pushQueue("i",e)),fetchBids:this.proxyToTag("fetchBids",e=>this.pushQueue("f",e)),setDisplayBids:this.proxyToTag("setDisplayBids",e=>{this.logger.error("Amazon script apstag needs to be loaded first before calling setDisplayBids()")})}}pushQueue(e,t){this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_TAG]._Q?.push([e,t])}proxyToTag(e,t){return(...r)=>{const i=this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_TAG];void 0===i._Q||void 0!==i.bids?(0,i[e])(...r):t(r)}}initTag(){this.windowWrapper.get()[Se.AMAZON_PUBLISHER_SERVICES_TAG].init({pubID:"5080",adServer:"googletag"})}};ze=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[q,M,W])],ze);const Ge=ze;let Ve=class{windowLoader;constructor(e){this.windowLoader=e}load(){return this.windowLoader.loadFromWindow({identifier:Se.CRITEO,name:Se.CRITEO})}};Ve=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Te])],Ve);const We=Ve;let Ue=class{windowLoader;constructor(e){this.windowLoader=e}load(){return this.windowLoader.loadFromWindow({identifier:Se.GOOGLE_TAG,name:"Googletag"})}};Ue=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Te])],Ue);const qe=Ue;let $e=class{windowLoader;constructor(e){this.windowLoader=e}load(){return this.windowLoader.loadFromWindow({identifier:Se.PREBID,name:"Prebid"})}};$e=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Te])],$e);const Ke=$e;var He;!function(e){e[e.REV_4=4]="REV_4",e[e.REV_5=5]="REV_5",e[e.REV_6=6]="REV_6",e[e.REV_7=7]="REV_7",e[e.REV_8=8]="REV_8",e[e.REV_9=9]="REV_9",e[e.REV_10=10]="REV_10"}(He||(He={}));const Qe=He,Ye="prebid-update",Je="28379_virtual_staging_web",Ze="audex-libertyjs-update",Xe="BLN-24924-feed-cards",et="KAD-347-amz_aps_ads",tt="SPEX-1504-confiant",rt="klue-901-srp-extraction",it="katpf-876_web-verification",nt={[Ye]:Qe.REV_10,[Je]:Qe.REV_7,[Ze]:Qe.REV_6,[Xe]:Qe.REV_5,[rt]:Qe.REV_8,[it]:Qe.REV_9,[tt]:Qe.REV_4},st="liberty.ad.loaded",ot="adsense.auction.won";let at=class{decodeMessage(e){const t={};return e.split(",").forEach(e=>{const[r,i]=e.split(":");t[r]=i}),t}};at=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],at);const ct=at;let lt=class{windowMessageDecoder;constructor(e){this.windowMessageDecoder=e}addPostMessageEventListener(e){window.addEventListener("message",t=>{t&&t.data.event===st&&this.handleOnMessage(t,e)})}handleOnMessage(e,t){const r=this.windowMessageDecoder.decodeMessage(e.data.info),{adtype:i,status:n,containerId:s}=r;if(t.containsAdvertiserType(i)&&t.containsContainerId(s))if("success"!==n)if("error"!==n){if("failed"!==n)throw new Error(`Could not match message status { ${n} } to either { success }, { error }, or { failed }`);t.reject(s)}else t.markContainerAs(s,!1);else t.markContainerAs(s,!0)}};lt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[ct])],lt);const dt=lt;class ut extends Oe{advertisingWebRenderer;advertiserType;slotSettingsFactory;logger=E.resolve(M);store=E.resolve(W);advertisingWebRendererMessageHandler=E.resolve(dt);constructor(e,t,r){super(),this.advertisingWebRenderer=e,this.advertiserType=t,this.slotSettingsFactory=r}getAdvertiserType(){return this.advertiserType}_fetch(e,t){this.advertisingWebRendererMessageHandler.addPostMessageEventListener(t);const r=e.map(e=>this.slotSettingsFactory.createSlotSettings(e));this.logger.debug(`[${this.constructor.name}] Load '${this.getAdvertiserType()}' ads for ${r.length} slot(s)`,r),this.advertisingWebRenderer.slotSettingsQueue.push(...r)}}var gt;!function(e){e.GDPR_ADVERTISING_FULL_CONSENT="gdpr_advertising_full_consent",e.GDPR_THE_TRADE_DESK_EUID_ALLOWED="gdpr_the_trade_desk_euid_allowed"}(gt||(gt={}));class ft{store=E.resolve(W);createSlotSettings(e){const{container:t,...r}=e.settings;return{adType:e.type,slotTrackingCode:e.trackingCode,isBackfill:e.isBackfill,scene:this.createSceneSetting(),containerId:t,...r}}createSceneSetting(){return{consentGdpr:this.store.isConsentGiven(gt.GDPR_ADVERTISING_FULL_CONSENT)?"FULL":"NONE",platform:this.store.getPlatform(),pageType:this.store.getPageType(),groupName:this.store.getGroupName(),activeExperiments:this.store.getActiveExperiments(),queries:this.store.getQueries()}}}const ht="_";class pt{key;values;constructor(e,t){this.key=e,this.values=t.map(e=>this.sanitize(e))}asTag(){return[this.sanitize(this.key),...this.values].join(ht)}asKeyValue(){return{key:this.key,value:this.values.join(ht)}}sanitize(e){return e.replace(new RegExp(ht,"g"),"-")}}class yt{static isDefined(e){return null!=e}}class vt{igniteTrackingInformation;constructor(e){this.igniteTrackingInformation=e}getIgniteTrackingInformation(){return this.igniteTrackingInformation}}let mt=class{create(e){const t=e.map(e=>e.icasTracking()).filter(yt.isDefined);return new vt(t)}};mt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],mt);const bt=mt;let wt=class{store;trackingAdTypeInformationFactory;constructor(e,t){this.store=e,this.trackingAdTypeInformationFactory=t}createTrackingTags(e){const t=this.getSlotCodeTrackingInformation(e),r=[...this.getIgniteTrackingInformation(this.store.getTrackers()),t];return this.getDistinctExperimentTags(this.convertToIcasExperimentTags(r))}getDistinctExperimentTags(e){return[...new Set(e)]}getIgniteTrackingInformation(e){return this.trackingAdTypeInformationFactory.create(e).getIgniteTrackingInformation()}getSlotCodeTrackingInformation(e){return new pt("stc",[e.trackingCode])}convertToIcasExperimentTags(e){return e.map(e=>e.asTag())}};wt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,bt])],wt);const At=wt;class Rt{awrSlotSettingsFactory=E.resolve(ft);icasTrackingTagsFactory=E.resolve(At);createSlotSettings(e){const{icasExperimentTags:t}=e.settings,r=this.icasTrackingTagsFactory.createTrackingTags(e),i=t?[...t,...r]:r;return{...this.awrSlotSettingsFactory.createSlotSettings(e),icasExperimentTags:i}}}class St extends Oe{awrFetcher;constructor(e,t){super(),this.awrFetcher=new ut(e,t,new Rt)}getAdvertiserType(){return this.awrFetcher.getAdvertiserType()}_fetch(e,t){this.awrFetcher._fetch(e,t)}}class Et extends St{}class Tt extends Oe{awrFetcher;constructor(e,t){super(),this.awrFetcher=new ut(e,t,new ft)}getAdvertiserType(){return this.awrFetcher.getAdvertiserType()}_fetch(e,t){this.awrFetcher._fetch(e,t)}}function kt(e){return e.map(e=>Array.isArray(e)?kt(e):e).reduce((e,t)=>e.concat(t),[])}function It(e,t){return()=>{try{e()}catch(e){t.error(e)}}}function _t(e,t){if(!t||0===t.length)return e;const[r,...i]=t;return Object.prototype.hasOwnProperty.call(e,r)?_t(e[r],i):void 0}function Ot(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Array.isArray(e[r])&&Array.isArray(t[r])){if(!Ot(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}class Ct extends Oe{criteo;logger=E.resolve(M);constructor(e){super(),this.criteo=e}_fetch(e,t){this.validate()?(e.forEach(e=>{const{zoneid:r,height:i,width:n}=e.settings,s=e.getContainerId(),o={zoneid:r,containerid:s,callbackSuccess:()=>{t.markContainerAs(s,!0),i&&n&&this.updateContainerIframeSize(s,i,n)},callbackError:()=>{t.markContainerAs(s,!1)}};this.pushEvent(()=>{this.criteo.DisplayAcceptableAdIfAdblocked?.(o)})}),this.logger.debug(`[CriteoFetcher] Load ads for ${e.length} slot(s) of type ${e.map(e=>e.type)[0]}`)):t.abortAll()}validate(){return"function"==typeof this.criteo.DisplayAcceptableAdIfAdblocked}updateContainerIframeSize(e,t,r){const i=document.querySelector(`#${e} iframe`);void 0!==i&&(i.height=String(t),i.width=String(r))}pushEvent(e){this.criteo.events.push(It(e,this.logger))}getAdvertiserType(){return re.ADBLOCK_CRITEO_WEB}}let Pt=class{definedSlotsByContainerId=new Map;size(){return this.definedSlotsByContainerId.size}push(e,t,r,i,n){this.definedSlotsByContainerId.set(e,{slot:t,sizes:r,displayed:i,outOfPageSlot:n})}remove(e){if(this.isUndefined(e))throw new Error(`GAM Slot '${e}' should be defined before removing it.`);this.definedSlotsByContainerId.delete(e)}getGamSlot(e){return this.get(e).slot}getTargetings(e){const t=this.getGamSlot(e);return t.getTargetingKeys().reduce((e,r)=>{const i=t.getTargeting(r);return{...e,[r]:i}},{})}getSizes(e){return this.get(e).sizes}isUndefined(e){return!this.definedSlotsByContainerId.has(e)}isDisplayed(e){return this.isDefined(e)&&this.get(e).displayed}isOutOfPageSlot(e){return this.isDefined(e)&&this.get(e).outOfPageSlot}markAsDisplayed(e){if(this.isUndefined(e))throw new Error(`GAM Slot '${e}' should be defined before mark as displayed.`);this.get(e).displayed=!0}get(e){const t=this.definedSlotsByContainerId.get(e);if(void 0===t)throw new Error(`GAM slot ${e} is not defined yet. Add it first to the registry before accessing it.`);return t}isDefined(e){return!this.isUndefined(e)}};Pt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k()],Pt);const Lt=Pt;class jt{fetchResult;document;mutationObserver;mutationObserverOptions={childList:!0};constructor(e,t){this.fetchResult=e,this.document=t,this.mutationObserver=null,this.hasMutationObserver()&&(this.mutationObserver=new MutationObserver(this.handleMutation.bind(this)))}observe(e){const t=this.document.querySelector(`#${e}`);null!==this.mutationObserver&&null!==t&&this.mutationObserver.observe(t,this.mutationObserverOptions)}handleMutation(e){e.forEach(e=>{const t=e.target;if(!("getAttribute"in t))return;const r=t.getAttribute("id");r&&this.fetchResult.markContainerAs(r,!0)})}hasMutationObserver(){return"MutationObserver"in window}}function Dt(e,t="property",r=void 0){if(!function(e){return null!=e}(e))throw new Error(r||`${t} should be defined`);return e}function xt(e){return null!=e}class Ft{generateUuid(){if("undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID)return crypto.randomUUID();throw new Error("crypto.randomUUID() is not supported in this browser. Please use a modern browser.")}}let Nt=class{metrics=E.resolve(ce);recordInterstitialEventsAndSetUpImpressionTracking(e){this.recordInterstitialEvents(e),this.setUpImpressionTracking(e)}recordInterstitialEvents(e){e.length>0&&this.metrics.recordInterstitialEvent(e)}setUpImpressionTracking(e){const t=this.createPopstateHandler(e);window.addEventListener("popstate",t,!0),setTimeout(()=>window.removeEventListener("popstate",t,!0),3e3)}createPopstateHandler(e){return t=>{window.location.href.includes("#google_vignette")&&this.metrics.recordInterstitialImpression(e)}}};Nt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k()],Nt);const Bt=Nt;let Mt=class{interstitialMonitor=E.resolve(Bt);documentWrapper=E.resolve(K);interstitialEvents=[];setUp(e){this.interstitialEvents=e,this.setUpClickEventHandling(),this.interstitialEvents.some(e=>e.isDisplayedOnUnhideWindow)&&this.setUpUnhideWindowEventHandling(),this.interstitialEvents.some(e=>e.isDisplayedOnNavbarInteraction)&&this.setUpNavbarEventHandling()}setUpClickEventHandling(){this.documentWrapper.get().addEventListener("click",this.handleClick.bind(this),!0)}handleClick(e){if(!(e?.target&&e.target instanceof HTMLElement))return;const t=e.target.closest("a[href]");if(!xt(t))return;const r=this.getTriggeredNavigationEventNames(t);this.interstitialMonitor.recordInterstitialEventsAndSetUpImpressionTracking(r),0===r.length&&this.disallowInterstitialDisplay(t)}getTriggeredNavigationEventNames(e){return this.interstitialEvents.filter(e=>xt(e.linkSelectQuery)).filter(t=>e.matches(t.linkSelectQuery)).map(e=>e.eventName)}disallowInterstitialDisplay(e){e.setAttribute("data-google-interstitial","false")}setUpUnhideWindowEventHandling(){this.documentWrapper.get().addEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!0)}handleVisibilityChange(){this.documentWrapper.get().hidden||this.interstitialMonitor.recordInterstitialEventsAndSetUpImpressionTracking(["unhideWindow"])}setUpNavbarEventHandling(){this.documentWrapper.get().body.addEventListener("mouseleave",this.handleMouseLeave.bind(this),!1)}handleMouseLeave(e){const t=this.documentWrapper.get().body.getBoundingClientRect().top+10;e.isTrusted&&e.clientY<t&&this.interstitialMonitor.recordInterstitialEventsAndSetUpImpressionTracking(["navbar"])}};Mt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k()],Mt);const zt=Mt;var Gt;let Vt=class{static{Gt=this}logger;static{var e,t,r;e=this,r={nextSearchResultsPage:{eventName:"nextSearchResultsPage",isDisplayedOnUnhideWindow:!1,isDisplayedOnNavbarInteraction:!1,linkSelectQuery:"a[href*='seite\\:']"},mwebHomeGalleryToVip:{eventName:"mwebHomeGalleryToVip",isDisplayedOnUnhideWindow:!1,isDisplayedOnNavbarInteraction:!1,linkSelectQuery:".adgallery--items a[href*='/s-anzeige/']"},unhideWindow:{eventName:"unhideWindow",isDisplayedOnUnhideWindow:!0,isDisplayedOnNavbarInteraction:!1},navbar:{eventName:"navbar",isDisplayedOnUnhideWindow:!1,isDisplayedOnNavbarInteraction:!0},mwebHomeCategoryModalToSrpb:{eventName:"mwebHomeCategoryModalToSrpb",isDisplayedOnUnhideWindow:!1,isDisplayedOnNavbarInteraction:!1,linkSelectQuery:".modal--content .navlist--list a.navlist--item"},clickOrganicAd:{eventName:"clickOrganicAd",isDisplayedOnUnhideWindow:!1,isDisplayedOnNavbarInteraction:!1,linkSelectQuery:"a[href*='s-anzeige']"}},(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="interstitialEventConfigurations"))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}constructor(e){this.logger=e}getInterstitialEvent(e){return Gt.interstitialEventConfigurations[e]||(this.logger.error(`Unknown interstitial event name '${e}'`),null)}};Vt=Gt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M])],Vt);const Wt=Vt;class Ut{interstitialEvents;constructor(e){this.interstitialEvents=e}configureGamSlot(e){const t=this.interstitialEvents.some(e=>e.isDisplayedOnUnhideWindow),r=this.interstitialEvents.some(e=>e.isDisplayedOnNavbarInteraction);e.setConfig({interstitial:{triggers:{navBar:r,unhideWindow:t}}})}}class qt{googletag;modifySlotExtensions;logger=E.resolve(M);definedSlots=E.resolve(Lt);interstitialEventInMemoryRepository=E.resolve(Wt);interstitialEventHandler=E.resolve(zt);constructor(e,t=[]){this.googletag=e,this.modifySlotExtensions=t}defineSlotIfUndefined(e){const t=e.getAdvertiser(),r=e.getContainerId(),{sizes:i}=e.getSettings(),n=t.trackingCode,s=e.getSlotLevelTargeting(),o=e.getSlotLevelAdUnitCode();this.pushGoogleTagCmd(()=>{if(this.definedSlots.isUndefined(r)){const e=this.createGamSlot(t,o,i,r);e.addService(this.getPubService()),this.modifySlotExtensions.forEach(r=>r.modifySlot(e,t)),s&&Object.entries(s).forEach(([t,r])=>{e.setTargeting(t,r)}),e.setTargeting("pos",n),e.setTargeting("containerId",r),this.definedSlots.push(r,e,i,!1,this.isInterstitial(t))}})}extractInterstitialEvents(e){return(e.settings.showInterstitialOnEvent??[]).map(e=>this.interstitialEventInMemoryRepository.getInterstitialEvent(e)).filter(e=>null!==e)}createGamSlot(e,t,r,i){return this.isInterstitial(e)?this.createInterstitialGamSlot(e,t):this.createNonInterstitialGamSlot(t,r,i)}createNonInterstitialGamSlot(e,t,r){let i=this.googletag.defineSlot(e,t,r);return i=Dt(i,"gamSlot","GamSlot should not be null"),i}createInterstitialGamSlot(e,t){const r=this.extractInterstitialEvents(e);this.interstitialEventHandler.setUp(r);const i=new Ut(r);let n=this.googletag.defineOutOfPageSlot(t,this.googletag.enums.OutOfPageFormat.INTERSTITIAL);return n=Dt(n,"gamSlot","GamSlot should not be null"),i.configureGamSlot(n),n}loadAdblocks(e){this.displayOrRedefineSlots(e),this.refreshSlots(e)}displayOrRedefineSlots(e){e.forEach(e=>{this.displayOrRedefineSlot(e)})}displayOrRedefineSlot(e){this.pushGoogleTagCmd(()=>{const t=e.getContainerId();this.definedSlots.isDisplayed(t)||this.displayAndMarkAsDisplayed(t),this.shouldBeRedefined(e)&&(this.redefineSlot(e),this.displayAndMarkAsDisplayed(t))})}shouldBeRedefined(e){const{sizes:t}=e.getSettings(),r=e.getContainerId(),i=this.getDefinedSlot(r).getAdUnitPath(),n=this.definedSlots.getSizes(r);return i!==e.getSlotLevelAdUnitCode()||!Ot(n,t)}redefineSlot(e){const t=e.getContainerId();this.debug(t,"Destroy and define gamSlot..."),this.googletag.destroySlots([this.getDefinedSlot(t)]),this.definedSlots.remove(t),this.defineSlotIfUndefined(e)}refreshSlots(e){this.pushGoogleTagCmd(()=>{const t=function(e){const t=new Set;return e.filter(e=>{const r=e.getContainerId(),i=!t.has(r);return i&&t.add(r),i})}(e),r=t.map(e=>e.getContainerId());this.logger.debug("Batched load:",r);const i=r.map(e=>this.definedSlots.getGamSlot(e));t.forEach(e=>{const t=e.getAdvertiser().slotRefreshCount,r=this.definedSlots.getGamSlot(e.getContainerId());qt.prepareSlotForGam(r,t)}),this.getPubService().refresh(i)})}displayAndMarkAsDisplayed(e){this.display(e),this.definedSlots.markAsDisplayed(e)}display(e){if(this.debug(e,"Display..."),this.definedSlots.isOutOfPageSlot(e)){const t=this.definedSlots.getGamSlot(e);this.googletag.display(t)}else this.googletag.display(e)}static prepareSlotForGam(e,t){qt.setImpressionId(e),qt.setSlotRefreshCount(e,t)}getDefinedSlot(e){return this.definedSlots.getGamSlot(e)}static setImpressionId(e){e.setTargeting("imp_id",(new Ft).generateUuid())}static setSlotRefreshCount(e,t){e.setTargeting("slot_refresh_count",t.toString())}pushGoogleTagCmd(e){this.googletag.cmd.push(It(e,this.logger))}getPubService(){return this.googletag.pubads()}debug(e,t){this.logger.debug(`GamSlot ${e}: ${t}`)}isInterstitial(e){return!!e.settings.isInterstitial}}class $t{advertiser;store;slotLevelBiddingGamTargetings;constructor(e,t,r){this.advertiser=e,this.store=t,this.slotLevelBiddingGamTargetings=r}getPageUrl(){return this.getSettingsFromSlotOrPageLevel("pageUrl")||""}getUserIdHash(){return this.getSettingsFromSlotOrPageLevel("userIdHash")||""}getPageLevelTargetings(){return this.getTargetingsFromSlotOrPageLevel()||{}}getSlotLevelTargeting(){const e=this.store.getSlotOptionsByPositionName(this.advertiser.positionName).gamTargetings;return e?this.slotLevelBiddingGamTargetings?{...e,...this.slotLevelBiddingGamTargetings}:e:this.slotLevelBiddingGamTargetings}getAdvertiser(){return this.advertiser}getAdvertiserType(){return this.advertiser.type}getBiddingType(){return this.advertiser.biddingType}getContainerId(){return this.advertiser.getContainerId()}getSettings(){return this.advertiser.settings}getCode(){return this.getSettings().code}getSlotLevelAdUnitCode(){const{code:e}=this.advertiser.settings,t=e??this.getAdUnitCodeFromSlotOptions();if(!t)throw new Error("Ad unit code is not defined");return t}getAdUnitCodeFromSlotOptions(){return this.store.getSlotOptionsByPositionName(this.advertiser.positionName).gamAdUnitCode}getSettingsFromSlotOrPageLevel(e){const t=this.advertiser.settings[e];return void 0!==t?t:this.getPageLevelSettings()[e]}getTargetingsFromSlotOrPageLevel(){const e=this.advertiser.settings.gamTargets??this.advertiser.settings.dfpTargets;if(void 0!==e)return e;const t=this.getPageLevelSettings();return t.gamTargets??t.dfpTargets}getPageLevelSettings(){return this.store.getPageLevelSettings(this.advertiser.type)}copy({settings:e,advertiserType:t,biddingType:r,slotLevelBiddingGamTargetings:i}){return new $t(this.advertiser.copy({settings:e,advertiserType:t,biddingType:r}),this.store,i??this.slotLevelBiddingGamTargetings)}}const Kt=["header/category-takeover","left/category-takeover","right/category-takeover"];class Ht{logger=E.resolve(M);sort(e){e.length<=0||(this.logger.debug("Unsorted advertisers:",e.map(e=>e.getContainerId())),e.forEach(e=>{this.logger.debug(`Sorting prio for ${e.getSlotLevelAdUnitCode()}:`,this.getSortingPriority(e))}),e.sort((e,t)=>this.getSortingPriority(e)-this.getSortingPriority(t)),this.logger.debug("Sorted advertisers:",e.map(e=>e.getContainerId())))}getSortingPriority(e){const t=Kt.findIndex(t=>this.findSubstring(e.getSlotLevelAdUnitCode(),t));return-1!==t?t:Kt.length}findSubstring(e,t){return e.toLowerCase().includes(t.toLowerCase())}}const Qt=5628409328,Yt=[13868397,13031757,5126959378,5138029590,4789830132,20223117,13135437,19240677,19108917,19178397,5093868196,5093864557,5707293487,18784077,4742462866,4879651882,5224989977,5339876834,4732557789,5504112362,5764624476,Qt,5154335209];var Jt;function Zt(e){return Object.values(Jt).map(e=>String(e)).includes(e)}!function(e){e.TREEBAY="treebay",e.PRO_SELLER="pro_seller",e.EPN="epn"}(Jt||(Jt={}));const Xt=Jt;let er=class{logger;windowMessageDecoder;windowWrapper;constructor(e,t,r){this.logger=e,this.windowMessageDecoder=t,this.windowWrapper=r}needsIframeMessage(e){return void 0!==e&&Zt(e)}resolveMessageStatus(e,t){return this.logger.debug(`[GamMessageReceiver] Slot ${e}: Waiting for postMessage event because of subtype ${t}...`),new Promise(t=>{this.windowWrapper.get().addEventListener("message",r=>{if(this.isSubtypeEvent(r,e)){this.logger.debug(`[GamMessageReceiver] Slot ${e}: Got postMessage event:`,r);const i=this.isLoaded(r);t({containerId:e,filled:i})}})})}isSubtypeEvent(e,t){if(e.data.event!==st)return!1;let r={};try{r=this.windowMessageDecoder.decodeMessage(e.data.info)}catch(t){return this.logger.error(new Error(`[GamMessageReceiver] Invalid info string: '${e.data.info}' Error: ${t} Fetching backfill...`)),!1}const i=r.containerId===t,n=Zt(r.subtype);return i&&n}isLoaded(e){return"success"===this.windowMessageDecoder.decodeMessage(e.data.info).status}};er=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,ct,q])],er);const tr=er;let rr=class{logger;libertyPerformanceMarker;messageReceiver;constructor(e,t,r){this.logger=e,this.libertyPerformanceMarker=t,this.messageReceiver=r}buildCallback(e,t,r){const i=n=>{try{const s=n.slot.getSlotElementId();if(t!==s)return;r(i);const o=!n.isEmpty,a=n.advertiserId;this.handleFill(t,o,a,e)}catch(e){this.logger.error(e)}};return i}handleFill(e,t,r,i){try{if(this.libertyPerformanceMarker.renderingDone(e),t){const t={gamAdvertiserId:r};this.handleSubtypeOrResolve(e,i,t,r)}else i.markContainerAs(e,!1)}catch(t){this.logger.error(t),i.markContainerAs(e,!1)}}handleSubtypeOrResolve(e,t,r,i){const n=t.getCurrentAdvertiser(e).settings.subtype;i===Qt||this.messageReceiver.needsIframeMessage(n)?this.messageReceiver.resolveMessageStatus(e,n).then(({filled:i})=>t.markContainerAs(e,i||!1,r)):t.markContainerAs(e,!0,r)}};rr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,he,tr])],rr);const ir=rr;let nr=class{createGoogleTagConfig(e){return{pps:{taxonomies:{IAB_CONTENT_2_2:{values:e}}}}}};nr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],nr);const sr=nr;let or=class{initialize(e,t){e.enableSingleRequest(),e.disableInitialLoad();const r=t.getPageUrl();void 0!==r&&e.set("page_url",r);const i=t.getUserIdHash();e.setPublisherProvidedId(String(i)),e.collapseEmptyDivs()}};or=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],or);const ar=or;var cr;!function(e){e.PREBID="prebid",e.AMAZON="amazon",e.ADSENSE="adsense"}(cr||(cr={}));const lr=cr;let dr=class{windowMessageDecoder;logger;adsenseFetcher=E.resolve(Pe);unifiedAuctionAdvertisers=[];fetcherResult;constructor(e,t){this.windowMessageDecoder=e,this.logger=t,this.handleMessageEvent=this.handleMessageEvent.bind(this),this.handleMessage=this.handleMessage.bind(this),this.isMatchingMessage=this.isMatchingMessage.bind(this)}setExternalProperties(e,t){this.setUnifiedAuctionAdvertisers(e),this.setFetcherResult(t)}setUnifiedAuctionAdvertisers(e){this.unifiedAuctionAdvertisers=e}setFetcherResult(e){this.fetcherResult=e}handleMessageEvent(e){if(this.isUnifiedAuctionMessage(e)){const t=this.windowMessageDecoder.decodeMessage(e?.data.info),r=this.isMatchingMessage(t,this.fetcherResult,this.unifiedAuctionAdvertisers,lr.ADSENSE);if(e?.data.event===ot){if(!r)return;if(!this.adsenseFetcher)return void this.debug("Adsense won the auction but the fetcher was not initialized.");this.debug("Adsense won the auction.",r),this.handleMessage(r,this.fetcherResult,this.adsenseFetcher)}}}isUnifiedAuctionMessage(e){return e?.data&&this.fetcherResult&&this.unifiedAuctionAdvertisers.length>0&&e.data.event===ot}handleMessage(e,t,r){r._fetch([e],t)}isMatchingMessage(e,t,r,i){return r.find(r=>this.isMatchingContainerId(e,t)&&this.isMatchingAdvertiser(r,e,i))}isMatchingContainerId(e,t){const{containerId:r}=e;return t.getAllContainerIds().some(e=>e===r)}isMatchingAdvertiser(e,t,r){const{containerId:i}=t;return e.getContainerId()===i&&e.biddingType===r}debug(...e){this.logger.debug("[UnifiedAuctionWindowMessageHandler]",...e)}};dr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[ct,M])],dr);const ur=dr;function gr(e){const t="B"===e.getExperimentVariant("EBAYKAD-3536_floor_ai"),r="B"===e.getExperimentVariant("KADA-247_floor_ai");return t||r}const fr={[re.ADSENSE_WEB]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.AFFILIATESHUB_WEB]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.DISPLAY_WEB]:{requiresSize:!0,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.DISPLAY_WEB_PREBID]:{requiresSize:!0,isAdblockerRelevant:!1,hasBiddingEnabled:!0},[re.ADBLOCK_CRITEO_WEB]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.DISPLAY_WEB_AAX]:{requiresSize:!0,isAdblockerRelevant:!0,hasBiddingEnabled:!1},[re.IGNITE_WEB]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.IGNITE_MWEB]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.DISPLAY_WEB_AMAZON]:{requiresSize:!0,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.DISPLAY_WEB_UNIFIED_AUCTION]:{requiresSize:!0,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.BING_WEB]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1},[re.FIRST_PARTY_PLA]:{requiresSize:!1,isAdblockerRelevant:!1,hasBiddingEnabled:!1}};class hr{modifySlot(e,t){throw new Error("Not implemented")}}class pr extends hr{modifySlot(e,t){fr[t.type].isAdblockerRelevant&&e.setTargeting("aaxReplaceable","true")}}class yr extends hr{modifySlot(e,t){e.setTargeting("content_url",String(window.location.href))}}class vr extends hr{modifySlot(e,t){e.setTargeting("upr",this.buildFloorPricingTargeting(t.settings.floorPrice))}buildFloorPricingTargeting(e){return(e??0).toFixed(2)}}class mr extends hr{static adCountsbySubtype=new Map;modifySlot(e,t){const r=t.settings.subtype;if(Zt(String(r))){const t=mr.adCountsbySubtype.get(r)||0;mr.adCountsbySubtype.set(r,t+1),e.setTargeting("gam_count",String(mr.adCountsbySubtype.get(r)))}}static resetCount(){Object.values(Xt).forEach(e=>{mr.adCountsbySubtype.set(e,0)})}}let br=class{createAllAdblockLoaderCustomParameterExtensions(e){const t=[new mr,new pr,new yr];return gr(e)&&t.push(new vr),t}};br=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],br);const wr=br;class Ar extends Oe{googletag;store;advertiserType;biddingStrategy;logger=E.resolve(M);libertyPerformanceMarker=E.resolve(he);documentWrapper=E.resolve(K);unifiedAuctionWindowMessageHandler=E.resolve(ur);callbackFactory=E.resolve(ir);pubServiceInitializer=E.resolve(ar);adblockExtensionFactory=E.resolve(wr);gamAdvertiserSorter=E.resolve(Ht);gamAdblockLoader;constructor(e,t,r,i){super(),this.googletag=e,this.store=t,this.advertiserType=r,this.biddingStrategy=i,this.gamAdblockLoader=new qt(this.googletag,this.adblockExtensionFactory.createAllAdblockLoaderCustomParameterExtensions(t))}_fetch(e,t){const r=this.createGamAdvertisers(e),i=this.biddingStrategy.getSizeFilteredAdvertisers(r);this.markRemovedAdvertisersAsUnfilled(r,i,t),this.biddingStrategy.getWinningBids(i).then(({advertisersToForwardToGam:e,advertisersToCancel:i})=>{if(this.markPerformanceSlotBiddingEnded(r),this.cancelAdvertisersByMarkingAsUnfilled(i,t),e.length>0){const r=e.map(e=>e.getContainerId());this.logNotUniqueSlots(r),this.setPageLevelTargetings(e),this.defineSlots(e),this.pushGoogleTagCmd(()=>{this.biddingStrategy.syncBiddingWithGam(e),this.gamAdvertiserSorter.sort(e),this.loadAndDisplay(e,t)})}this.logger.debug(`[GamFetcher] Load ads for ${e.length} slot(s) of type ${e.map(e=>e.getAdvertiserType())[0]}`)}).catch(e=>{this.logger.error(e)})}logNotUniqueSlots(e){var t;t=e,new Set(t).size!==t.length&&this.logger.debug("[GamFetcher]: WARN: Same GAM slot is loaded multiple times!")}setGoogleTagConfig(){const e=this.store.getIabCategoryIds(),t=(new sr).createGoogleTagConfig(e);this.googletag.setConfig(t),this.logger.debug("[GamFetcher] set googletag config:",t)}markPerformanceSlotBiddingEnded(e){e.forEach(e=>{const t=e.getContainerId();this.libertyPerformanceMarker.biddingDone(t)})}cancelAdvertisersByMarkingAsUnfilled(e,t){const r=e.map(e=>e.getContainerId());t.markAllContainersAsUnfilled(r)}async loadAndDisplay(e,t){this.initGoogleTag(e,t),await this.documentWrapper.whenDomReady(),this.loadAdblocks(e)}initGoogleTag(e,t){this.pushGoogleTagCmd(()=>{if(this.store.isAdblockerEnabled()&&this.advertiserType===re.DISPLAY_WEB){const r=new jt(t,this.documentWrapper.get());e.forEach(e=>{r.observe(e.getContainerId())})}else this.setUnifiedAuctionProperties(e,t),this.registerGamCallback(t);this.setGoogleTagConfig(),this.pubServiceInitializer.initialize(this.getPubService(),e[0]),this.googletag.enableServices()})}setUnifiedAuctionProperties(e,t){const r=this.extractUnifiedAuctionBiddingAdvertisers(e);this.unifiedAuctionWindowMessageHandler.setExternalProperties(r,t)}defineSlots(e){e.forEach(e=>{this.gamAdblockLoader.defineSlotIfUndefined(e)})}setPageLevelTargetings(e){const t={...this.getPageLevelTargetings(e),...this.biddingStrategy.getPageLevelTargetings()};this.setPubServiceTargeting(t)}getPageLevelTargetings(e){return e.length<1?{}:e[0].getPageLevelTargetings()}setPubServiceTargeting(e){e={...e,adblock_group:this.buildAdBlockingTrackingInfo()},this.pushGoogleTagCmd(()=>{Object.entries(e).forEach(([e,t])=>{this.getPubService().setTargeting(e,t)})})}buildAdBlockingTrackingInfo(){return`${this.store.getPlatform()}_${this.store.getGroupName()}_${this.store.getPageType()}_${this.store.isAdblockerEnabled()?"adblocking-on":"adblocking-off"}`.toLowerCase()}registerGamCallback(e){e.getAllContainerIds().forEach(t=>{const r=this.callbackFactory.buildCallback(e,t,e=>{const t=this.getPubService();t&&t.removeEventListener&&t.removeEventListener("slotRenderEnded",e)});this.getPubService().addEventListener("slotRenderEnded",r)})}loadAdblocks(e){this.gamAdblockLoader.loadAdblocks(e)}pushGoogleTagCmd(e){this.googletag.cmd.push(It(e,this.logger))}getPubService(){return this.googletag.pubads()}markRemovedAdvertisersAsUnfilled(e,t,r){const i=t.map(e=>e.getContainerId()),n=e.map(e=>e.getContainerId()).filter(e=>!i.includes(e));r.markAllContainersAsUnfilled(n)}getAdvertiserType(){return this.advertiserType}createGamAdvertisers(e){return e.map(e=>new $t(e,this.store))}extractUnifiedAuctionBiddingAdvertisers(e){return e.filter(e=>this.isAdsenseEnabled(e)).map(e=>e.getAdvertiser())}isAdsenseEnabled(e){return e.getBiddingType()===lr.ADSENSE&&Number(e.getSettings().adsenseEcpm)>0}}class Rr extends Oe{advertiserType;logger=E.resolve(M);constructor(e){super(),this.advertiserType=e}_fetch(e,t){this.logger.debug(`[NothingFetcher] Do not load ads for ${e.length} slot(s) of type ${this.getAdvertiserType()}`),t.abortAll()}getAdvertiserType(){return this.advertiserType}}const Sr="fluid";let Er=class{logger;constructor(e){this.logger=e}getResizedAdBlock(e,t){const r=t.sizes,i=this.filterSizes(r,e),n=i.length<r.length;return this.logger.debug(`Slot ${t.positionName}: ${n?"":"not "}filtered sizes, old sizes:`,r,", new sizes:",i),this.buildResizedAdBlock(i,t)}filterSizes(e,t){return e.filter(e=>this.hasEnoughRoom(e,t))}buildResizedAdBlock(e,t){return{...t,sizes:e}}hasEnoughRoom(e,t){if(this.isFluid(e))return!0;const[r,i]=e,n=r<=t.maxWidth,s=i<=t.maxHeight;return n&&s}isFluid(e){return e===Sr||Array.isArray(e)&&e[0]===Sr}};Er=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M])],Er);const Tr=Er;let kr=class{sizeFilter;constructor(e){this.sizeFilter=e}getResizedAdBlock(e,t){const r=this.sizeFilter.getResizedAdBlock(e,t),i=_t(t,["mediaTypes","banner","sizes"]),n=this.sizeFilter.filterSizes(i,e),s=this.filterBids(t.bids,e);return this.buildResizedAdBlock(r,n,s)}buildResizedAdBlock(e,t,r){return{...e,mediaTypes:{...e.mediaTypes,banner:{...e.mediaTypes.banner,sizes:t}},bids:r}}filterBids(e,t){return e.filter(e=>this.bidMatchesSlotRanges(e,t)).map(this.omitLibertyResponsiveRules)}bidMatchesSlotRanges(e,t){const r=e.libertyResponsiveRules;if(!r)return!0;const{minWidth:i,maxWidth:n,minHeight:s,maxHeight:o}=r;return!(void 0!==i&&i>t.maxWidth||void 0!==n&&n<t.maxWidth||void 0!==s&&s>t.maxHeight||void 0!==o&&o<t.maxHeight)}omitLibertyResponsiveRules(e){return function(e,t){if(!e)return e;const r={};return Object.entries(e).forEach(([e,i])=>{t&&!t.includes(e)&&(r[e]=i)}),r}(e,["libertyResponsiveRules"])}};kr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Tr])],kr);const Ir=kr;let _r=class{store;responsivePrebidAdBlockFilter;responsiveGamAdBlockFilter;logger;constructor(e,t,r,i){this.store=e,this.responsivePrebidAdBlockFilter=t,this.responsiveGamAdBlockFilter=r,this.logger=i}getResizedAdvertisersForPrebid(e){return this.getResizedAdvertisers(e,this.responsivePrebidAdBlockFilter)}getResizedAdvertisersForGam(e){return this.getResizedAdvertisers(e,this.responsiveGamAdBlockFilter)}getResizedAdvertisers(e,t){return e.map(e=>this.getResizedAdvertiser(e,t)).filter(e=>{const t=e.getSettings(),r=t.sizes;return this.hasSizes(r,t.positionName)})}getResizedAdvertiser(e,t){return e.copy({settings:this.getResizedAdBlock(e.getSettings(),t)})}getResizedAdBlock(e,t){const r=this.store.getSlotSize(e.positionName);return r?t.getResizedAdBlock(r,e):e}hasSizes(e,t){if(!e||0===e.length){const e=this.store.getSlotSize(t);this.logger.debug(`Allowed size [${e?.maxWidth},${e?.maxHeight}] is exceeded: Disabling ${t}`)}return e&&e.length>0}};_r=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,Ir,Tr,M])],_r);const Or=_r;let Cr=class{advertiserResizer;constructor(e){this.advertiserResizer=e}getSizeFilteredAdvertisers(e){return this.advertiserResizer.getResizedAdvertisersForGam(e)}getPageLevelTargetings(){return{}}syncBiddingWithGam(e){}async getWinningBids(e){return{advertisersToForwardToGam:e,advertisersToCancel:[]}}};Cr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Or])],Cr);const Pr=Cr,Lr="hb_pb_ignite",jr="hb_bidder_ignite";let Dr=class{store;advertiserResizer;targetedGamAdvertiserFactory;logger=E.resolve(M);gamDefinedSlotRegistry=E.resolve(Lt);constructor(e,t,r){this.store=e,this.advertiserResizer=t,this.targetedGamAdvertiserFactory=r}getSizeFilteredAdvertisers(e){const t=this.filterAdsenseAdvertisers(e);return this.advertiserResizer.getResizedAdvertisersForGam(t)}getPageLevelTargetings(){return{}}async getWinningBids(e){const t=this.filterAdsenseAdvertisers(e);if(0===t.length)return{advertisersToForwardToGam:[],advertisersToCancel:[]};const r=t.map(e=>e.getAdvertiser()),i=this.store.getQuery(r),n=Number(r[0].settings.adsenseEcpm??0);return n>0?{advertisersToForwardToGam:this.targetedGamAdvertiserFactory.create({gamAdvertisers:t,queryString:i??"",ecpm:n}),advertisersToCancel:[]}:{advertisersToForwardToGam:[],advertisersToCancel:t}}syncBiddingWithGam(e){const t=this.filterAdsenseAdvertisers(e);0!==t.length&&t.forEach(e=>{const t=e.getAdvertiser(),r=e.getSlotLevelTargeting();r?(this.debug("Syncing advertiser with GAM. Advertiser, slotLevelTargeting:",t,e.getSlotLevelTargeting()),this.gamDefinedSlotRegistry.getGamSlot(t.getContainerId()).updateTargetingFromMap(r)):this.debug("Cannot sync Adsense bid for advertiser with GAM. \n           GamAdvertiser#getSlotLevelTargeting() returned undefined. Advertiser:",t)})}filterAdsenseAdvertisers(e){return e.filter(e=>{const t=e.getSettings().adsenseEcpm??0;return e.getBiddingType()===lr.ADSENSE&&Number(t)>0})}debug(...e){this.logger.debug("[AdsenseBiddingStrategy] ",...e)}};Dr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,Or,class{create({gamAdvertisers:e,queryString:t,ecpm:r}){if(0===e.length)return[];const i=this.createSlotLevelBiddingGamTargetings(r);return e.map(e=>e.copy({slotLevelBiddingGamTargetings:i,settings:{...e.getSettings(),queryString:t}}))}createSlotLevelBiddingGamTargetings(e){return{[Lr]:e.toFixed(2),[jr]:"adsense"}}}])],Dr);const xr=Dr;function Fr(e){return"B"===e.getExperimentVariant(et)}class Nr{advertiserResizer;amazonPublisherServicesTag;amazonBidFetcher;store;logger=E.resolve(M);gamDefinedSlotRegistry=E.resolve(Lt);constructor(e,t,r,i){this.advertiserResizer=e,this.amazonPublisherServicesTag=t,this.amazonBidFetcher=r,this.store=i}getSizeFilteredAdvertisers(e){const t=this.filterAmazonAdvertisers(e);return 0===t.length?[]:this.advertiserResizer.getResizedAdvertisersForGam(t)}getPageLevelTargetings(){return{}}async getWinningBids(e){const t=this.filterAmazonAdvertisers(e);if(0===t.length)return{advertisersToForwardToGam:[],advertisersToCancel:[]};const r=t.map(this.mapToSlot),i=t.map(this.mapToNativeSlot);let n=[];if(0!==r.length)if(Fr(this.store)){await this.amazonBidFetcher.defineNativeSlots(i);const e=i.map(e=>e.id);await this.amazonBidFetcher.fetchNativeTargetings(e)}else{const e=await this.amazonBidFetcher.requestBids(r);this.debug("[AmazonBiddingStrategy] Auction result:",e),n=e.bidResponses}const s=this.getFilledAdvertisers(t,n),o=this.getUnfilledAdvertisers(t,n);return this.debug("Filled advertisers:",s.map(e=>e.getAdvertiser())),this.debug("Unfilled advertisers:",o.map(e=>e.getAdvertiser())),{advertisersToForwardToGam:Fr(this.store)?t:s,advertisersToCancel:Fr(this.store)?[]:o}}syncBiddingWithGam(e){const t=this.filterAmazonAdvertisers(e);if(0!==t.length)if(this.debug("Set GAM slot targeting for ALL existing Amazon advertisers on page"),Fr(this.store)){const e=t.map(e=>e.getAdvertiser().positionName);this.amazonBidFetcher.attachNativeTargeting(e),this.debug("Slot targetings:",t)}else{this.amazonPublisherServicesTag.setDisplayBids();const e=t.map(e=>[e.getAdvertiser(),this.gamDefinedSlotRegistry.getTargetings(e.getContainerId())]);this.debug("Slot targetings:",e)}}getFilledAdvertisers(e,t){const r=t.filter(e=>this.isAmazonBidIdValid(e.amznbid)).map(e=>e.slotID);return this.getAdvertisersBySlotIds(e,r)}getUnfilledAdvertisers(e,t){const r=t.filter(e=>!this.isAmazonBidIdValid(e.amznbid)).map(e=>e.slotID);return this.getAdvertisersBySlotIds(e,r)}getAdvertisersBySlotIds(e,t){return e.filter(e=>t.includes(this.mapToSlot(e).slotID))}isAmazonBidIdValid(e){return 0!==e&&1!==e&&2!==e&&e.length>=5}mapToSlot(e){return{slotID:e.getContainerId(),slotName:e.getCode(),sizes:e.getSettings().sizes}}mapToNativeSlot(e){return{id:e.getContainerId(),banner:{tagid:e.getCode(),format:e.getSettings().sizes?.map(e=>({w:e[0],h:e[1]}))}}}filterAmazonAdvertisers(e){return e.filter(this.isAmazonGamAdvertiser).filter(e=>!0!==e.getSettings().skipAmazon)}isAmazonGamAdvertiser(e){return e.getAdvertiserType()===re.DISPLAY_WEB_AMAZON||e.getBiddingType()===lr.AMAZON}debug(...e){this.logger.debug("[AmazonBiddingStrategy] ",...e)}}let Br=class{prebidLoader;logger;pbjs;constructor(e,t){this.prebidLoader=e,this.logger=t,this.pbjs=e.load()}pushCommand(e){this.pbjs.que.push(It(e,this.logger))}setConfig(e){this.pbjs.setConfig(e)}setBidderConfig(e){this.pbjs.setBidderConfig(e)}bidderSettings(e){this.pbjs.bidderSettings=e}requestBids(e){this.pbjs.requestBids(e)}addAdUnits(e){this.pbjs.addAdUnits(e)}removeAdUnit(e){this.pbjs.removeAdUnit(e)}getAdUnits(){return this.pbjs.adUnits}getVersion(){return this.pbjs.version}setTargetingForGPTAsync(e){this.pbjs.setTargetingForGPTAsync(e)}logCurrentConfig(){this.logger.debug("[Prebid] Prebid configuration:",this.pbjs.getConfig())}};Br=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Ke,M])],Br);const Mr=Br;var zr;!function(e){e[e.VERSION_2_1=5]="VERSION_2_1",e[e.VERSION_2_2=6]="VERSION_2_2",e[e.VERSION_3_0=7]="VERSION_3_0"}(zr||(zr={}));let Gr=class{createOrtb2Config(e){return{site:{name:"kleinanzeigen.de",cattax:zr.VERSION_2_2,pagecat:e,content:{data:[{name:"kleinanzeigen.de",ext:{segtax:zr.VERSION_2_2},segment:e.map(e=>({id:e}))}]}}}}createBidderConfigFromOptions(e,t){const r=this.createBidderConfigFromUserOptions(t.hashedUserEmailByAlgorithm);if(void 0!==e||void 0!==r)return{...e,...r}}createBidderConfigFromUserOptions(e){if(e?.md5&&e.sha256)return{bidders:["criteo"],config:{ortb2:{user:{ext:{data:{eids:[{source:"kleinanzeigen.de",uids:[{id:e.md5,atype:3,ext:{stype:"hemmd5"}},{id:e.sha256,atype:3,ext:{stype:"hemsha256"}}]}]}}}}}}}};Gr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],Gr);const Vr=Gr;let Wr=class{store;prebid;prebidConfigFactory;logger;constructor(e,t,r,i){this.store=e,this.prebid=t,this.prebidConfigFactory=r,this.logger=i}requestBids(e){return new Promise(t=>{this.pushPrebidQueue(()=>{this.buildAdBlocksAndRequestBids(e,t)})})}buildAdBlocksAndRequestBids(e,t){const{adUnitCodes:r,adBlocks:i}=this.buildAdUnitCodesAndAdBlocks(e);this.requestPrebidBids(i,r,t)}buildAdUnitCodesAndAdBlocks(e){const t=this.store.getPrebidOptions(),r=this.buildPrebidAdUnits(e);return{adUnitCodes:r.map(e=>e.code),adBlocks:this.buildPrebidAdBlocks(t,r,e)}}requestPrebidBids(e,t,r){const i={timeout:this.maxTimeout(e),adUnitCodes:t,bidsBackHandler:(e,t,i)=>{r({bidResponses:e,timedOut:t,auctionId:i})}};this.prebid.requestBids(i)}buildPrebidAdBlocks(e,t,r){const i=e.bidderSettings||{},n=this.getOrtb2PrebidConfig(),s=this.store.getUserOptions(),o=this.prebidConfigFactory.createBidderConfigFromOptions(this.store.getPrebidOptions().bidderConfig,s),a=[...e.config.userSync?.userIds||[]],c=e.euidConfig,l=this.store.isConsentGiven(gt.GDPR_THE_TRADE_DESK_EUID_ALLOWED);if(c&&s.hashedUserEmailByAlgorithm?.sha256){const e=function(e,t,r,i,n){if(!i)return;if(!e||!t||!r)return;let s=r;return/^[0-9a-fA-F]+$/.test(r)&&(s=function(e){const t=[];for(let r=0;r<e.length;r+=2)t.push(parseInt(e.substring(r,r+2),16));const r=String.fromCharCode(...t);return btoa(r)}(r)),{name:"euid",storage:{type:"html5",name:"euid",expires:60},params:{serverPublicKey:e,subscriptionId:t,emailHash:s,...void 0!==n?.siteId&&{site_id:n.siteId},...void 0!==n?.contact&&{contact:n.contact},...void 0!==n?.name&&{name:n.name},...void 0!==n?.siteName&&{site_name:n.siteName}}}}(c.serverPublicKey,c.subscriptionId,s.hashedUserEmailByAlgorithm.sha256,l,{siteId:c.siteId,contact:c.contact,name:c.name,siteName:c.siteName});e&&a.push(e)}const d={ortb2:n,bidderConfig:o,gptPreAuction:{enabled:!0,useDefaultPreAuction:!1,mcmEnabled:!0},...e.config,userSync:{...e.config.userSync,userIds:a}};return this.logger.debug("[PrebidBidFetcher] Prebid config:",d),this.prebid.setConfig(d),this.prebid.logCurrentConfig(),e.bidderConfig&&this.prebid.setBidderConfig(e.bidderConfig),this.prebid.bidderSettings(this.buildPrebidBidderSettings(i)),this.setupPrebidAdUnitsArray(t),r.map(e=>e.settings)}getOrtb2PrebidConfig(){const e=this.store.getIabCategoryIds();return this.prebidConfigFactory.createOrtb2Config(e)}buildPrebidAdUnits(e){return e.map(e=>{const t=e.settings,r=this.buildAdUnitCode(e),i=`${this.getSlotLevelAdUnitCode(e)}#${e.trackingCode}`;return{code:r,bids:[...t.bids],mediaTypes:{...t.mediaTypes},ortb2Imp:{ext:{gpid:i,data:{pbadslot:i}}}}})}buildAdUnitCode(e){return e.getContainerId()}getSlotLevelAdUnitCode(e){const{code:t}=e.settings,r=t;if(!r)throw new Error("Ad unit code is not defined");return r}setupPrebidAdUnitsArray(e){this.removePreviouslySetupAdUnits(e),this.prebid.addAdUnits(e)}removePreviouslySetupAdUnits(e){const t=this.getPreviouslySetupAdUnits(),r=this.findAllAdUnitCodesForNewFetch(e,t);this.prebid.removeAdUnit(r)}findAllAdUnitCodesForNewFetch(e,t){return e.map(({code:e})=>e).filter(e=>t.includes(e))}getPreviouslySetupAdUnits(){return this.prebid.getAdUnits().map(({code:e})=>e)}buildPrebidBidderSettings(e){const t=Object.entries(e).map(([e,t])=>({[e]:this.buildPrebidBidderSetting(t)}));return Object.assign({},...t)}buildPrebidBidderSetting(e){const{bidCpmAdjustmentFactor:t,...r}=e;return{...r,bidCpmAdjustment:this.buildBidCmpAdjustment(t)}}buildBidCmpAdjustment(e){return e?t=>t*e:void 0}maxTimeout(e){const t=this.store.getPrebidOptions().defaultTimeout,r=this.extractValidTimeouts(e,t);return r.length>0?Math.max(...r):t}extractValidTimeouts(e,t){return e.map(e=>e.timeout).map(e=>e&&this.isValidTimeout(e)?e:t)}isValidTimeout(e){return"number"==typeof(t=e)&&isFinite(t)&&e>=0;var t}pushPrebidQueue(e){this.prebid.pushCommand(e)}};Wr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,Mr,Vr,M])],Wr);const Ur=Wr;let qr=class{logger;prebid;prebidBidFetcher;advertiserResizer;gamDefinedSlotRegistry;constructor(e,t,r,i,n){this.logger=e,this.prebid=t,this.prebidBidFetcher=r,this.advertiserResizer=i,this.gamDefinedSlotRegistry=n}getSizeFilteredAdvertisers(e){const t=this.filterPrebidAdvertisers(e);return 0===t.length?[]:this.advertiserResizer.getResizedAdvertisersForPrebid(t)}getPageLevelTargetings(){return{prebid_version:this.prebid.getVersion(),g_prebid_version:this.prebid.getVersion(),ad_h:(new Date).getUTCHours().toString()}}syncBiddingWithGam(e){const t=this.filterPrebidAdvertisers(e);0!==t.length&&this.prebid.pushCommand(()=>{this.setTargetingForGPTAsync(t)})}async getWinningBids(e){const t=this.filterPrebidAdvertisers(e),r=t.map(e=>e.getAdvertiser());if(0===r.length)return{advertisersToForwardToGam:[],advertisersToCancel:[]};const i=await this.prebidBidFetcher.requestBids(r);return this.debug("Auction result:",i),{advertisersToForwardToGam:t,advertisersToCancel:[]}}setTargetingForGPTAsync(e){const t=this.filterPrebidAdvertisers(e);if(0===t.length)return;const r=t.map(e=>this.buildAdUnitCode(e)),i=t.map(e=>e.getAdvertiser());this.prebid.pushCommand(()=>{this.debug("Set GAM slot targeting for these advertisers",i),this.prebid.setTargetingForGPTAsync(r);const e=i.map(e=>[e,this.gamDefinedSlotRegistry.getTargetings(e.getContainerId())]);this.debug("Slot targetings:",e)})}buildAdUnitCode(e){return e.getContainerId()}isPrebidGamAdvertiser(e){return fr[e.getAdvertiserType()].hasBiddingEnabled||e.getBiddingType()===lr.PREBID}filterPrebidAdvertisers(e){return e.filter(this.isPrebidGamAdvertiser)}debug(...e){this.logger.debug("[PrebidBiddingStrategy] ",...e)}};qr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,Mr,Ur,Or,Lt])],qr);const $r=qr;let Kr=class{logger;constructor(e){this.logger=e}create(e,t,r){switch(t){case lr.AMAZON:return this.createAmazonGamAdvertiser(e,r);case lr.PREBID:return this.createPrebidGamAdvertiser(e,r);case lr.ADSENSE:return this.createAdsenseGamAdvertiser(e,r);default:{const e=`[UnifiedAuctionGamAdvertiserFactory] Invalid bidding type: ${t}`;throw this.logger.error(e),new Error(e)}}}createAmazonGamAdvertiser(e,t){return e.copy({biddingType:lr.AMAZON,settings:this.pickSettings(t,["container","positionName","code","dfpTargets","gamTargets","sizes","floorPrice","skipAmazon"])})}createPrebidGamAdvertiser(e,t){return e.copy({biddingType:lr.PREBID,settings:this.pickSettings(t,["container","positionName","code","dfpTargets","gamTargets","sizes","mediaTypes","bids","pageUrl","timeout","userIdHash","refreshInterval","floorPrice"])})}createAdsenseGamAdvertiser(e,t){return e.copy({biddingType:lr.ADSENSE,settings:this.pickSettings(t,["container","positionName","code","sizes","dfpTargets","gamTargets","adsafe","channel","subtype","query","numberOfAds","number","clickableBackgrounds","gl","hl","linkTarget","numRepeated","pubId","sellerRatings","siteLinks","width","styleId","adsenseEcpm"])})}pickSettings(e,t){const r={};return t.forEach(t=>r[t]=e[t]),r}};Kr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M])],Kr);const Hr=Kr;let Qr=class{factory;constructor(e){this.factory=e}splitUnifiedAuctionAdvertisersByBiddingPlatform(e){return e.flatMap(this.splitUnifiedAuctionAdvertiserByBiddingPlatform.bind(this))}splitUnifiedAuctionAdvertiserByBiddingPlatform(e){const t=e.getSettings();return[this.factory.create(e,lr.AMAZON,t),this.factory.create(e,lr.PREBID,t),this.factory.create(e,lr.ADSENSE,t)]}};Qr=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Hr])],Qr);const Yr=Qr;class Jr{biddingStrategies;unifiedAuctionAdvertiserSplitter;logger=E.resolve(M);constructor(e,t){this.biddingStrategies=e,this.unifiedAuctionAdvertiserSplitter=t}getSizeFilteredAdvertisers(e){if(0===e.length)return this.debug("No GAM Advertisers given to filter"),[];const t=this.unifiedAuctionAdvertiserSplitter.splitUnifiedAuctionAdvertisersByBiddingPlatform(e);return this.validateSplitGamAdvertisers({gamAdvertisers:e,splitGamAdvertisers:t}),this.biddingStrategies.flatMap(e=>e.getSizeFilteredAdvertisers(t))}getPageLevelTargetings(){return this.biddingStrategies.reduce((e,t)=>({...e,...t.getPageLevelTargetings()}),{})}async getWinningBids(e){if(0===e.length)return this.debug("No GAM Advertisers given to bid"),{advertisersToForwardToGam:[],advertisersToCancel:[]};this.debug("Get winning bids for:",this.extractAdvertisers(e));const t=await this.fetchWinningBids(e);return this.debug("Received all winning bids for:",this.extractAdvertisers(e)),this.debug("Forward gamAdvertisers to GAM:",this.extractAdvertisers(t.advertisersToForwardToGam)),this.debug("Cancelling gamAdvertisers:",this.extractAdvertisers(t.advertisersToCancel)),t}syncBiddingWithGam(e){0!==e.length?this.biddingStrategies.forEach(t=>t.syncBiddingWithGam(e)):this.debug("No GAM Advertisers given to sync")}async fetchWinningBids(e){const t=(await Promise.all(this.biddingStrategies.map(t=>t.getWinningBids(e)))).reduce((e,t)=>({advertisersToForwardToGam:[...e.advertisersToForwardToGam,...t.advertisersToForwardToGam],advertisersToCancel:[...e.advertisersToCancel,...t.advertisersToCancel]}),{advertisersToForwardToGam:[],advertisersToCancel:[]});return{advertisersToForwardToGam:t.advertisersToForwardToGam,advertisersToCancel:this.getAdvertisersToCancelForUnifiedAuction(t)}}getAdvertisersToCancelForUnifiedAuction({advertisersToCancel:e,advertisersToForwardToGam:t}){return e.filter(e=>!t.map(e=>e.getContainerId()).includes(e.getContainerId()))}extractAdvertisers(e){return e.map(e=>e.getAdvertiser())}validateSplitGamAdvertisers({gamAdvertisers:e,splitGamAdvertisers:t}){const r=e.length*this.biddingStrategies.length;if(t.length!==r)throw Error(`[UnifiedAuction] ${t.length} split advertisers did not match ${r} GamAdvertisers.`)}debug(...e){this.logger.debug("[UnifiedAuctionBiddingStrategy] ",...e)}}class Zr{bidResponseMapper;amazonPublisherServicesTag;constructor(e,t){this.bidResponseMapper=e,this.amazonPublisherServicesTag=t}async fetchNativeTargetings(e){return window.aps.record("ad/targeting/fetch",{itemIds:e})}async defineNativeSlots(e){return window.aps.record("ad/slot/define",{imp:e})}async attachNativeTargeting(e){return window.aps.record("ad/targeting/attach",{itemIds:e,adServer:Se.GOOGLE_TAG})}async requestBids(e){return new Promise(t=>{const r={slots:e,timeout:2e3};this.amazonPublisherServicesTag.fetchBids(r,e=>{t({bidResponses:e.map(this.bidResponseMapper.map)})})})}}class Xr{cpmByAmazonBidId;constructor(e){this.cpmByAmazonBidId=new Map(Object.entries(e)),this.map=this.map.bind(this)}map(e){return{slotID:e.slotID,amznbid:e.amznbid,cpm:this.cpmByAmazonBidId.get(String(e.amznbid))||0}}}const ei={"1demjuo":.01,vncjcw:.02,"1v5wkcg":.03,"50fim8":.04,"14izjls":.05,mrpj40:.06,"1ma9k3k":.07,"9g90qo":.08,"18yt1q8":.09,r7j18g:.1,"1qq3280":.11,km0hs:.12,"10361hc":.13,ibw0zk:.14,"1hug1z4":.15,g3z9xc:.16,"1fmjaww":.17,xv9af4:.18,"1xdtbeo":.19,"78c9og":.2,"16qwao0":.21,ozma68:.22,"1oi6b5s":.23,bo5rsw:.24,"1b6pssg":.25,tffsao:.26,"1sxzta8":.27,"2sirk0":.28,"12b2sjk":.29,kjss1s:.3,"1k2ct1c":.31,f00we8:.32,"1eikxds":.33,wraww0:.34,"1w9uxvk":.35,"64dw5c":.36,"15mxx4w":.37,nvnwn4:.38,"1ne7xmo":.39,ak7e9s:.4,"1a2rf9c":.41,sbherk:.42,"1ru1fr4":.43,"1oke0w":.44,"1174f0g":.45,jfueio:.46,"1iyefi8":.47,h7xngg:.48,"1gqhog0":.49,yz7ny8:.5,"1yhroxs":.51,"8can7k":.52,"17uuo74":.53,q3knpc:.54,"1pm4oow":.55,cs45c0:.56,"1cao6bk":.57,uje5ts:.58,"1u1y6tc":.59,"3wh534":.6,"13f162o":.61,lnr5kw:.62,"1l6b6kg":.63,dc3c3k:.64,"1cund34":.65,v3dclc:.66,"1ulxdkw":.67,"4ggbuo":.68,"13z0cu8":.69,m7qccg:.7,"1lqadc0":.71,"8w9tz4":.72,"18etuyo":.73,qnjugw:.74,"1q63vgg":.75,mtq8:.76,zj6ups:.77,hrwu80:.78,"1hagv7k":.79,fk035s:.8,"1f2k45c":.81,xba3nk:.82,"1wtu4n4":.83,"6od2ww":.84,"166x3wg":.85,ofn3eo:.86,"1ny74e8":.87,b46l1c:.88,"1amqm0w":.89,svglj4:.9,"1se0mio":.91,"28jksg":.92,"11r3ls0":.93,jztla8:.94,"1jidm9s":.95,eg1pmo:.96,"1dylqm8":.97,w7bq4g:.98,"1vpvr40":.99,"5kepds":1,"152yqdc":1.01,nbopvk:1.02,"1mu8qv4":1.03,a087i8:1.04,"19is8hs":1.05,rri800:1.06,"1ra28zk":1.07,"14l79c":1.08,"10n588w":1.09,ivv7r4:1.1,"1ief8qo":1.11,gnygow:1.12,"1g6ihog":1.13,yf8h6o:1.14,"1xxsi68":1.15,"7sbgg0":1.16,"17avhfk":1.17,pjlgxs:1.18,"1p25hxc":1.19,c84ykg:1.2,"1bqozk0":1.21,tzez28:1.22,"1thz01s":1.23,"3chybk":1.24,"12v1zb4":1.25,l3rytc:1.26,"1kmbzsw":1.27,e6248w:1.28,"1dom58g":1.29,vxc4qo:1.3,"1vfw5q8":1.31,"5af400":1.32,"14sz4zk":1.33,n1p4hs:1.34,"1mk95hc":1.35,"9q8m4g":1.36,"198sn40":1.37,rhimm8:1.38,"1r02nls":1.39,ullvk:1.4,"10d5mv4":1.41,ilvmdc:1.42,"1i4fncw":1.43,gdyvb4:1.44,"1fwiwao":1.45,y58vsw:1.46,"1xnswsg":1.47,"7ibv28":1.48,"170vw1s":1.49,p9lvk0:1.5,"1os5wjk":1.51,by5d6o:1.52,"1bgpe68":1.53,tpfdog:1.54,"1t7zeo0":1.55,"32icxs":1.56,"12l2dxc":1.57,ktsdfk:1.58,"1kccef4":1.59,fa0hs0:1.6,"1eskirk":1.61,x1ai9s:1.62,"1wjuj9c":1.63,"6edhj4":1.64,"15wxiio":1.65,o5ni0w:1.66,"1no7j0g":1.67,au6znk:1.68,"1acr0n4":1.69,slh05c:1.7,"1s4114w":1.71,"1yjzeo":1.72,"11h40e8":1.73,jptzwg:1.74,"1j8e0w0":1.75,hhx8u8:1.76,"1h0h9ts":1.77,z979c0:1.78,"1yrrabk":1.79,"8ma8lc":1.8,"184u9kw":1.81,qdk934:1.82,"1pw4a2o":1.83,d23qps:1.84,"1cknrpc":1.85,utdr7k:1.86,"1ubxs74":1.87,"46gqgw":1.88,"13p0rgg":1.89,lxqqyo:1.9,"1lgary8":1.91,dm2xhc:1.92,"1d4mygw":1.93,vdcxz4:1.94,"1uvwyyo":1.95,"4qfx8g":1.96,"148zy80":1.97,mhpxq8:1.98,"1m09yps":1.99,"969fcw":2,xl9p1c:2.1,"2ij668":2.2,nlob9c:2.3,gxy22o:2.4,u9ekg0:2.5,"55fbb4":2.6,igvtog:2.7,bt5khs:2.8,wwapkw:2.9,"1tk6ps":3,q8kge8:3.1,dh34sg:3.2,qsjn5s:3.3,"6tcvls":3.4,k4tdz4:3.5,a58074:3.6,yk89vk:3.7,"3hhr0g":3.8,n6ox6o:3.9,giyo00:4,tuf6dc:4.1,"6jda80":4.2,jutslc:4.3,d73jeo:4.4,vicqo0:4.5,fm7sw:4.6,oumhhc:4.7,ev13pc:4.8,s6hm2o:4.9,"87auio":5,lircw0:5.1,"9iqx34":5.2,xxr6rk:5.3,"2v0nwg":5.4,ny5szk:5.5,hafjsw:5.6,ulw268:5.7,"4iy874":5.8,hueqkg:5.9,b6ohds:6,w9tmgw:6.1,"1733ls":6.2,pm3da8:6.3,e8k0lc:6.4,rk0iyo:6.5,"7ktreo":6.6,kwa9s0:6.7,awow00:6.8,zbp5og:6.9,"48ymtc":7,mk7u2o:7.1,fwhkw0:7.2,t7y39c:7.3,"5ww740":7.4,j8cphc:7.5,ckmgao:7.6,vuu8e8:7.7,s3pj4:7.8,p73z7k:7.9,f7ilfk:8,siz3sw:8.1,"8jsc8w":8.2,lv8um8:8.3,"93rj0g":8.4,xirsow:8.5,"2g19ts":8.6,nj6eww:8.7,gvg5q8:8.8,u6wo3k:8.9,"5hwt1c":9,itdbeo:9.1,c5n280:9.2,x8s7b4:9.3,"261og0":9.4,ql1y4g:9.5,dtkmio:9.6,r514w0:9.7,"75udc0":9.8,khavpc:9.9,ahphxc:10,ywprls:10.1,"3tz8qo":10.2,msyha8:10.3,g5883k:10.4,tgoqgw:10.5,"65mubk":10.6,jh3cow:10.7,ctd3i8:10.8,v4mark:10.9,"1vrwg":11,ogw1kw:11.1,ehansw:11.2,rsr668:11.3,"7tkem8":11.4,l50wzk:11.5,"9rhkao":11.6,y6htz4:11.7,"33rb40":11.8,o6wg74:11.9,hj670g:12,uumpds:12.1,"4roveo":12.2,i35ds0:12.3,bff4lc:12.4,wik9og:12.5,"1ftqtc":12.6,puu0hs:12.7,e2b9q8:12.8,rdrs3k:12.9,"7el0jk":13,kq1iww:13.1,aqg54w:13.2,z5getc:13.3,"42pvy8":13.4,mdz37k:13.5,fq8u0w:13.6,t1pce8:13.7,"5qng8w":13.8,j23ym8:13.9,cedpfk:14,w3kvls:14.1,"10ucqo":14.2,pfumf4:14.3,fg98n4:14.4,srpr0g:14.5,"8sizgg":14.6,m3zhts:14.7,"9ci680":14.8,xrifwg:14.9,"2orx1c":15,nrx24g:15.1,h46sxs:15.2,ufnbb4:15.3,"546d4w":15.4,ifmvi8:15.5,brwmbk:15.6,wv1reo:15.7,"1sb8jk":15.8,q7bi80:15.9,dfu6m8:16,qraozk:16.1,"6s3xfk":16.2,k3kfsw:16.3,a3z20w:16.4,yizbpc:16.5,"3g8su8":16.6,n5fz0g:16.7,ghppts:16.8,tt6874:16.9,"6i4c1s":17,jtkuf4:17.1,d5ul8g:17.2,vh3shs:17.3,ed9mo:17.4,otdjb4:17.5,ets5j4:17.6,s58nwg:17.7,"861wcg":17.8,lhieps:17.9,"9ozny8":18,y3zxmo:18.1,"319erk":18.2,o4ejuo:18.3,hgoao0:18.4,us4t1c:18.5,"4p6z28":18.6,i0nhfk:18.7,bcx88w:18.8,wg2dc0:18.9,"1dbugw":19,psc45c:19.1,eesrgg:19.2,rq99ts:19.3,"7r2i9s":19.4,l2j0n4:19.5,b2xmv4:19.6,zhxwjk:19.7,"4f7dog":19.8,mqgkxs:19.9,g2qbr4:20,vmq29s:20.5,"8bo64g":21,nb28sg:21.5,bxiw3k:22,qwwyrk:22.5,"3lv2m8":23,jk7q4g:23.5,ekf18g:24,y9m7eo:24.5,"4ut8u8":25,pxydxc:25.5,am2tj4:26,sxc0sg:26.5,wh14w:27,lzm680:27.5,gzthc0:28,wy64u8:28.5,"6v8av4":29,n8kcg0:29.5,d8yyo0:30,s8d1c0:30.5,"2t58n4":31,hsjbb4:31.5,e6olc0:32,z9tqf4:32.5,"5v0ruo":33,p58jy8:33.5,"91w3r4":34,u518u8:34.5,"24696o":35,kffgg0:35.5,g73ncw:36,v6hq0w:36.5,"7vftvk":37,o8rvgg:37.5,bhajuo:38,rfn7cw:38.5,"44lb7k":39,j3zdvk:39.5,fi4nwg:40,xtdv5s:40.5,"50qr5s":41,q3vw8w:41.5,a0jg1s:42,tpqm80:42.5,axnnk:43,le2sqo:43.5,hd8oow:44,wcmrcw:44.5,"7nmwao":45,mn0yyo:45.5,cnfl6o:46,seajnk:46.5,"2bcpog":47,ioor9c:47.5,dow2dc:48,ys17gg:48.5,"6c6tq8":49,ong0zk:49.5,"9y1jpc":50};let ti=class{store;advertiserResizer;gamDefinedSlotRegistry;amazonTagLoader;amazonNativeTagLoader;googleTagLoader;prebidTagLoader;adsenseTagLoader;criteoTagLoader;aaxTagLoader;advertisingWebRendererTagLoader;noBiddingStrategy;adsenseFetcher=E.resolve(Pe);constructor(e,t,r,i,n,s,o,a,c,l,d,u){this.store=e,this.advertiserResizer=t,this.gamDefinedSlotRegistry=r,this.amazonTagLoader=i,this.amazonNativeTagLoader=n,this.googleTagLoader=s,this.prebidTagLoader=o,this.adsenseTagLoader=a,this.criteoTagLoader=c,this.aaxTagLoader=l,this.advertisingWebRendererTagLoader=d,this.noBiddingStrategy=u}buildBiddingFetchers(){const e=this.googleTagLoader.load(),t=E.resolve($r),r=this.buildGamFetcher(e,re.DISPLAY_WEB_PREBID,t),i="B"===this.store.getExperimentVariant(et),n=i?this.amazonNativeTagLoader.load():this.amazonTagLoader.load(),s=new Zr(new Xr(ei),n),o=new Nr(this.advertiserResizer,i?this.amazonNativeTagLoader.load():this.amazonTagLoader.load(),s,this.store),a=E.resolve(xr),c=this.buildGamFetcher(e,re.DISPLAY_WEB_AMAZON,o),l=E.resolve(Yr);return[r,c,this.buildGamFetcher(this.googleTagLoader.load(),re.DISPLAY_WEB_UNIFIED_AUCTION,new Jr([t,o,a],l))]}buildAaxFetcher(){return this.store.isAdblockerEnabled()?(this.store.isFeatureEnabled(Q.AAX)&&this.aaxTagLoader.load(),this.buildNoBiddingGamFetcher(this.googleTagLoader.load(),re.DISPLAY_WEB_AAX)):new Rr(re.DISPLAY_WEB_AAX)}buildIgniteFetchers(){const e=this.advertisingWebRendererTagLoader.load();return[this.buildIgniteFetcher(e,re.AFFILIATESHUB_WEB),this.buildIgniteFetcher(e,re.IGNITE_WEB),this.buildIgniteFetcher(e,re.IGNITE_MWEB)]}buildNoBiddingGamFetcher(e,t){return this.buildGamFetcher(e,t,this.noBiddingStrategy)}buildGamFetcher(e,t,r){return new Ar(e,this.store,t,r)}buildIgniteFetcher(e,t){return new St(e,t)}buildBingFetcher(){const e=this.advertisingWebRendererTagLoader.load();return new Tt(e,re.BING_WEB)}buildCriteoFetcher(){return new Ct(this.criteoTagLoader.load())}buildDisplayWebFetcher(){return this.buildNoBiddingGamFetcher(this.googleTagLoader.load(),re.DISPLAY_WEB)}buildFirstPartyPlaFetcher(){const e=this.advertisingWebRendererTagLoader.load();return new Et(e,re.FIRST_PARTY_PLA)}};ti=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,Or,Lt,Ge,Me,qe,Ke,Ie,We,xe,Ne,Pr])],ti);const ri=ti;let ii=class{lazyFetcherBuilder;fetchers={};adsenseFetcher=E.resolve(Pe);constructor(e){this.lazyFetcherBuilder=e}getFetcher(e){this.fetchers[e]||this.loadMissingFetchers(e);const t=this.fetchers[e];if(t)return t;throw new Error(`Fetcher ${e} is unknown`)}loadMissingFetchers(e){this.buildRelatedFetchers(e).forEach(e=>{this.fetchers[e.getAdvertiserType()]=e})}buildRelatedFetchers(e){switch(e){case re.ADSENSE_WEB:return[this.adsenseFetcher];case re.DISPLAY_WEB:return[this.lazyFetcherBuilder.buildDisplayWebFetcher()];case re.DISPLAY_WEB_AAX:return[this.lazyFetcherBuilder.buildAaxFetcher()];case re.ADBLOCK_CRITEO_WEB:return[this.lazyFetcherBuilder.buildCriteoFetcher()];case re.AFFILIATESHUB_WEB:case re.IGNITE_WEB:case re.IGNITE_MWEB:return this.lazyFetcherBuilder.buildIgniteFetchers();case re.BING_WEB:return[this.lazyFetcherBuilder.buildBingFetcher()];case re.DISPLAY_WEB_PREBID:case re.DISPLAY_WEB_AMAZON:case re.DISPLAY_WEB_UNIFIED_AUCTION:return this.lazyFetcherBuilder.buildBiddingFetchers();case re.FIRST_PARTY_PLA:return[this.lazyFetcherBuilder.buildFirstPartyPlaFetcher()];default:throw new Error(`Advertiser '${e}' is unknown.`)}}};ii=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[ri])],ii);const ni=ii;let si=class{metrics;lazyFetcherLoader;constructor(e,t){this.metrics=e,this.lazyFetcherLoader=t}async fetchBackfills(e){const t=e.getBackFillAdvertisers();let r={filled:!1,fillInformation:{},advertiser:e.firstAdvertiser()};this.hasFills(t)?e.debug("Fetch backfill..."):e.debug("No backfill. Abort!");for(const i of t){if(e.htmlSlot.cleanContainer(),r=await this.fetchFromAdvertiser(i,e),r.filled)break;e.debug(`Backfill by ${i.type} failed`)}return e.handleBackfillFetchResult(r)}fetchFromAdvertiser(e,t){const r=this.lazyFetcherLoader.getFetcher(e.type);return t.debug(`Load ${r.getAdvertiserType()} ad...`),this.metrics.incrementAdvertiserRequestMetric(e),r.fetchAd(e)}hasFills(e){return e.length>0}};si=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[ce,ni])],si);const oi=si;let ai=class{documentWrapper;windowWrapper;intersectionObserver=null;observedSlots=new Set;viewableSlots=new Set;constructor(e,t){this.documentWrapper=e,this.windowWrapper=t,this.createIntersectionObserver()}resetState(){this.observedSlots.clear(),this.viewableSlots.clear(),this.createIntersectionObserver()}observe(e){const t=e.htmlSlot.getDomElementOrThrow();null!==this.intersectionObserver&&(this.observedSlots.add(e),this.intersectionObserver.observe(t))}isSlotViewable(e){return!this.hasIntersectionObserver()&&!this.hasVisibilityState()||(this.hasIntersectionObserver()?"visible"===this.documentWrapper.get().visibilityState&&this.viewableSlots.has(e):"visible"===this.documentWrapper.get().visibilityState)}getIntersectionObserverConfig(){return{threshold:.5}}handleIntersection(e){e.forEach(e=>{const t=e.target,r=this.getSlotByPositionName(t.getAttribute("data-liberty-position-name"));r&&(e.isIntersecting?(this.viewableSlots.add(r),t.setAttribute("data-liberty-is-viewable","true")):(this.viewableSlots.delete(r),t.setAttribute("data-liberty-is-viewable","false")))})}getSlotByPositionName(e){return Array.from(this.observedSlots).find(t=>t.positionName===e)}hasIntersectionObserver(){return"IntersectionObserver"in this.windowWrapper.get()}hasVisibilityState(){return"visibilityState"in this.documentWrapper.get()}createIntersectionObserver(){this.hasIntersectionObserver()&&(this.intersectionObserver&&this.intersectionObserver.disconnect(),this.intersectionObserver=new IntersectionObserver(this.handleIntersection.bind(this),this.getIntersectionObserverConfig()))}};ai=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[K,q])],ai);const ci=ai;class li{slot;slotFillEvent;constructor(e){this.slot=e,e.onLoadDone(e=>{e.isFilled&&(this.slotFillEvent=e)})}isRefreshable(){if(void 0===this.slotFillEvent)return!0;const e=this.slotFillEvent.gamAdvertiserId;return null==e||Yt.includes(e)}}class di{slot;refreshCount=-1;logger=E.resolve(M);slotObserver=E.resolve(ci);filledAdvertiserRefreshRule;constructor(e){this.slot=e,this.filledAdvertiserRefreshRule=new li(e),e.isPresentInDom()&&this.slotObserver.observe(e)}isRefreshPossible(){const e=this.isRefreshIntervalEnabled(),t=this.isFilledAdvertiserRefreshable(),r=this.slotObserver.isSlotViewable(this.slot);return this.logger.debug(`[Slot ${this.slot.containerId}] refresh status:`,{isRefreshIntervalEnabled:e,isFilledAdvertiserRefreshable:t,isViewable:r,refreshCount:this.refreshCount}),e&&t&&r}getRefreshCount(){return this.refreshCount}incrementRefreshCount(){this.refreshCount++}isRefreshIntervalEnabled(){return Boolean(this.slot.firstAdvertiser().settings.refreshIntervalEnabled)}isFilledAdvertiserRefreshable(){return this.filledAdvertiserRefreshRule.isRefreshable()}}class ui{isBackfill;positionName;positionId;slotRefreshCount;adSettingId;adSettingName;type;settings;trackingCode;biddingType;constructor(e,t=!1,r,i,n){this.isBackfill=t,this.positionName=r,this.positionId=i,this.slotRefreshCount=n,this.adSettingId=e.adSettingId,this.adSettingName=e.adSettingName,this.type=e.type,this.trackingCode=e.trackingCode,this.settings=e.settings,this.biddingType=e.biddingType}getContainerId(){return this.settings.container}isValid(){return this.isSizeValid()}copy({settings:e,advertiserType:t,biddingType:r}){const i={adSettingId:this.adSettingId,adSettingName:this.adSettingName,settings:e||this.settings,trackingCode:this.trackingCode,type:t||this.type,biddingType:r||this.biddingType};return new ui(i,this.isBackfill,this.positionName,this.positionId,this.slotRefreshCount)}isSizeValid(){return!(void 0===this.settings.sizes&&fr[this.type].requiresSize)}isOutOfPage(){return!!this.settings.isInterstitial}}class gi{containerId;config;adblocking;lazy;reportMissingSlot;htmlSlot;logger=E.resolve(M);backfillFetcher=E.resolve(oi);trackingCode;positionName;refreshCapability;slotFillListeners=[];constructor(e,t,r,i,n,s){this.containerId=e,this.config=t,this.adblocking=r,this.lazy=i,this.reportMissingSlot=n,this.htmlSlot=s,this.trackingCode=t.trackingCode,this.positionName=t.positionName,this.refreshCapability=new di(this)}onLoadDone(e){this.slotFillListeners.push(e)}publishLoadDone(e,t,r){this.slotFillListeners.forEach(i=>{i({advertiser:e,isFilled:t,gamAdvertiserId:r.gamAdvertiserId})})}getRefreshCapability(){return this.refreshCapability}isPresentInDom(){return this.htmlSlot.isPresentInDom()}isValid(){return this.hasValidAdvertisers()&&this.isPresentInDom()}isVisible(){return this.htmlSlot.isVisible()}isLazy(){return this.lazy}isMissingSlotReportingEnabled(){return this.reportMissingSlot}setupHtmlContainer(){this.htmlSlot.cleanVisibility(),this.htmlSlot.setContainerId(this.containerId)}setSlotLoaded(e,t,r){this.publishLoadDone(t,e,r)}setVisibility(e){this.htmlSlot.setVisibility(e)}firstAdvertiser(){return this.getAdvertisers()[0]}getBackFillAdvertisers(){return this.getAdvertisers().slice(1)}async handlePrimaryFetchResult(e){const{advertiser:t,filled:r}=e;return r?this.resolveFill(t,e.fillInformation):await this.fetchBackfills()}async handleBackfillFetchResult(e){const{advertiser:t,filled:r}=e;return r?this.resolveFill(t,e.fillInformation):this.abortFill(t)}async fetchBackfills(){return this.backfillFetcher.fetchBackfills(this)}getAdvertisers(){let e="advertisers";return this.adblocking&&this.config.adblockAdvertisers.length>0&&(e="adblockAdvertisers"),this.buildAdvertisers(e)}buildAdvertisers(e){const t=[],r=this.config[e];for(let e=0;e<r.length;e++){const i=e>0;t.push(new ui({...r[e],trackingCode:this.trackingCode,settings:{...r[e].settings,container:this.containerId,positionName:this.config.positionName}},i,this.config.positionName,this.config.positionId,this.refreshCapability.getRefreshCount()))}return t}resolveFill(e,t){return this.setSlotLoaded(!0,e,t),this.debug(`Filled by ${e.type}`),{containerId:this.containerId,type:e.type,filled:!0}}abortFill(e){return this.setSlotLoaded(!1,e,{}),this.htmlSlot.cleanContainer(),this.debug(`Not filled by ${e.type}`),{containerId:this.containerId,type:e.type,filled:!1}}hasValidAdvertisers(){return this.getAdvertisers().some(e=>e.isValid())}debug(...e){this.logger.debug(`Slot ${this.containerId}: `,...e)}}let fi=class{logger;libertyPerformanceMarker;slotPerformance;metrics;windowWrapper;constructor(e,t,r,i,n){this.logger=e,this.libertyPerformanceMarker=t,this.slotPerformance=r,this.metrics=i,this.windowWrapper=n}createSlot(e){const t=new gi(this.buildContainerId(e),e.slotConfig,e.adblocking,e.lazy,e.reportMissingSlot,this.createHtmlSlot(e));return this.setupEventPublishing(t),this.setupTracking(t,e),this.setupClickTracking(e,t),t}buildContainerId(e){return`${e.slotConfig.positionName}`}setupEventPublishing(e){e.onLoadDone(t=>{this.windowWrapper.get().postMessage({event:"liberty.slot.loaded",payload:{positionName:e.positionName,containerId:e.containerId,advertiser:t.advertiser.type,isBackfill:t.advertiser.isBackfill,filled:t.isFilled}},"*")})}setupTracking(e,t){e.onLoadDone(r=>{this.libertyPerformanceMarker.loadingDone(e.containerId);const i=this.slotPerformance.getPerformanceDurationList(e.containerId);this.logger.debug("Performance",i),r.isFilled&&r.advertiser&&(this.metrics.incrementAdvertiserFillMetric(r.advertiser,i),t.adblocking||this.checkSlotVisibility(e,r.advertiser))})}checkSlotVisibility(e,t){e.isVisible()||t.isOutOfPage()||this.logger.error(`Slot container ${e.containerId} is not visible in DOM.`)}setupClickTracking(e,t){new le(this.getClickDetector(e.clickTrackingImprovementLabsVariant),e.enableClickTracking).setupClickTracking(t)}getClickDetector(e){return e===C.V1?new ue:new de(E.resolve(M))}createHtmlSlot(e){const t=e.slotConfig.positionName;return new Ae(t)}};fi=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,he,ye,ce,q])],fi);const hi=fi;let pi=class{store;slotFactory;constructor(e,t){this.store=e,this.slotFactory=t}buildSlotsByContainerId(){const e={};return this.buildSlots().forEach(t=>{e[t.containerId]=t}),e}buildSlots(){return this.store.getSlotConfigs().map(e=>{const t=this.store.getSlotOptionsByPositionName(e.positionName),r=Boolean(t.lazy);return this.slotFactory.createSlot({slotConfig:e,adblocking:this.store.isAdblockerEnabled(),lazy:r,enableClickTracking:this.store.isFeatureEnabled(Q.CLICK_TRACKING),clickTrackingImprovementLabsVariant:this.store.getClickTrackingImprovementLabsVariant(),reportMissingSlot:t.reportMissingSlot??!0})})}};pi=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,hi])],pi);const yi=pi;class vi{slotsByContainerId;constructor(e){this.slotsByContainerId=e}getSlots(){return Object.values(this.slotsByContainerId)}getSlot(e){return this.slotsByContainerId[e]}getSlotsByPositionNames(e){return this.getSlots().filter(t=>e.includes(t.positionName))}getLazySlots(){return this.getSlots().filter(e=>e.isLazy())}getNonLazySlots(){return this.getSlots().filter(e=>!e.isLazy())}}let mi=class{logger=E.resolve(M);rejectInvalidSlots(e){const t=e.filter(e=>e.isValid()),r=e.filter(e=>!e.isValid()),i=[];return t.forEach(e=>{try{e.setupHtmlContainer(),i.push(e)}catch(t){this.logger.error(t),r.push(e)}}),this.addLogForMissingSlots(r),[i,r]}fromRejectedSlotsToPromises(e){return e.map(async e=>Promise.resolve({containerId:e.containerId,filled:!1,type:void 0}))}addLogForMissingSlots(e){e.forEach(async e=>{const t=e.hasValidAdvertisers(),r=e.isPresentInDom();if(t&&!r){const t=`Slot ${e.containerId} has a valid advertiser but is not present in the DOM`;e.isMissingSlotReportingEnabled()?this.logger.error(t):this.logger.debug(t)}else this.logger.debug(`Slot ${e.containerId} not valid. isPresentInDom: ${r}, existsAdvertiser: ${t}`)})}};mi=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],mi);let bi=class{createFromContainerFetchResult(e){return{advertiser:e.advertiser,filled:e.filled,fillInformation:e.fillInformation}}};bi=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],bi);const wi=bi;let Ai=class{logger;libertyPerformanceMarker;slotContainerFetchResultFactory;metrics;lazyFetcherLoader;constructor(e,t,r,i,n){this.logger=e,this.libertyPerformanceMarker=t,this.slotContainerFetchResultFactory=r,this.metrics=i,this.lazyFetcherLoader=n}selectAndFetchPrimarySlots(e,t,r){const i=this.selectPrimarySlots(e,r);return this.fetchPrimarySlots(e,t,i)}selectPrimarySlots(e,t){return t.filter(t=>t.firstAdvertiser().type===e)}fetchPrimarySlots(e,t,r){const i=r.map(e=>e.firstAdvertiser());this.logger.debug(`Load ${r.length} primary ${e} slots`,r.map(e=>e.containerId)),this.libertyPerformanceMarker.loadingAll(r);let n=[];try{i.forEach(e=>this.metrics.incrementAdvertiserRequestMetric(e)),n=this.lazyFetcherLoader.getFetcher(e).fetchAds(i)}catch(t){t instanceof Error&&this.logger.error(new Error(`Fetching ads failed for ${e}: ${t.message}`))}return n.map(async e=>{const r=await e,i=this.slotContainerFetchResultFactory.createFromContainerFetchResult(r);return t.getSlot(r.containerId).handlePrimaryFetchResult(i)})}};Ai=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,he,wi,ce,ni])],Ai);const Ri=Ai;class Si{slotCollection;documentWrapper=E.resolve(K);primaryFetcher=E.resolve(Ri);slotRejecter=E.resolve(mi);constructor(e){this.slotCollection=e}async fill(e){await this.documentWrapper.whenDomReady();const[t,r]=this.slotRejecter.rejectInvalidSlots(e);t.forEach(e=>{e.getRefreshCapability().incrementRefreshCount()});const i=this.fetchPrimaryFill(t);return[...this.slotRejecter.fromRejectedSlotsToPromises(r),...i]}fetchPrimaryFill(e){const t=this.detectRequiredPrimaryAdvertiserTypes(e);return this.fetchSlotsByAdvertiserType(t,e).map(e=>this.handleFetch(e))}fetchSlotsByAdvertiserType(e,t){const r=[];return e.forEach(e=>{r.push(...this.fetchPrimarySlots(e,t))}),r}detectRequiredPrimaryAdvertiserTypes(e){const t=new Set;return e.forEach(e=>{t.add(e.firstAdvertiser().type)}),t}async handleFetch(e){const{containerId:t,type:r,filled:i}=await e;return this.slotCollection.getSlot(t).setVisibility(i),{containerId:t,type:r,filled:i}}fetchPrimarySlots(e,t){return this.primaryFetcher.selectAndFetchPrimarySlots(e,this.slotCollection,t)}}let Ei=class{logger;documentWrapper;slotBuilder;slotRefresher;slotFiller;slotCollection;constructor(e,t,r,i){this.logger=e,this.documentWrapper=t,this.slotBuilder=r,this.slotRefresher=i}initizialise(){const e=this.slotBuilder.buildSlotsByContainerId();this.slotCollection=new vi(e),this.slotFiller=new Si(this.slotCollection)}async fillNonLazySlotsWithAds(){return void 0===this.slotFiller||void 0===this.slotCollection?Promise.reject(new Error("Controller is not yet initialized")):(this.slotRefresher.enableRefreshing(this.slotFiller,this.slotCollection.getSlots()),this.warnExistenceOfLazySlots(),await this.slotFiller.fill(this.getNonLazySlots()))}async fillSlotsWithAdsFilteredBy(e){if(void 0===this.slotCollection||void 0===this.slotFiller)throw new Error("Controller is not yet initialized");const t=this.slotCollection.getSlotsByPositionNames(e);return await this.slotFiller.fill(t)}async fillLazySlotWithAds(e){if(await this.documentWrapper.whenDomReady(),void 0===this.slotCollection||void 0===this.slotFiller)return Promise.reject(new Error("Controller is not yet initialized"));const t=e,r=this.slotCollection.getSlot(t);if(r){if(!r.isLazy())throw new Error(`Slot '${t}' needs to be marked as lazy in options.slots`);return(await this.slotFiller.fill([r]))[0]}}warnExistenceOfLazySlots(){const e=this.slotCollection?.getLazySlots()||[];e.length>0&&this.logger.debug(`Ignoring ${e.length} lazy slot(s). Use liberty.loadLazySlot to load them.`)}getNonLazySlots(){return this.slotCollection?.getNonLazySlots()||[]}};Ei=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([k(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,K,yi,ee])],Ei);const Ti=Ei;var ki;!function(e){e.DESKTOP="DESKTOP",e.MWEB="MWEB",e.DESKTOP_ASTRO="desktop-astro"}(ki||(ki={}));const Ii=ki;let _i=class{logger;environment;constructor(e,t){this.logger=e,this.environment=t}async increaseAdBlockerCount(e){await this._sendToEndpoint("/ad-blocker",e)}async increaseAdRequestCount(e){await this._sendToEndpoint("/ad-requests",e)}async increaseAdClickCount(e){await this._sendToEndpoint("/ad-clicks",e)}async recordDoneTime(e){await this._sendToEndpoint("/done",e)}async increaseAdImpressionCount(e){await this._sendToEndpoint("/ad-impressions",e)}async increaseInitCount(e){await this._sendToEndpoint("/init",e)}async increaseMissingQueryCount(e){await this._sendToEndpoint("/missing-query",e)}async increaseNoJsCount(e){await this._sendToEndpoint("/no-js",e)}async recordInterstitialEvent(e){await this._sendToEndpoint("/interstitial-event",e)}async recordInterstitialImpression(e){await this._sendToEndpoint("/interstitial-impression",e)}async _sendToEndpoint(e,t){try{const r=await fetch(this.environment.getReportingServiceBaseUrl()+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const i=await r.json();this.logger.error(new Error(`LRS response fails for the endpoint ${e}. Status: ${r.status}, Detail: ${i.detail}, data: ${JSON.stringify(t)}`))}}catch(t){this.logger.error(new Error(`Sending metric to LRS failed for the endpoint ${e}. Error: ${t}`))}}};_i=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,O])],_i);const Oi=_i;let Ci=class{libertyReportingServiceClient;store;metrics;constructor(e,t,r){this.libertyReportingServiceClient=e,this.store=t,this.metrics=r}listenOn(){this.metrics.onChange(({type:e,value:t})=>{switch(e){case se.AD_BLOCKER_ACTIVE:this.increaseAdBlockCount(t);break;case se.ADVERTISER_REQUESTS:this.increaseAdvertiserRequests(t);break;case se.ADVERTISER_CLICKS:this.increaseAdvertiserClicks(t);break;case se.DONE_TIME:this.recordDoneTime(t);break;case se.ADVERTISER_FILLS:this.increaseAdvertiserFills(t);break;case se.DURATION_FROM_FIRST_JS_TO_LIBERTY_INIT:this.increaseInitCount(t);break;case se.MISSING_QUERY:this.increaseMissingQueryCount();break;case se.INTERSTITIAL_EVENT:this.recordInterstitialEvent(t);break;case se.INTERSTITIAL_IMPRESSION:this.recordInterstitialImpression(t)}})}recordInterstitialEvent(e){const t=this.buildEvent({eventName:e,clientVersion:E.resolve(O).getVersion(),trafficSplitGroup:this.store.getGroupName()});this.libertyReportingServiceClient.recordInterstitialEvent(t)}recordInterstitialImpression(e){const t=this.buildEvent({eventName:e,clientVersion:E.resolve(O).getVersion(),trafficSplitGroup:this.store.getGroupName()});this.libertyReportingServiceClient.recordInterstitialImpression(t)}increaseMissingQueryCount(){const e=this.buildEvent({});this.libertyReportingServiceClient.increaseMissingQueryCount(e)}increaseInitCount(e){const t=this.buildEvent({beginDuration:e,isFullConsentGiven:this.store.isConsentGiven(gt.GDPR_ADVERTISING_FULL_CONSENT),floorPriceActive:gr(this.store),trafficSplitGroup:this.store.getGroupName()});this.libertyReportingServiceClient.increaseInitCount(t)}increaseAdvertiserFills(e){const{positionName:t,advertiserType:r,isBackfill:i,slotRefreshCount:n,slotInitLoadingDuration:s,slotHeaderBiddingLoadingDuration:o,slotGamLoadingDuration:a,slotLoadingDuration:c,slotTotalLoadingDuration:l}=e,d=this.buildEvent({adType:r.toUpperCase(),positionName:t,isBackfill:i,floorPriceActive:gr(this.store),slotRefreshCount:n,slotInitLoadingDuration:s,slotHeaderBiddingLoadingDuration:o,slotGamLoadingDuration:a,slotLoadingDuration:c,slotTotalLoadingDuration:l});this.libertyReportingServiceClient.increaseAdImpressionCount(d)}recordDoneTime(e){const t=this.buildEvent({executionDuration:e,isFullConsentGiven:this.store.isConsentGiven(gt.GDPR_ADVERTISING_FULL_CONSENT),floorPriceActive:gr(this.store)});this.libertyReportingServiceClient.recordDoneTime(t)}increaseAdvertiserClicks(e){const{positionName:t,advertiserType:r,isBackfill:i}=e,n=this.buildEvent({adType:r.toUpperCase(),positionName:t,isBackfill:i,floorPriceActive:gr(this.store)});this.libertyReportingServiceClient.increaseAdClickCount(n)}increaseAdvertiserRequests(e){const{advertiserType:t}=e,r=this.buildEvent({adType:t.toUpperCase(),floorPriceActive:gr(this.store)});this.libertyReportingServiceClient.increaseAdRequestCount(r)}increaseAdBlockCount(e){if(1===e){const e=this.buildEvent({});this.libertyReportingServiceClient.increaseAdBlockerCount(e)}}buildEvent(e){return{platform:this.getMetricsPlatform(),pageType:this.store.getPageType(),...e}}getMetricsPlatform(){return this.store.getClient()===Ii.DESKTOP_ASTRO?"WEB":this.store.getPlatform()}};Ci=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Oi,W,ce])],Ci);const Pi=Ci;let Li=class{store;reportingServiceMetricPublisher;environment;constructor(e,t,r){this.store=e,this.reportingServiceMetricPublisher=t,this.environment=r}activateSendLibertyReportingServiceMetrics(){this.shouldSendMetrics()&&this.reportingServiceMetricPublisher.listenOn()}shouldSendMetrics(){if("undefined"!=typeof window&&window.Cypress){const e=window.localStorage?.getItem("liberty_reporting_enabled");if("true"===e)return!0;if("false"===e)return!1}const e=this.store.getLuckyNumber();if(void 0===e)return!1;const t=this.environment.getReportingExposurePercentage();return e%100>0&&e%100<t}};Li=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[W,Pi,O])],Li);const ji=Li;class Di{platform;groupName;isAdblockActivated;constructor(e,t,r){this.platform=e,this.groupName=t,this.isAdblockActivated=r}createTrackingTags(){return new pt(this.platform.toLowerCase(),this.createBlockingTrackingChannel())}createBlockingTrackingChannel(){return[this.groupName.toLowerCase(),"adblock-"+(this.isAdblockActivated?"on":"off")]}createTrackingKeyValues(){return new pt("adblocker",this.isAdblockActivated?["on"]:["off"])}icasTracking(){}}class xi{key;values;constructor(e,t){this.key=e,this.values=t}asTag(){return[this.key,...this.values].join(ht)}asKeyValue(){return{key:this.key,value:this.values.join(ht)}}}class Fi{attributionCode;constructor(e){this.attributionCode=e}createTrackingTags(){return new xi(this.attributionCode,[])}createTrackingKeyValues(){return new xi("liberty",[this.attributionCode])}icasTracking(){}}class Ni{platform;groupName;pageType;isAdblockActivated;constructor(e,t,r,i){this.platform=e,this.groupName=t,this.pageType=r,this.isAdblockActivated=i}getAdblockState(){return"adblock-"+(this.isAdblockActivated?"on":"off")}createTrackingTags(){}createTrackingKeyValues(){return new pt("liberty",[this.platform.toLowerCase(),this.groupName,this.pageType.toLowerCase(),this.getAdblockState()])}icasTracking(){}}class Bi{platform;groupName;constructor(e,t){this.platform=e,this.groupName=t}createTrackingTags(){}createTrackingKeyValues(){return new pt("liberty",[this.platform.toLowerCase(),this.groupName])}icasTracking(){}}class Mi{pageType;clickTrackingImprovementLabsVariant;constructor(e,t){this.pageType=e,this.clickTrackingImprovementLabsVariant=t}createTrackingTags(){return new pt("clvc",this.createTrackingValue())}createTrackingKeyValues(){}createTrackingValue(){return[this.pageType.toLowerCase(),this.clickTrackingImprovementLabsVariant]}icasTracking(){}}class zi{keyValues;constructor(e){this.keyValues=e}asTag(){return 0===this.keyValues.values.length?this.keyValues.name:this.keyValues.values.map(e=>[this.keyValues.name.toLowerCase(),...e.dimensions.map(e=>e.toLowerCase())].filter(e=>""!==e).join(ht)).join("+")}asKeyValue(){return{key:this.keyValues.name.toLowerCase(),value:this.keyValues.values.map(e=>e.dimensions.map(e=>e.toLowerCase()).join(ht)).join(",")}}}const Gi=["fp_pla_desktop"];class Vi{activeLabsExperiments;platform;pageType;categoryId;constructor(e,t,r,i){this.activeLabsExperiments=e,this.platform=t,this.pageType=r,this.categoryId=i}createTrackingKeyValues(){return this.getTrackingInfo()}createTrackingTags(){return this.getTrackingInfo()}icasTracking(){return this.getTrackingInfo()}getTrackingInfo(){const e=this.getExistingFirstPartyPlaExperimentKeys();if(e.length>1)throw new Error("More than one FP PLA experiment key found.");if(0===e.length)return;const t=this.activeLabsExperiments[e[0]],r=[{dimensions:[this.platform,this.pageType,t]}];return this.categoryId&&r.push({dimensions:[this.platform,this.pageType,this.categoryId,t]}),new zi({name:"fp",values:r})}getExistingFirstPartyPlaExperimentKeys(){return Object.keys(this.activeLabsExperiments??{}).filter(e=>Gi.includes(e))}}class Wi{experiments;constructor(e){this.experiments=e}createTrackingKeyValues(){return this.getTrackingInfoForKeyValues()}createTrackingTags(){return this.getTrackingInfoForTags()}icasTracking(){return this.getTrackingInfoForKeyValues()}getTrackingInfoForKeyValues(){if(0===this.experiments.length)return;const e=this.experiments.map(e=>({dimensions:[e.trackingTag]}));return new zi({name:"labstest",values:e})}getTrackingInfoForTags(){if(0===this.experiments.length)return;const e=this.experiments.map(e=>({dimensions:[e.trackingTag]}));return new zi({name:"",values:e})}}class Ui{platform;revenueExperimentKey;activeLabsExperiments;constructor(e,t,r){this.platform=e,this.revenueExperimentKey=t,this.activeLabsExperiments=r}icasTracking(){return this.createTrackingTags()}createTrackingTags(){const e=this.getLabsVariant();if(void 0===e)return;const t=this.getRevenueId();return new pt(this.platform.toLowerCase(),this.lowerCased([`${t}`,e]))}createTrackingKeyValues(){const e=this.getLabsVariant();if(void 0===e)return;const t=this.getRevenueId();return new pt("labstest",this.lowerCased([this.platform,`${t}`,e]))}lowerCased(e){return e.map(e=>e.toLowerCase())}getRevenueId(){return nt[this.revenueExperimentKey]}getLabsVariant(){return this.activeLabsExperiments?.[this.revenueExperimentKey]}}let qi=class{createAll(e,t,r,i,n,s,o,a,c){const l=new Mi(i,a),d=new Di(r,n,c),u=new Fi(s),g=new Bi(r,n),f=new Ni(r,n,i,c),h=this.createRevenueTrackers(r,o);return[l,d,u,g,f,new Vi(o??{},r,i,this.extractCategoryFrom(s)),new Wi(e.experiments??[]),...h]}extractCategoryFrom(e){return e.split("_")[3]}createRevenueTrackers(e,t){return Object.keys(nt).map(r=>new Ui(e,r,t))}};qi=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],qi);const $i=qi,Ki="libertyjs_debugging_feature_flags",Hi={refreshment:!0};class Qi{storage;constructor(e=window.sessionStorage){this.storage=e}saveAll(e){this.storage.setItem(Ki,JSON.stringify(e))}getAll(){const e=this.storage.getItem(Ki)??"";let t;try{t=JSON.parse(e)}catch(e){t={}}return{...Hi,...t}}}let Yi=class{windowWrapper;unifiedAuctionWindowMessageHandler=E.resolve(ur);constructor(e){this.windowWrapper=e}registerMessageEventHandler(){this.windowWrapper.get().addEventListener("message",e=>{this.unifiedAuctionWindowMessageHandler.handleMessageEvent(e)})}};Yi=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[q])],Yi);const Ji=Yi,Zi="%AFS_CHANNEL%",Xi="%DFP_TARGETS%",en="%GAM_TARGETS%";class tn{static isAdsenseChannelUnique(e,t){return!t.split("+").includes(e)}static appendAdsenseChannelForTrackingInformation(e,t){const r=t.asTag();return this.isAdsenseChannelUnique(r,e)?0===e.length?r:e+"+"+r:e}}class rn{static appendGamTarget(e,t){const{key:r,value:i}=t.asKeyValue(),n=e[r];return{...e,[r]:rn.appendValue(n,i)}}static appendValue(e,t){return[e,t].filter(e=>void 0!==e).join(",")}}let nn=class{getInjectedContext(e,t){return{...e,...this.getTrackingValues(e,t)}}getTrackingValues(e,t){return{[Xi]:this.buildGamContext(Xi,e,t),[en]:this.buildGamContext(en,e,t),[Zi]:this.buildForAdsenseChannel(Zi,e,t)}}buildGamContext(e,t,r){const i=t[e];if(i){const e=this.getGamTrackingInformations(r);return this.appendGamTargets(i,e)}return i}buildForAdsenseChannel(e,t,r){const i=t[e];if(void 0!==i){const e=this.getAdsenseTrackingInformations(r);return this.injectIntoAdsenseChannel(i,e)}return i}getAdsenseTrackingInformations(e){return this.removeUndefined(e.map(e=>e.createTrackingTags()))}getGamTrackingInformations(e){return this.removeUndefined(e.map(e=>e.createTrackingKeyValues()))}removeUndefined(e){return e.filter(e=>void 0!==e)}appendGamTargets(e,t){let r=e;return t.forEach(e=>{r=rn.appendGamTarget(r,e)}),r}injectIntoAdsenseChannel(e,t){let r=e;return t.forEach(e=>{r=tn.appendAdsenseChannelForTrackingInformation(r,e)}),r}};nn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],nn);const sn=nn;let on=class{trackingContextInjector;constructor(e){this.trackingContextInjector=e}createInjectedContext(e,t){return this.trackingContextInjector.getInjectedContext(e,t)}};on=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[sn])],on);const an=on;let cn=class{buildContextWithCategoryQueryTerms(e,t){const r=t["%QUERY%"]&&t["%QUERY%"].trim().length>0,i=0===e.queries.length;if(r||i)return t;const n=this.chooseCategoryQueryTerms(e.queries);return this.buildContext(t,n)}buildContext(e,t){const r={...e,"%QUERY%":t};return void 0!==e["%DFP_TARGETS%"]&&(r["%DFP_TARGETS%"]={...e["%DFP_TARGETS%"],catmap:t}),void 0!==e["%GAM_TARGETS%"]&&(r["%GAM_TARGETS%"]={...e["%GAM_TARGETS%"],catmap:t}),r}chooseCategoryQueryTerms(e){const t=e.length;return e[this.getRandomInt(t)]}getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}};cn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],cn);const ln=cn;const dn=/^%.+%$/;let un=class{getInjectedConfig(e,t){return this.inject(e,t)}inject(e,t){const r=Array.isArray(e)?[]:{};return Object.entries(e).forEach(([e,i])=>{if("object"==typeof i&&null!==i)r[e]=this.inject(i,t);else if(this.isValidForInjection(i)){const n=i;r[e]=this.requireNonNullWithCustomMessage(t[n],i)}else r[e]=i}),r}requireNonNullWithCustomMessage(e,t){return Dt(e,t,`Could not inject context '${t}' with value '${e}', because value is null or undefined.`)}isValidForInjection(e){return"string"==typeof e&&dn.test(e)}};un=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],un);const gn=un;let fn=class{buildContextWithLuckyNumber(e){const t=String(e["%LUCKY_NUMBER%"]??"");return{...e,"%DFP_TARGETS%":{...e["%DFP_TARGETS%"],lucky_number:t},"%GAM_TARGETS%":{...e["%GAM_TARGETS%"],lucky_number:t}}}};fn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],fn);const hn=fn;let pn=class{logger;categoryQueryTermsContextInjector;luckyNumberContextInjector;contextInjector;trackerFactory;trackingContextInjectorFactory;windowWrapper;constructor(e,t,r,i,n,s,o){this.logger=e,this.categoryQueryTermsContextInjector=t,this.luckyNumberContextInjector=r,this.contextInjector=i,this.trackerFactory=n,this.trackingContextInjectorFactory=s,this.windowWrapper=o}createConfig(e,t,r){const i=this.luckyNumberContextInjector.buildContextWithLuckyNumber(t),n=this.categoryQueryTermsContextInjector.buildContextWithCategoryQueryTerms(e,i);this.logger.debug("Context with Lucky Number and Category Query Terms:",n);const s=this.trackingContextInjectorFactory.createInjectedContext(n,r),o=this.contextInjector.getInjectedConfig(e,{...s,"%CURRENT_URL%":this.windowWrapper.get().location.href});return this.logger.debug("Config including context:",o),o}};pn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[M,ln,hn,gn,$i,an,q])],pn);const yn=pn;class vn extends TypeError{constructor(e,t){let r;const{message:i,explanation:n,...s}=e,{path:o}=e,a=0===o.length?i:`At path: ${o.join(".")} -- ${i}`;super(n??a),null!=n&&(this.cause=a),Object.assign(this,s),this.name=this.constructor.name,this.failures=()=>r??(r=[e,...t()])}}function mn(e){return"object"==typeof e&&null!=e}function bn(e){return mn(e)&&!Array.isArray(e)}function wn(e){return"symbol"==typeof e?e.toString():"string"==typeof e?JSON.stringify(e):`${e}`}function An(e,t,r,i){if(!0===e)return;!1===e?e={}:"string"==typeof e&&(e={message:e});const{path:n,branch:s}=t,{type:o}=r,{refinement:a,message:c=`Expected a value of type \`${o}\`${a?` with refinement \`${a}\``:""}, but received: \`${wn(i)}\``}=e;return{value:i,type:o,refinement:a,key:n[n.length-1],path:n,branch:s,...e,message:c}}function*Rn(e,t,r,i){var n;mn(n=e)&&"function"==typeof n[Symbol.iterator]||(e=[e]);for(const n of e){const e=An(n,t,r,i);e&&(yield e)}}function*Sn(e,t,r={}){const{path:i=[],branch:n=[e],coerce:s=!1,mask:o=!1}=r,a={path:i,branch:n,mask:o};s&&(e=t.coercer(e,a));let c="valid";for(const i of t.validator(e,a))i.explanation=r.message,c="not_valid",yield[i,void 0];for(let[l,d,u]of t.entries(e,a)){const t=Sn(d,u,{path:void 0===l?i:[...i,l],branch:void 0===l?n:[...n,d],coerce:s,mask:o,message:r.message});for(const r of t)r[0]?(c=null!=r[0].refinement?"not_refined":"not_valid",yield[r[0],void 0]):s&&(d=r[1],void 0===l?e=d:e instanceof Map?e.set(l,d):e instanceof Set?e.add(d):mn(e)&&(void 0!==d||l in e)&&(e[l]=d))}if("not_valid"!==c)for(const i of t.refiner(e,a))i.explanation=r.message,c="not_refined",yield[i,void 0];"valid"===c&&(yield[void 0,e])}class En{constructor(e){const{type:t,schema:r,validator:i,refiner:n,coercer:s=e=>e,entries:o=function*(){}}=e;this.type=t,this.schema=r,this.entries=o,this.coercer=s,this.validator=i?(e,t)=>Rn(i(e,t),t,this,e):()=>[],this.refiner=n?(e,t)=>Rn(n(e,t),t,this,e):()=>[]}assert(e,t){return Tn(e,this,t)}create(e,t){return function(e,t,r){const i=kn(e,t,{coerce:!0,message:r});if(i[0])throw i[0];return i[1]}(e,this,t)}is(e){return function(e,t){return!kn(e,t)[0]}(e,this)}mask(e,t){return function(e,t,r){const i=kn(e,t,{coerce:!0,mask:!0,message:r});if(i[0])throw i[0];return i[1]}(e,this,t)}validate(e,t={}){return kn(e,this,t)}}function Tn(e,t,r){const i=kn(e,t,{message:r});if(i[0])throw i[0]}function kn(e,t,r={}){const i=Sn(e,t,r),n=function(e){const{done:t,value:r}=e.next();return t?void 0:r}(i);return n[0]?[new vn(n[0],function*(){for(const e of i)e[0]&&(yield e[0])}),void 0]:[void 0,n[1]]}function In(e,t){return new En({type:e,schema:null,validator:t})}function _n(e){return new En({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(const[r,i]of t.entries())yield[r,i,e]},coercer:e=>Array.isArray(e)?e.slice():e,validator:e=>Array.isArray(e)||`Expected an array value, but received: ${wn(e)}`})}function On(){return In("boolean",e=>"boolean"==typeof e)}function Cn(){return In("number",e=>"number"==typeof e&&!isNaN(e)||`Expected a number, but received: ${wn(e)}`)}function Pn(e){const t=e?Object.keys(e):[],r=In("never",()=>!1);return new En({type:"object",schema:e||null,*entries(i){if(e&&mn(i)){const n=new Set(Object.keys(i));for(const r of t)n.delete(r),yield[r,i[r],e[r]];for(const e of n)yield[e,i[e],r]}},validator:e=>bn(e)||`Expected an object, but received: ${wn(e)}`,coercer(t,r){if(!bn(t))return t;const i={...t};if(r.mask&&e)for(const t in i)void 0===e[t]&&delete i[t];return i}})}function Ln(e){return new En({...e,validator:(t,r)=>void 0===t||e.validator(t,r),refiner:(t,r)=>void 0===t||e.refiner(t,r)})}function jn(e,t){return new En({type:"record",schema:null,*entries(r){if(mn(r))for(const i in r){const n=r[i];yield[i,i,e],yield[i,n,t]}},validator:e=>bn(e)||`Expected an object, but received: ${wn(e)}`,coercer:e=>bn(e)?{...e}:e})}function Dn(){return In("string",e=>"string"==typeof e||`Expected a string, but received: ${wn(e)}`)}function xn(e){const t=Object.keys(e);return new En({type:"type",schema:e,*entries(r){if(mn(r))for(const i of t)yield[i,r[i],e[i]]},validator:e=>bn(e)||`Expected an object, but received: ${wn(e)}`,coercer:e=>bn(e)?{...e}:e})}function Fn(){return In("unknown",()=>!0)}const Nn=In("NaN",e=>"number"==typeof e&&isNaN(e)),Bn=function(e){const t=e.map(e=>e.type).join(" | ");return new En({type:"union",schema:null,coercer(t,r){for(const i of e){const[e,n]=i.validate(t,{coerce:!0,mask:r.mask});if(!e)return n}return t},validator(r,i){const n=[];for(const t of e){const[...e]=Sn(r,t,i),[s]=e;if(!s[0])return[];for(const[t]of e)t&&n.push(t)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${wn(r)}`,...n]}})}([Cn(),Nn]),Mn=Bn;let zn=class{validate(e,t){this.validateConfig(e),this.validateOptions(t)}validateConfig(e){const t=_n(xn({type:Dn(),settings:xn({})})),r=xn({platform:Dn(),pageType:Dn(),groupName:Dn(),groupNameSource:Dn(),queries:_n(),pageLevelSettings:_n(),slots:_n(xn({advertisers:t,adblockAdvertisers:t})),trackingDimensions:jn(Dn(),Dn()),experiments:Ln(_n(xn({name:Dn(),variant:Dn(),revenueId:Dn(),trackingTag:Dn()}))),gdprConsentInterpretationFlags:Ln(jn(Dn(),On()))});try{Tn(e,r)}catch(e){if(e instanceof vn)throw new Error(`config: ${e.message}`)}this.validateMatchingPageLevelSettings(e),this.validateRefreshInterval(e)}validateRefreshInterval(e){e.pageLevelSettings.forEach(e=>{const t=e.type;if(e.settings.refreshInterval<1e3)throw Error(`config.pageLevelSettings[${t}].settings.refreshInterval must be >= 1000`)})}validateMatchingPageLevelSettings(e){this.getTypes(e).forEach(t=>{if(!e.pageLevelSettings.find(e=>e.type===t))throw Error(`config.pageLevelSettings[i].${t} not found`)})}getTypes(e){return kt([e.slots.map(e=>e.advertisers.map(e=>e.type)),e.slots.map(e=>e.adblockAdvertisers.map(e=>e.type))])}validateOptions(e){const t=xn({activeLabsExperiments:Ln(jn(Dn(),Dn())),prebid:Pn({defaultTimeout:Cn(),config:jn(Dn(),Fn()),bidderSettings:Ln(jn(Dn(),Fn())),bidderConfig:Ln(Pn({bidders:_n(Dn()),config:jn(Dn(),Fn())})),euidConfig:Ln(Pn({serverPublicKey:Dn(),subscriptionId:Dn(),siteId:Ln(Cn()),contact:Ln(Dn()),disabled:Ln(On()),name:Ln(Dn()),siteName:Ln(Dn())}))}),slots:_n((r=e=>{Tn(e,xn({maxHeight:Fn(),maxWidth:Fn()}));const t=this.ensureBothArePresent(e.maxHeight,e.maxWidth,Mn);return xn({positionNameMatcher:In("regexp",e=>e instanceof RegExp),maxWidth:t,maxHeight:t,gamAdUnitCode:Ln(Dn()),gamTargetings:Ln(xn({format:_n(Dn())}))})},new En({type:"dynamic",schema:null,*entries(e,t){const i=r(e);yield*i.entries(e,t)},validator:(e,t)=>r(e).validator(e,t),coercer:(e,t)=>r(e).coercer(e,t),refiner:(e,t)=>r(e).refiner(e,t)}))),features:xn({[Q.AAX]:On(),[Q.CLICK_TRACKING]:On(),[Q.CLICK_DETECTION_IMPROVEMENT_LABS_VARIANT]:Ln(Dn()),[Q.USE_SMART_FLOOR_PRICE]:Ln(On()),[Q.TRACKING]:xn({pageFirstJsExecutionTime:Cn(),sendMetricsBaseUrl:Ln(Dn()),trackJs:xn({enabled:On(),hostApplicationName:Dn()})})})});var r;try{Tn(e,t)}catch(e){if(e instanceof vn)throw new Error(`options: ${e.message}`)}}ensureBothArePresent(e,t,r){return void 0!==e||void 0!==t?r:Ln(r)}};zn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],zn);const Gn=zn;const Vn=/%.*%/;let Wn=class{validate(e){const t=Dt(e,"context");this.validateVariables(t)}validateVariables(e){Object.keys(e).forEach(e=>{if(!e.match(Vn))throw Error(`context.${e} does not match ${Vn}`)})}};Wn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],Wn);const Un=Wn;let qn=class{configValidator=E.resolve(Gn);contextValidator=E.resolve(Un);validateIsAdblockActivated(e){Dt(e,"isAdblockActivated")}validateArguments(e,t,r){this.configValidator.validate(e,t),this.contextValidator.validate(r)}};qn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T()],qn);const $n=qn;let Kn=class{environment;logger;validator;store;metrics;controller;trackerFactory;configFactory;windowMessageEventHandler;featureFlagRepository=new Qi;constructor(e,t,r,i,n,s,o,a,c){this.environment=e,this.logger=t,this.validator=r,this.store=i,this.metrics=n,this.controller=s,this.trackerFactory=o,this.configFactory=a,this.windowMessageEventHandler=c}initialize(e,t,r){this.logger.debug(`Liberty.js v${this.environment.getVersion()} loaded`),this.logger.debug("Config without Context:",e),this.logger.debug("Context:",t),this.logger.debug("Options:",r);try{this.validator.validateIsAdblockActivated(r.adblockEnabled),this.validator.validateArguments(e,r,t),this.initializeStore(e,t,r),this.initializeMetricsSending(),this.metrics.recordExecutionStart(r.features.tracking.pageFirstJsExecutionTime),this.sendAdblockerMetric(),this.windowMessageEventHandler.registerMessageEventHandler(),this.metrics.sendFillPreparationsCompleted(),this.controller.initizialise()}catch(e){throw this.logger.error(e),e}}initializeStore(e,t,r){const i=this.getAllTrackers(e,r,t),n=this.configFactory.createConfig(e,t,i),s=this.buildFeatureOptions(r),o=t["%LUCKY_NUMBER%"];this.store.initialize(n,r,s,i,o)}buildFeatureOptions(e){const t=this.featureFlagRepository.getAll();return{...e.features,...t}}getAllTrackers(e,t,r){return this.trackerFactory.createAll(e,r,e.platform,e.pageType,e.groupName,e.attributionCode,t.activeLabsExperiments,t.features.clickTrackingImprovementLabsVariant,t.adblockEnabled)}initializeMetricsSending(){E.resolve(ji).activateSendLibertyReportingServiceMetrics()}initializeLogger(e,t,r,i){const n=e?.trackJs?.enabled,s=e?.trackJs?.hostApplicationName;if(void 0===n||void 0===s)throw new Error("Required parameter tracking.trackJs.enabled or tracking.trackJs.hostApplicationName not set");this.logger.init(s,n,t,r,i,e?.errorLogger)}async load(){try{const e=await this.controller.fillNonLazySlotsWithAds();return await Promise.allSettled(e),e.forEach(e=>{e.catch(e=>{this.logger.error(e)})}),this.metrics.recordExecutionEnd(),e}catch(e){this.logger.error(e)}}async loadSlotsFilteredByPositionNames(e){try{return await this.controller.fillSlotsWithAdsFilteredBy(e)}catch(e){this.logger.error(e)}}async loadLazySlot(e){try{return await this.controller.fillLazySlotWithAds(e)}catch(e){this.logger.error(e)}}setFeatureFlags(e){this.featureFlagRepository.saveAll(e)}registerMetricHandler(e){e&&this.metrics.onChange(e)}sendAdblockerMetric(){this.store.isAdblockerEnabled()?this.metrics.setAdblockerActive():this.metrics.setAdblockerInactive()}};Kn=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([T(),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[O,M,$n,W,ce,Ti,$i,yn,Ji])],Kn);const Hn=Kn;var Qn=r(6449),Yn=r.n(Qn),Jn=r(6924),Zn=r.n(Jn);const Xn={appnexusAst:{bidCpmAdjustmentFactor:.7905},rubicon:{bidCpmAdjustmentFactor:.72},openx:{bidCpmAdjustmentFactor:.99},pubmatic:{bidCpmAdjustmentFactor:.81},ix:{bidCpmAdjustmentFactor:1.01},criteo:{bidCpmAdjustmentFactor:.98},improvedigital:{bidCpmAdjustmentFactor:.88}},es={features:{aax:!0,useSmartFloorPrice:!1,clickTracking:!0,clickTrackingImprovementLabsVariant:"",tracking:{sendMetricsBaseUrl:"",pageFirstJsExecutionTime:0,trackJs:{enabled:!1,hostApplicationName:""}},firstPartyRendering:{advertisingWebRendererUrl:""}},slots:[],activeLabsExperiments:{},prebid:{defaultTimeout:2e3,config:{enableSendAllBids:!0,enableTIDs:!0,deviceAccess:!0,userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"}},userIds:[{name:"sharedId",storage:{type:"cookie",name:"_sharedid",expires:365}},{name:"id5Id",params:{partner:225},storage:{type:"html5",name:"id5id",expires:90,refreshInSeconds:28800}},{name:"identityLink",params:{pid:"14273",notUse3P:!0},storage:{type:"html5",name:"idl_env",expires:15,refreshInSeconds:1800}},{name:"unifiedId",params:{partner:"d5e9l3b"},storage:{type:"html5",name:"pbjs-unifiedid",expires:60}}],syncDelay:3e3},improvedigital:{usePrebidSizes:!0},consentManagement:{gdpr:{cmpApi:"iab",timeout:8e3,defaultGdprScope:!0},tcf:{cmpApi:"iab",timeout:8e3,defaultGdprScope:!0,purpose1:{enforcePurpose:!0,enforceVendor:!1,vendorExceptions:[]}}},priceGranularity:{buckets:[{max:2,increment:.01},{max:20,increment:.1},{max:30,increment:.5},{max:50,increment:1}]},gvlMapping:{yieldlab:70,orbidder:559},allowActivities:{transmitTid:{default:!0},transmitEids:{default:!0}}},bidderSettings:{},euidConfig:{serverPublicKey:"EUID-X-P-MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE2jeq9u0orE1SlT8T9fAkJlVaPLH8ay19SsiFzjClGFx6MrNTy8NeADyEzDF4M2k17Zv8DBlb8KEXu6KIw3KX7w==",subscriptionId:"QDp4YDC1yY",siteId:57,contact:"",name:"kleinanzeigen.de",siteName:"kleinanzeigen.de"}}},ts={[Ii.DESKTOP]:{features:{tracking:{trackJs:{hostApplicationName:"desktop"}}},prebid:{bidderSettings:Xn}},[Ii.DESKTOP_ASTRO]:{features:{tracking:{trackJs:{hostApplicationName:"desktop-astro"}}},prebid:{bidderSettings:Xn}},[Ii.MWEB]:{features:{aax:!1,tracking:{trackJs:{hostApplicationName:"mweb"}}},prebid:{bidderSettings:{appnexusAst:{bidCpmAdjustmentFactor:.72},rubicon:{bidCpmAdjustmentFactor:.72},openx:{bidCpmAdjustmentFactor:1.03},pubmatic:{bidCpmAdjustmentFactor:.76},indexExchange:{bidCpmAdjustmentFactor:1.01},criteo:{bidCpmAdjustmentFactor:.98},improvedigital:{bidCpmAdjustmentFactor:.88}}}}};function rs(e,t){return void 0===t?e:Yn()(e)?t:void 0}function is(e){const t=e.client,r=ts[t];return Zn()({},es,r,e,rs)}var ns;!function(e){e.LOAD="LOAD",e.LOAD_LAZY_SLOT="LOAD_LAZY_SLOT",e.LOAD_SLOTS_FILTERED_BY_POSITION_NAMES="LOAD_SLOTS_FILTERED_BY_POSITION_NAMES",e.SET_FEATURE_FLAGS="SET_FEATURE_FLAGS"}(ns||(ns={}));const ss=ns;class os{queue;constructor(e=[]){this.queue=e}push(e){this.queue.push(e)}dequeue(){return this.queue.shift()}length(){return this.queue.length}}function as(e,t){localStorage.setItem("libertyjs_debug","true"),void 0!==e&&(function(e){if(!/^([a-l]|x|z[a-k]?)$/.exec(e))throw new Error("Liberty group is invalid. Please check existing Liberty group name.");document.cookie=`liberty_manual_group=${e}; path=/`}(e),void 0!==t&&window.liberty.commandQueue.push({commandName:ss.SET_FEATURE_FLAGS,args:{featureFlags:t}})),window.location.reload()}window.liberty=window.liberty||{};const cs=(new class{initCommandQueueAndAssignToLiberty(e){let t;return this.isUndefinedOrArray(e.commandQueue)?(t=this.createCommandQueueFrom(e.commandQueue),e.commandQueue=t):t=e.commandQueue,t}isUndefinedOrArray(e){return void 0===e||Array.isArray(e)}createCommandQueueFrom(e){return new os(e||[])}}).initCommandQueueAndAssignToLiberty(window.liberty);function ls(){return E.resolve(O).getVersion()}new class{commandQueue;libertyInstance;constructor(e){this.commandQueue=e}processQueueAndOverwritePush(){this.commandQueue.push=e=>{this.executeCommand(e)},this.executeCommands()}executeCommands(){const e=this.commandQueue.dequeue();void 0!==e&&(this.executeCommand(e),this.executeCommands())}executeCommand(e){const t=e.commandName;switch(t){case ss.LOAD:{const t=e.args;t.options={...is(t.options),adblockEnabled:t.adblockEnabled},E.clearInstances(),this.libertyInstance=E.resolve(Hn),this.libertyInstance.initializeLogger(t.options?.features?.tracking,t.trackJsErrorLoggerFactory,t.config.groupName,t.options?.adblockEnabled),this.libertyInstance.registerMetricHandler(t.onMetricsUpdate),this.libertyInstance.initialize(t.config,t.context,t.options),this.libertyInstance.load();break}case ss.LOAD_LAZY_SLOT:this.getLibertyInstance().loadLazySlot(e.args.positionName);break;case ss.LOAD_SLOTS_FILTERED_BY_POSITION_NAMES:this.getLibertyInstance().loadSlotsFilteredByPositionNames(e.args.positionNames);break;case ss.SET_FEATURE_FLAGS:this.getLibertyInstance().setFeatureFlags(e.args.featureFlags);break;default:throw new Error(`Liberty command '${t}' unrecognized!`)}}getLibertyInstance(){if(!this.libertyInstance)throw new Error("LOAD command needs to be done first!");return this.libertyInstance}}(cs).processQueueAndOverwritePush()})(),i})());
//# sourceMappingURL=liberty.min.js.map