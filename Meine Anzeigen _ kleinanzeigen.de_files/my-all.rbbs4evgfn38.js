(d=>{d.fn.lazyLoad=function(e){var l=d.extend({onImgLoad:!1,buffer:2},e);return this.each(function(e){var n=d(this),i=n.find(".lazyload-item"),a=i.outerHeight(),o=0,s=0,c=n.offset().top,t=!1;function r(){var e=null!=window.pageYOffset?window.pageYOffset:(e=window.document,("CSS1Compat"==document.compatMode?e.documentElement:e.body).scrollTop),n=d(window).height()+e,t=Math.max(0,parseInt((e-c)/a)-l.buffer),n=parseInt((n-c)/a)+l.buffer;(t=0<t?t:0)!=(n=n>i.length?i.length:n)&&(o<n||t<s)&&(i.slice(t,n).trigger("appear"),o=n,s=t)}i.one("appear",function(){function o(e,n){"function"==typeof l.onImgLoad&&l.onImgLoad(e,n)}d(this).find("[data-imgsrc]").each(function(){var e,n,t=d(this),i=t.attr("data-imgsrc"),a=(t.attr("data-imgsrcretina")&&(e=t.attr("data-imgsrcretina")),t.attr("data-imgstyle")&&(n=t.attr("data-imgstyle")),new Image);a.src=i,void 0!==e&&(a.srcset=e),void 0!==n&&(a.style=n),a.complete?o(t,a):a.onload=function(){o(t,a)}})}),d(window).on("load pageshow",function(){r(),t||(t=window.setInterval(function(){r()},100),window.setTimeout(function(){t&&(window.clearInterval(t),t=!1)},1e3))}),d(window).on("scroll touchmove resize",function(){t&&(window.clearInterval(t),t=!1),r()}),r()})}})($),Belen.Common.Watchlist=(()=>{let n;return{getInstance:function(e){function t(e,n,t){i&&$.ajax({url:i,method:"POST",data:{adId:e,action:n},success:t})}var i;return n=n||(i=e,{add:function(e,n){t(e,"store",n)},remove:function(e,n){t(e,"del",n)}})}}})(),Belen.My.LoginView=(()=>{let s="unset",c=4;function e(e){var n=$("#login-email"),t=$("#loginMail\\.errors"),i=$("#login-password"),a=$("#password\\.errors"),o=$("#password\\.error\\.tooShort");r(n)?(e.preventDefault(),t.revokeHidden()):t.makeHidden(),r(i)?(e.preventDefault(),a.revokeHidden(),o.makeHidden()):i.val().length<c?(e.preventDefault(),a.makeHidden(),o.revokeHidden()):(a.makeHidden(),o.makeHidden()),e.isDefaultPrevented()||($("#login-form").append('<input type="hidden" name="fingerprint" value="'+s+'">'),$("#login-submit").prop("disabled",!0))}function r(e){return 0===e.val().length}return{init:function(){navigator.cookieEnabled||$("#login-warn-nocookies").revokeHidden(),$("#login-form").submit(e),$(document).ready(function(){(new Fingerprint2).get(function(e){s=e})})}}})(),Belen.My.AdMailExtendView={init:function(){if(t=$('input[type="checkbox"]'),0<$('input[type="checkbox"]:checked').length&&$.each(t,function(e,n){n.checked&&(Belen.My.ManageAdsCart.add($(n).val()),$("#btn-cart-sbmt").attr("href",Belen.My.ManageAdsCart.forward()))}),t.change(function(){$(this).prop("checked")?Belen.My.ManageAdsCart.add($(this).val()):Belen.My.ManageAdsCart.remove($(this).val()),$("#btn-cart-sbmt").attr("href",Belen.My.ManageAdsCart.forward())}),0<$(".j-extendad-stb").length){Belen.Tracking.trackGoogleAnalyticsEvent("ExtendedAd,ComUserBannerShown,PROAcquisition");var t=$(".j-extendad-stb");let e=t.find(".banner--action").data("href"),n=t.find(".banner--action").data("trackingparams");t.on("click",function(){Belen.Tracking.trackGoogleAnalyticsEvent("ExtendedAd,ComUserBannerClicked,PROAcquisition"),window.location.href=e+"?"+n})}}},Belen.My.AdMaildeleteView={init:function(){$("#ad-mail-dlt-form").submit(function(e){e.preventDefault();e=$(this).attr("action");Belen.Common.CommonView.deleteAd(e,!0)})}},Belen.My.WatchlistView={init:function(e){Belen.Common.Security.initAjaxTokenCSRF(),Belen.Common.CommonView.initAdTable();let t=Belen.Common.Watchlist.getInstance(e.watchlistAjaxUrl);$("button.watchlist-remove").click(function(e){e.preventDefault();let n=$(this).parents(".ad-listitem");e=n.attr("data-adid");t.remove(e,function(){Belen.Tracking.trackGoogleAnalyticsEvent("Watchlist,WatchlistRemoveSuccess"),n.remove(),0===$(".ad-listitem").length&&$("#wtchlst-msg").revokeHidden()})}),$(".j-cln").on("click",function(){$(".ad-deleted .watchlist-remove").each(function(e,n){$(n).append('&nbsp;<div class="spinner"></div>'),setTimeout(function(){n.click()},500*e)})})}},Belen.My.SavedSearchesView={init:function(){Belen.Common.Security.initAjaxTokenCSRF(),$(".j-notifications").change(function(){let n=$(this).parents("li.j-search").find(".j-spinner"),t=(n.revokeHidden(),$(this)),i=t.data("href"),a=t.is(":checked");$.post(i,function(e){"OK"===e.status?-1!==i.indexOf("mode=OFF")?t.data("href",t.data("href").replace("mode=OFF","mode=ON")):t.data("href",t.data("href").replace("mode=ON","mode=OFF")):t.prop("checked",!a),n.makeHidden()}).fail(function(){t.prop("checked",!a),n.makeHidden()})}),$("#my-savedsearches-list").find(".j-delete").on("click",function(e){e.preventDefault(),Belen.Tracking.trackGoogleAnalyticsEvent("SavedSearches,SavedSearchDeleteBegin");e=$(this);let n=e.data("id");var e=e.attr("href")+"?id="+e.data("id"),t=$('li[data-saved-search="'+n+'"]').find(".spinner");(t.length?t:$(this).parents("li.j-search").find(".j-spinner")).revokeHidden(),$.post({url:e,success:function(){$('li[data-saved-search="'+n+'"]').fadeOut(300,function(){$(this).remove(),0===$(".j-search").length&&$("#empty-list-message").revokeHidden()}),Belen.Tracking.trackGoogleAnalyticsEvent("SavedSearches,SavedSearchDeleteSuccess")},error:function(){Belen.Tracking.trackGoogleAnalyticsEvent("SavedSearches,SavedSearchDeleteFail")}})})}},Belen.My.FollowUsersAjax=(()=>{let a,o;function t(e,n,t){o=e;let i=$(".j-followers-counter");Belen.Common.Security.initAjaxTokenCSRF(),o.on("click",function(){o.hasClass("is-toggled")?c({url:a.unfollowUserUrl,successCallback:function(){o.attr("title","Folgen").attr("data-ganevent",t+",FollowUserBegin").data("gaevent",t+",FollowUserBegin"),o.removeClass("is-toggled"),o.find("i").removeClass("icon-follow-user-active").addClass("icon-follow-user-green"),s("Folgen"),n&&0<i.length&&(i.data("value",i.data("value")-1),i.text(i.data("value"))),Belen.Tracking.trackGoogleAnalyticsEvent(t+",UnfollowUserSuccess")}}):c({url:a.followUserUrl,successCallback:function(){o.attr("title","Folge ich").attr("data-gaevent",t+",UnfollowUserBegin").data("gaevent",t+",UnfollowUserBegin"),o.addClass("is-toggled"),o.find("i").removeClass("icon-follow-user-green").addClass("icon-follow-user-active"),s("Folge ich"),n&&0<i.length&&(i.data("value",i.data("value")+1),i.text(i.data("value"))),Belen.Tracking.trackGoogleAnalyticsEvent(t+",FollowUserSuccess");try{window.dispatchEvent(new CustomEvent("ekBelenSharedComponents.Toast.show",{detail:{message:"Du erhältst Benachrichtigungen über Anzeigen und Neuigkeiten."}}))}catch(e){console.log(e)}}})})}function s(e){var n=o.find("span");0<n.length&&n.text(e)}function c(n){$.ajax({url:n.url,type:"POST",data:n.userIdToFollow,success:function(e){n.successCallback(e)},complete:function(){o.prop("disabled",!1)}})}return{init:function(e){a=e},initViewAdPage:function(e){a=e;let n;n=void 0!==window.eventCategory?window.eventCategory:"VIP",t($("#follow-user-button"),!1,n)},initUserInventoryPage:function(e){a=e,t($("#follow-user-button"),!0,"ResultsSeller")},initShopInventoryPage:function(e){a=e,t($("#follow-user-button"),!0,"ResultsSeller")}}})(),Belen.My.ManageAdsCart=(()=>{let a=[],i=[],o,n,t,s,c,e=null;function r(){let t=0;return $.each(a,function(e,n){t+=n.price}),t.toFixed(2).toString().replace(".",",")+" €"}function l(){null!==e&&(clearTimeout(e),e=null),0===a.length&&s.is(":visible")?e=setTimeout(m,150):(s.revokeHidden(),c.revokeHidden(),n.html(r()),t.html(r()),$(document).trigger("scroll"))}function d(n){var e;return""===n||0===(e=$.grep(i,function(e){return e.id===n})).length?null:e[0]}function u(e,n,t){var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",n),i.setAttribute("value",t),e.appendChild(i)}function f(){if(0!==a.length){let i=[];$.each(a,function(e,n){i.push(n.id)});{var e=i;var n=void 0;n=n||"post";let t=document.createElement("form");t.setAttribute("method",n),t.setAttribute("action",o.shoppingCartUrl),u(t,"_csrf",Belen.Common.Security.getTokenCSRF()),$.each(e,function(e,n){u(t,"articles",n)}),void 0!==o.origin&&u(t,"origin",o.origin),document.body.appendChild(t),t.submit()}}}function m(){0===a.length&&(s.makeHidden(),c.makeHidden(),$(document).trigger("scroll"))}return{init:function(e){o=e,e=e,n=$(e.totalPriceDomId),t=$(e.totalPriceBottomDomId),s=$(e.totalPriceContainerDomId),c=$(e.totalPriceContainerBottomDomId),$.each(e.adsAsJson.ads,function(e,t){$.each(t.articles,function(e,n){n.booked||i.push({id:n.id,adId:t.id,price:n.price,priceFormatted:n.priceFormatted,type:n.type})})})},add:function(e){null!==(e=d(e))&&(a.push(e),l())},remove:function(t){$.each(a,function(e,n){if(n.id===t)return a.splice(e,1),!1}),l()},open:f,forward:function(){if(0!==a.length){let t=[],e=($.each(a,function(e,n){t.push(n.id)}),o.shoppingCartUrl+"?articles="+t.join("&articles="));return void 0!==o.origin&&(e+="&origin="+o.origin),e}},find:d,hide:m,clear:function(){a=[],l()},submit:f,cart:a,log:function(){console.log("... cart ..."),$.each(a,function(e,n){console.log(n)})}}})(),Belen.My.SettingsView=(()=>{let o,t="outcomemessage-warning",i=6e4;function a(e,n,t,i){let a=$("div.j-msg",e);a.addClass("l-container-row").addClass(n).html(i).fadeIn("fast",function(){window.setTimeout(function(){a.fadeOut("fast",function(){a.removeClass(n)})},t)})}function l(e,n){a(e,"outcomemessage-success",6e4,n)}function s(e,n){a(e,t,i,n)}function d(t,i,e){var n=$("meta[name='_csrf']").attr("content"),a=$("meta[name='_csrf_header']").attr("content");$.ajax({url:e||o.manageMySettingsAjaxUrl,type:"POST",data:t.data,contentType:t.contentType||"application/x-www-form-urlencoded; charset=UTF-8",headers:{[a]:n},beforeSend:function(){$("body").loading(),t.beforeSend&&t.beforeSend()},complete:function(e,n){$("body").loadingDone(),"error"===n?s(i,o.generalErrMsg):"1"===e.getResponseHeader("REQUIRES_AUTH")?window.location.href=o.sessionExpiredredirectUrl:t.success(JSON.parse(e.responseText||null))}})}let n={init:function(){let n=$("#my-settngs-nwslttr"),t=$("#my-nwslttrEnabled"),i=$("button.j-nwslttr-sbmt");t.on("change",function(){i.revokeHidden()}),$("button.j-nwslttr-sbmt",n).click(function(e){e.preventDefault(),d({data:{action:t.prop("checked")?"subscribe":"unsubscribe",_csrf:$("input[name=_csrf]").val()},success:function(e){"OK"!==e.status&&"ERROR"!==e.status||(l(n,e.message),i.addClass("is-hidden"))}},n)})}},c={init:function(){let n=$("#my-settngs-emails"),t=$("#my-emailnotificationsEnabled"),e=$("button.j-emails-sbmt",n);t.on("change",function(){e.revokeHidden()}),e.click(function(e){e.preventDefault(),d({data:{"emails-action":t.prop("checked")?"subscribe":"unsubscribe",_csrf:$("input[name=_csrf]").val()},success:function(e){"OK"!==e.status&&"ERROR"!==e.status||l(n,e.message)}},n)})}},r={init:function(){let n=$("#my-settngs-passwd"),t=$("form",n);$("button.j-passwd-sbmt",n).click(function(e){e.preventDefault(),d({data:t.serialize(),beforeSend:function(){$("span.formerror",t).html("").makeHidden(),$("div.j-msg").fadeOut("fast")},success:function(e){"OK"===e.status?($("input:password",t).val(""),$.magnificPopup.open({items:{src:"#confirmation-popup-pwd",type:"inline"}})):"ERROR"===e.status&&(e=e.fieldErrors)&&$.each(e,function(e,n){t.find("input[name='"+n.field+"']").next(".formerror:eq(0)").html(""+n.errormsg).revokeHidden()})}},n)})}},u={init:function(){let n=$("#my-settngs-email"),t=$("form",n);$("button.j-email-sbmt",n).click(function(e){e.preventDefault(),$.magnificPopup.open({items:{src:"#change-email-form",type:"inline"},callbacks:{beforeOpen:function(){$("#change-email-submit").on("click",function(){$.magnificPopup.close(),d({data:t.serialize(),beforeSend:function(){$("span.formerror",t).html("").makeHidden(),$("div.j-msg").fadeOut("fast")},success:function(e){"OK"===e.status?(s(n,e.message),$("input:password",t).val("")):"ERROR"===e.status&&(e=e.fieldErrors)&&$.each(e,function(e,n){t.find("input[name='"+n.field+"']").next("span.formerror:eq(0)").html(""+n.errormsg).revokeHidden()})}},n)})}}})})}},f={init:function(){var e=$('input[name="addressRequiredInContactForm"]');let n=$(".j-mandatory-sbmt"),t=$("#my-settngs-mandatory"),i=t.data("submit");e.on("change",function(){n.revokeHidden()}),n.on("click",function(){var e=!!$("#my-addrmandatory").prop("checked");Belen.TrackingDispatcher.track(window.pageType+",EditAccountSuccess,address-mandatory_"+(e?"yes":"no")),d({contentType:"application/json; charset=UTF-8",data:JSON.stringify({addressRequiredInContactForm:e}),success:function(e){"OK"===e.status&&(l(t,e.message),n.addClass("is-hidden"))}},t,i)})}},m={init:function(){var e=$('input[name="showAdditionalFieldForBuy"]'),n=$('input[name="showAdditionalFieldForRent"]');let t=$(".j-additional-fields-sbmt"),i=$("#my-settngs-showAdditionalFields"),a=i.data("submit");e.on("change",function(){t.revokeHidden()}),n.on("change",function(){t.revokeHidden()}),t.on("click",function(){var e=!!$("#my-showAdditionalFieldForBuy").prop("checked"),n=!!$("#my-showAdditionalFieldForRent").prop("checked");Belen.TrackingDispatcher.track(window.pageType+",EditAccountSuccess,rent-additionalfields_"+(n?"yes":"no")+";sale-additionalfields_"+(e?"yes":"no")),d({contentType:"application/json; charset=UTF-8",data:JSON.stringify({additionalContactFieldsForBuyEnabled:e,additionalContactFieldsForRentEnabled:n}),success:function(e){"OK"===e.status&&(l(i,e.message),t.addClass("is-hidden"))}},i,a)})}},p={init:function(){var e=$('input[name="buyersCanRequestCallback"]');let n=$(".j-callback-option-sbmt"),t=$("#my-settngs-callbackOption"),i=t.data("submit");e.on("change",function(){n.revokeHidden()}),n.on("click",function(){var e=!!$("#my-callbackOption").prop("checked");Belen.TrackingDispatcher.track(window.pageType+",EditAccountSuccess,callback-request_"+(e?"yes":"no")),d({contentType:"application/json; charset=UTF-8",data:JSON.stringify({buyersCanRequestCallback:e}),success:function(e){"OK"===e.status&&(l(t,e.message),n.addClass("is-hidden"))}},t,i)})}},g={init:function(){let t=$("#my-messageBoxOption"),i=$(".j-messagebox-option-sbmt"),a=$("#my-settings-messageBoxOption"),o=a.data("submit"),n=$("#my-messageBoxInfo"),s={MESSAGEBOX:a.data("info-messagebox"),MAIL:a.data("info-mail")},c=t.prop("checked")?"MESSAGEBOX":"MAIL";function r(e){n.html(s[e])}r(c),t.on("change",function(){i.revokeHidden()}),i.on("click",function(){var e=t.prop("checked")?"MESSAGEBOX":"MAIL";Belen.TrackingDispatcher.track(window.pageType+",EditAccountSuccess,messagebox_"+("MESSAGEBOX"==e?"enabled":"disabled"));let n={messagingChannel:e};d({contentType:"application/json; charset=UTF-8",data:JSON.stringify(n),success:function(e){"OK"===e.status&&(r(c=n.messagingChannel),l(a,e.message),i.addClass("is-hidden"))}},a,o)})}},h={init:function(){Belen.Common.PhoneVerification.initPhoneVerificationClickHandler("#tns-phone-verification-entry",{onVerificationDone:function(e){e&&($("#tns-phone-verification-number").text(e),$("#tns-phone-verification-headline").text(o.phoneNumberVerifiedText.headline),$("#tns-phone-verification-paragraph").text(o.phoneNumberVerifiedText.paragraph),$("#tns-phone-verification-entry > span").text(o.phoneNumberVerifiedText.button))},trackingOrigin:"user_settings",userAction:"SETTINGS_PAGE"})}},v={init:function(){$("#complex-password-change").on("click",function(e){e.preventDefault();e=$("#my-settngs-passwd").data("tmxsessionid");window.ekUserSettings.changePassword.renderPasswordModal({containerId:"change-password-modal",csrfToken:$("[name='_csrf']").attr("content"),tmxSessionId:e,trackJsFactoryInstance:window.trackJsFactoryInstance})})}},k={init:function(){let t=$('input[name="realestate-agency-settings-new-email"]');var e=$(".j-realestate-c2bagencies-settings-sbmt");let i=$("#realestate-agency-settings-email"),a=i.data("submit"),o=$("#current-email");e.on("click",function(){let n=t.val();d({data:{agencyEmail:n,_csrf:$("input[name=_csrf]").val()},beforeSend:function(){$("span.formerror",i).html("").makeHidden(),$("div.j-msg").fadeOut("fast")},success:function(e){"OK"===e.status?(o.val(n),t.val(""),l(i,e.message)):"ERROR"===e.status&&$("span.formerror",i).html(e.message).revokeHidden()}},i,a)})}};return{init:function(e){o=e,n.init(),r.init(),u.init(),c.init(),f.init(),m.init(),p.init(),g.init(),h.init(),v.init(),k.init()}}})(),Belen.My.FeatureShoppingCartView={init:function(e){var n,t;(n=e).suppressTracking||!0===n.postAdSuccess&&(t=Belen.Tracking.createTracker(Belen.Tracker.GOOGLE_ANALYTICS_EVENTS),Belen.Tracking.createTracker(Belen.Tracker.CRITEO_CONVERSION).track(n.adId),t.track("PostAdForm,PostAdPaidAttempt")),"object"==typeof e.payPalPlus&&(n=e.payPalPlus.approvalUrl,t=e.payPalPlus.mode,PAYPAL.apps.PPP({approvalUrl:n,mode:t,placeholder:"ppplus",language:"DE_de",country:"DE",disableContinue:"ppp-continue",enableContinue:"ppp-continue",buttonLocation:"outside",preselection:"paypal",useraction:"commit",showLoadingIndicator:!0}),$("#ppp-continue").on("click",function(e){e.preventDefault(),PAYPAL.apps.PPP.doCheckout()})),$("#myftr-shppngcrt-sbmt").click(function(){$("body").loading()})}},(()=>{let n,i,a,t;function o(){return Math.round((new Date).getTime()/1e3)}function s(){t.makeHidden(),n.add(a).revokeHidden()}function c(){t.makeHidden(),i.add(a).revokeHidden()}Belen.AdStatePoller=function(e){if(0!==(t=$("#checking-in-progress")).length){n=$("#checking-done"),i=$("#not-completed"),a=$("#links-on-final-state");let t=o()+20;setTimeout(function n(){$.ajax(e.url,{dataType:"json",success:function(e){"ACTIVE"===e.state?s():"DELAYED"===e.state?c():o()<t?setTimeout(n,1e3):s()}})},e.initialWait)}}})();