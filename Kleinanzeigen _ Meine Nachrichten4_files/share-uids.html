<!DOCTYPE html>
<!-- saved from url=(0601)https://s2s.yieldlove-ad-serving.net/static/share-uids.html?gdpr=1&gdpr_consent=CQfDEkAQfDEkAE1ACADECQFgAP_gAELAAAYgLepR9C7dbWFF8bZ3aPtkOYwX19BjIsQhBgSBAyAFyBOQ4JQA02E6NASAJiACEAAAoxTBAAFEHABEAQCAAAAEAADsIAwEgAAIIABEgBEQQAJYAAgKCIggEAAIgAIEEgAAmBiAKdLmWUiAkIACCgCQACABAICAAAMABAAIAAIAAAAAwgAAgAJgoAIAAAEAARAIAAAAAAAAAAAAIAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgXnACATIAvMA4eACATIAvMdADgACBMcCZQLygXoC3pCADAAEFvSYAIBMgC8yUAOAAIExwJlAvKBegLelQAQCZAF5lIAcAAQJjgTKBeUC9AW9LQAYAAgt6FABAJkAXmEgBwABAmOBMoF5QL0Bb0NABgACC3oiADAAEFvRUAGAAILejIAMAAQW9.f_wAAAAAA60A&endpoint=https%3A%2F%2Fih.adscale.de%2Fuids -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>Document</title>
</head>
<body>
<script type="text/javascript">
    (async function () {
        /**
         * @param url {string}
         * @returns {boolean}
         */
        function isValidURL(url) {
            try {
                url = url.trim();
                if (url.startsWith("//")) {
                    url = "https:" + url;
                }
                new URL(url);
                return true;
            } catch (e) {
                return false;
            }
        }

        /**
         * @returns {string}
         */
        function getEndpoint() {
            const params = new URLSearchParams(window.location.search);
            const endpoint = params.get("endpoint");
            if (endpoint) {
                if (!isValidURL(endpoint)) {
                    throw new Error(`Invalid endpoint URL: ${endpoint}`);
                }
                return endpoint;
            } else {
                return "https://ih.adscale.de/uids";
            }
        }

        /**
         * @param consentData {object}
         * @param uids {string}
         */
        function shareUserId(consentData, uids) {
            const gdpr = consentData.gdprApplies === false ? 0 : 1;
            const consentString = consentData.tcString;
            const url = `${(getEndpoint())}?gdpr=${gdpr}&gdpr_consent=${consentString}`;

            const headers = new Headers();
            headers.append("Content-Type", "text/plain");
            fetch(
                new Request(url, {
                    method: "POST",
                    headers: headers,
                    keepalive: true,
                    credentials: "include",
                    body: uids,
                }),
            );
        }

        /**
         * @returns {{cmpWindow: Window, directAccess: boolean}}
         */
        function findCMP() {
            let currentWindow = window;
            let cmpWindow;
            let directAccess = false;
            while (currentWindow != null) {
                try {
                    if (typeof currentWindow["__tcfapi"] === "function") {
                        cmpWindow = currentWindow;
                        directAccess = true;
                        break;
                    }
                } catch (ignore) {
                }

                try {
                    if (currentWindow.frames["__tcfapiLocator"]) {
                        cmpWindow = currentWindow;
                        break;
                    }
                } catch (ignore) {
                }

                if (currentWindow === window.top) break;
                currentWindow = currentWindow.parent;
            }

            return {
                cmpWindow,
                directAccess,
            };
        }

        /**
         * @param name {string}
         * @returns {string|undefined}
         */
        function getCookieValue(name) {
            try {
                const pair = document.cookie
                    .split(";")
                    .map((strPair) =>
                        strPair.split("=").map((str) => str.trim()),
                    )
                    .find(([key]) => key === name);

                if (pair) {
                    return pair[1];
                }
            } catch (ignore) {
                // An exception can occur when inside a sandbox iframe with no 'allow-same-origin'
            }
        }

        /**
         * @type {function(): Promise<object>}
         */
        const getConsentData = (() => {
            const cmpCallContext = new Map();
            const {cmpWindow, directAccess} = findCMP();

            if (!cmpWindow) {
                return () => Promise.reject(new Error("Unable to find the CMP window"));
            }

            let tcfApiWindow;
            if (directAccess) {
                tcfApiWindow = cmpWindow;
            } else {
                // Create a __tcfapi proxy on this `window`. `window.postMessage()` will be used under the hood.
                tcfApiWindow = window;
                window.addEventListener("message", (event) => {
                    let json = {};

                    try {
                        json =
                            typeof event.data === "string"
                                ? JSON.parse(event.data)
                                : event.data;
                    } catch (ignore) {
                    }

                    const payload = json.__tcfapiReturn;

                    if (payload) {
                        const context = cmpCallContext.get(payload.callId);
                        if (context) {
                            if (typeof context.callback === "function") {
                                context.callback(
                                    payload.returnValue,
                                    payload.success,
                                );
                            }

                            if (context.command === "addEventListener") {
                                context.listenerId = payload.returnValue.listenerId;
                            } else {
                                cmpCallContext.delete(payload.callId);
                                if (context.command === "removeEventListener") {
                                    const listenerId = context.parameter;

                                    const [key] = cmpCallContext
                                        .entries()
                                        .find(([, value]) => value?.listenerId === listenerId) ?? [];
                                    if (key) {
                                        cmpCallContext.delete(key);
                                    }
                                }
                            }
                        }
                    }
                });

                window.__tcfapi = function (
                    cmd,
                    version,
                    callback,
                    arg,
                ) {
                    const callId = Math.random().toString();
                    const msg = {
                        __tcfapiCall: {
                            command: cmd,
                            parameter: arg,
                            version: version,
                            callId: callId,
                        },
                    };
                    cmpCallContext.set(callId, {
                        command: cmd,
                        parameter: arg,
                        callback,
                    });
                    cmpWindow.postMessage(msg, "*");
                };
            }

            return () =>
                new Promise((resolve, reject) => {
                    const cmpCallback = (tcData, success) => {
                        if (success) {
                            if (tcData.eventStatus === "tcloaded" || tcData.eventStatus === "useractioncomplete") {
                                tcfApiWindow.__tcfapi(
                                    "removeEventListener",
                                    2,
                                    () => {},
                                    tcData.listenerId
                                );
                                resolve(tcData);
                            }
                        } else {
                            reject(new Error("CMP was unable to register the callback"));
                        }
                    };
                    tcfApiWindow.__tcfapi("addEventListener", 2, cmpCallback);
                });
        })();

        try {
            const consentData = await getConsentData();
            if (consentData) {
                const uids = getCookieValue("uids");
                if (uids != null) {
                    shareUserId(consentData, uids);
                } else {
                    console.log("Found no uids cookie to share");
                }
            }
        } catch (e) {
            console.error(e);
        }
    })();
</script>


</body></html>