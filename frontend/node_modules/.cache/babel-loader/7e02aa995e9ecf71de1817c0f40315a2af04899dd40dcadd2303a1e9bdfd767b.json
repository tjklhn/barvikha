{"ast":null,"code":"var _jsxFileName = \"/Users/eurocare/Downloads/barvihaluxury-main/frontend/src/components/MessagesTab.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { apiFetchJson, getAccessToken } from \"../api\";\nimport { MessageIcon } from \"./Icons\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SEEN_STORAGE_KEY = \"kl_messages_seen_v1\";\nconst THREAD_CACHE_TTL_MS = 2 * 60 * 1000;\nconst detectMobileView = () => {\n  var _window$screen;\n  if (typeof window === \"undefined\") return false;\n  const viewportWidth = window.innerWidth || document.documentElement.clientWidth || 0;\n  const screenWidth = typeof ((_window$screen = window.screen) === null || _window$screen === void 0 ? void 0 : _window$screen.width) === \"number\" ? window.screen.width : viewportWidth;\n  const effectiveWidth = Math.min(viewportWidth || screenWidth, screenWidth || viewportWidth);\n  const mobileUa = /Android|webOS|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(typeof navigator !== \"undefined\" && navigator.userAgent || \"\");\n  const hasCoarsePointer = typeof window.matchMedia === \"function\" ? window.matchMedia(\"(pointer: coarse)\").matches : false;\n  const noHover = typeof window.matchMedia === \"function\" ? window.matchMedia(\"(hover: none)\").matches : false;\n  const touchPoints = typeof navigator !== \"undefined\" ? Number(navigator.maxTouchPoints || 0) : 0;\n  const touchLikeDevice = hasCoarsePointer || noHover || touchPoints > 1;\n  return effectiveWidth <= 768 || touchLikeDevice && effectiveWidth <= 1024 || mobileUa && effectiveWidth <= 1180;\n};\nconst normalizePreviewImageUrl = value => {\n  const raw = String(value || \"\").trim();\n  if (!raw) return \"\";\n  if (/^data:/i.test(raw)) return \"\";\n  const normalizeRuleForKleinanzeigen = parsed => {\n    const host = String(parsed.hostname || \"\").toLowerCase();\n    const isProdAdsImage = host === \"img.kleinanzeigen.de\" && parsed.pathname.startsWith(\"/api/v1/prod-ads/images/\");\n    if (!isProdAdsImage) return parsed;\n    const ruleParam = String(parsed.searchParams.get(\"rule\") || \"\");\n    const malformedRule = /(imageid|\\$\\{.*\\}|\\$_\\{.*\\})/i.test(ruleParam);\n    const validRule = /^\\$_[a-z0-9_.-]+$/i.test(ruleParam);\n    if (!validRule || malformedRule) {\n      parsed.searchParams.set(\"rule\", \"$_57.JPG\");\n    }\n    return parsed;\n  };\n  if (/^(https?:)?\\/\\//i.test(raw)) {\n    try {\n      const parsed = normalizeRuleForKleinanzeigen(new URL(raw.startsWith(\"//\") ? `https:${raw}` : raw));\n      return parsed.href;\n    } catch {\n      return raw.startsWith(\"//\") ? `https:${raw}` : raw;\n    }\n  }\n  if (/^img\\.kleinanzeigen\\.de/i.test(raw)) return normalizePreviewImageUrl(`https://${raw}`);\n  if (/^\\/api\\/v1\\/prod-ads\\/images\\//i.test(raw)) return normalizePreviewImageUrl(`https://img.kleinanzeigen.de${raw}`);\n  try {\n    const parsed = normalizeRuleForKleinanzeigen(new URL(raw, \"https://www.kleinanzeigen.de\"));\n    return parsed.href;\n  } catch {\n    return \"\";\n  }\n};\nconst toMessageImageSrc = (value, accountId) => {\n  const normalized = normalizePreviewImageUrl(value);\n  if (!normalized) return \"\";\n  const accountToken = accountId !== undefined && accountId !== null && String(accountId).trim() ? String(accountId).trim() : \"\";\n  const accessToken = getAccessToken();\n  if (normalized.startsWith(\"/api/messages/image?\")) {\n    let src = normalized;\n    if (accountToken && !/[?&]accountId=/i.test(src)) {\n      const separator = src.includes(\"?\") ? \"&\" : \"?\";\n      src = `${src}${separator}accountId=${encodeURIComponent(accountToken)}`;\n    }\n    if (accessToken && !/[?&](accessToken|token)=/i.test(src)) {\n      const separator = src.includes(\"?\") ? \"&\" : \"?\";\n      src = `${src}${separator}accessToken=${encodeURIComponent(accessToken)}`;\n    }\n    return src;\n  }\n  if (/^https?:\\/\\//i.test(normalized)) {\n    if (!accountToken) return normalized;\n    const params = new URLSearchParams();\n    params.set(\"url\", normalized);\n    params.set(\"accountId\", accountToken);\n    if (accessToken) {\n      params.set(\"accessToken\", accessToken);\n    }\n    return `/api/messages/image?${params.toString()}`;\n  }\n  return normalized;\n};\nconst getRawMessagePreviewImage = message => {\n  var _message$ad, _message$ad2, _message$ad3;\n  if (!message || typeof message !== \"object\") return \"\";\n  const candidates = [message.adImage, message.adImageUrl, message.adImageURL, message.imageUrl, message.image, message.thumbnailUrl, message.thumbnail, message.previewImage, (_message$ad = message.ad) === null || _message$ad === void 0 ? void 0 : _message$ad.image, (_message$ad2 = message.ad) === null || _message$ad2 === void 0 ? void 0 : _message$ad2.imageUrl, (_message$ad3 = message.ad) === null || _message$ad3 === void 0 ? void 0 : _message$ad3.thumbnailUrl];\n  for (const candidate of candidates) {\n    const normalized = normalizePreviewImageUrl(candidate);\n    if (normalized) return normalized;\n  }\n  return \"\";\n};\nconst getMessagePreviewImage = message => toMessageImageSrc(getRawMessagePreviewImage(message), message === null || message === void 0 ? void 0 : message.accountId);\nconst hasMessagePreviewImage = message => Boolean(getRawMessagePreviewImage(message));\nconst isPaymentAndShippingMessage = message => {\n  if (!message || typeof message !== \"object\") return false;\n  const type = String(message.type || \"\").toUpperCase();\n  return type === \"PAYMENT_AND_SHIPPING_MESSAGE\" || Boolean(message.paymentAndShippingMessageType);\n};\nconst formatEuroFromCents = value => {\n  const cents = Number(value);\n  if (!Number.isFinite(cents)) return \"\";\n  return (cents / 100).toLocaleString(\"de-DE\", {\n    style: \"currency\",\n    currency: \"EUR\"\n  });\n};\nconst pickOfferField = (message, key) => {\n  if (!message || typeof message !== \"object\") return null;\n  const direct = message[key];\n  if (direct !== undefined && direct !== null) return direct;\n  const actions = Array.isArray(message.actions) ? message.actions : [];\n  const withKey = actions.find(action => action && action[key] !== undefined && action[key] !== null);\n  return withKey ? withKey[key] : null;\n};\nconst getOfferActionText = (message, actionType, fallback = \"\") => {\n  const actions = Array.isArray(message === null || message === void 0 ? void 0 : message.actions) ? message.actions : [];\n  const action = actions.find(item => (item === null || item === void 0 ? void 0 : item.actionType) === actionType);\n  return (action === null || action === void 0 ? void 0 : action.ctaText) || fallback;\n};\nconst extractAttachmentUrls = message => {\n  const buckets = [message === null || message === void 0 ? void 0 : message.attachments, message === null || message === void 0 ? void 0 : message.images, message === null || message === void 0 ? void 0 : message.imageUrls, message === null || message === void 0 ? void 0 : message.media, message === null || message === void 0 ? void 0 : message.pictures].filter(value => Array.isArray(value));\n  const urls = [];\n  for (const bucket of buckets) {\n    for (const item of bucket) {\n      if (!item) continue;\n      if (typeof item === \"string\") {\n        urls.push(item);\n        continue;\n      }\n      if (typeof item === \"object\") {\n        // Kleinanzeigen message attachments often need the gateway URL (auth required),\n        // while the api.kleinanzeigen.de URL can return 401.\n        const candidate = item.gatewayUrl || item.url || item.href || item.src || item.imageUrl || item.thumbnailUrl;\n        if (candidate) urls.push(candidate);\n      }\n    }\n  }\n  return urls.filter(Boolean);\n};\nconst getConversationKey = message => {\n  if (!message || typeof message !== \"object\") return \"\";\n  const accountId = message.accountId != null ? String(message.accountId) : \"\";\n  const convo = message.conversationId || message.conversationUrl || message.id || \"\";\n  const convoId = convo != null ? String(convo) : \"\";\n  if (!accountId || !convoId) return \"\";\n  return `${accountId}|${convoId}`;\n};\nconst getConversationFingerprint = message => {\n  if (!message || typeof message !== \"object\") return \"\";\n  const date = String(message.date || \"\").trim();\n  const time = String(message.time || \"\").trim();\n  const text = String(message.message || \"\").trim();\n  return `${date}|${time}|${text}`;\n};\nconst loadSeenMap = () => {\n  if (typeof window === \"undefined\" || !window.localStorage) return {};\n  try {\n    const raw = window.localStorage.getItem(SEEN_STORAGE_KEY);\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    return parsed && typeof parsed === \"object\" ? parsed : {};\n  } catch {\n    return {};\n  }\n};\nconst saveSeenMap = next => {\n  if (typeof window === \"undefined\" || !window.localStorage) return;\n  try {\n    window.localStorage.setItem(SEEN_STORAGE_KEY, JSON.stringify(next || {}));\n  } catch {\n    // ignore quota / serialization issues\n  }\n};\nconst MessagesTab = () => {\n  _s();\n  var _selectedMessage$mess;\n  const [messages, setMessages] = useState([]);\n  const [selectedMessage, setSelectedMessage] = useState(null);\n  const [replyText, setReplyText] = useState(\"\");\n  const [replyImages, setReplyImages] = useState([]);\n  const [sending, setSending] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingThread, setLoadingThread] = useState(false);\n  const [error, setError] = useState(null);\n  const [isMobileView, setIsMobileView] = useState(() => detectMobileView());\n  const [translationByMessageId, setTranslationByMessageId] = useState({});\n  const [declineConfirmOpen, setDeclineConfirmOpen] = useState(false);\n  const [decliningOffer, setDecliningOffer] = useState(false);\n  const chatScrollRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const previewHydrationInFlight = useRef(new Set());\n  const messagesRefreshInFlight = useRef(false);\n  const translateInFlight = useRef(new Set());\n  const threadCacheRef = useRef(new Map());\n  const clearComposerImages = () => {\n    setReplyImages(prev => {\n      const existing = Array.isArray(prev) ? prev : [];\n      existing.forEach(item => {\n        if (item !== null && item !== void 0 && item.previewUrl) {\n          URL.revokeObjectURL(item.previewUrl);\n        }\n      });\n      return [];\n    });\n  };\n  const getThreadCacheKeyForMessage = message => {\n    if (!message || typeof message !== \"object\") return \"\";\n    const accountId = message.accountId != null ? String(message.accountId) : \"\";\n    const conversationId = message.conversationId != null ? String(message.conversationId) : \"\";\n    const conversationUrl = message.conversationUrl != null ? String(message.conversationUrl) : \"\";\n    if (!accountId) return \"\";\n    if (conversationId) return `${accountId}|cid:${conversationId}`;\n    if (conversationUrl) return `${accountId}|url:${conversationUrl}`;\n    return \"\";\n  };\n  const readThreadCacheEntry = message => {\n    const key = getThreadCacheKeyForMessage(message);\n    if (!key) return null;\n    const entry = threadCacheRef.current.get(key);\n    if (!entry || typeof entry !== \"object\") return null;\n    if (!entry.expiresAt || entry.expiresAt < Date.now()) {\n      threadCacheRef.current.delete(key);\n      return null;\n    }\n    return entry;\n  };\n  const writeThreadCacheEntry = (message, payload) => {\n    const key = getThreadCacheKeyForMessage(message);\n    if (!key || !payload || typeof payload !== \"object\") return;\n    threadCacheRef.current.set(key, {\n      expiresAt: Date.now() + THREAD_CACHE_TTL_MS,\n      payload: {\n        adTitle: payload.adTitle || \"\",\n        adImage: payload.adImage || \"\",\n        sender: payload.sender || \"\",\n        messages: Array.isArray(payload.messages) ? payload.messages : [],\n        conversationId: payload.conversationId || (message === null || message === void 0 ? void 0 : message.conversationId) || \"\",\n        conversationUrl: payload.conversationUrl || (message === null || message === void 0 ? void 0 : message.conversationUrl) || \"\"\n      }\n    });\n  };\n  useEffect(() => {\n    loadMessages();\n  }, []);\n  useEffect(() => {\n    const intervalId = window.setInterval(() => {\n      // Avoid background polling when the tab is hidden (mobile data / lower load).\n      if (typeof document !== \"undefined\" && document.visibilityState !== \"visible\") return;\n      loadMessages({\n        silent: true\n      });\n    }, 3 * 60 * 1000);\n    return () => window.clearInterval(intervalId);\n  }, []);\n  useEffect(() => {\n    if (!selectedMessage) return;\n    const container = chatScrollRef.current;\n    if (!container) return;\n    container.scrollTo({\n      top: container.scrollHeight,\n      behavior: \"smooth\"\n    });\n  }, [selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.id, selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.messages]);\n  useEffect(() => {\n    // Reset composer state when switching conversations.\n    setReplyText(\"\");\n    clearComposerImages();\n    setDeclineConfirmOpen(false);\n    setDecliningOffer(false);\n  }, [selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.id]);\n  useEffect(() => {\n    const handleResize = () => {\n      setIsMobileView(detectMobileView());\n    };\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n  const hydrateMissingPreviewImages = async list => {\n    if (!Array.isArray(list) || !list.length) return;\n    const candidates = list.filter(item => item && !hasMessagePreviewImage(item)).slice(0, 10);\n    for (const item of candidates) {\n      const key = String(item.conversationId || item.conversationUrl || item.id || \"\");\n      if (!key || previewHydrationInFlight.current.has(key)) continue;\n      previewHydrationInFlight.current.add(key);\n      try {\n        const params = new URLSearchParams();\n        if (item.accountId != null) params.set(\"accountId\", String(item.accountId));\n        if (item.conversationId) params.set(\"conversationId\", String(item.conversationId));\n        if (item.conversationUrl) params.set(\"conversationUrl\", String(item.conversationUrl));\n        if (!item.conversationId && !item.conversationUrl) {\n          if (item.sender) params.set(\"participant\", String(item.sender));\n          if (item.adTitle) params.set(\"adTitle\", String(item.adTitle));\n        }\n        if (!params.get(\"accountId\")) continue;\n        const data = await apiFetchJson(`/api/messages/thread?${params.toString()}`);\n        const adImage = normalizePreviewImageUrl(data === null || data === void 0 ? void 0 : data.adImage);\n        if (!adImage) continue;\n        setMessages(prev => prev.map(msg => {\n          const sameConversation = item.conversationId && msg.conversationId && String(item.conversationId) === String(msg.conversationId) || item.conversationUrl && msg.conversationUrl && String(item.conversationUrl) === String(msg.conversationUrl) || String(msg.id) === String(item.id);\n          if (!sameConversation) return msg;\n          return {\n            ...msg,\n            adImage,\n            adTitle: (data === null || data === void 0 ? void 0 : data.adTitle) || msg.adTitle,\n            conversationId: (data === null || data === void 0 ? void 0 : data.conversationId) || msg.conversationId,\n            conversationUrl: (data === null || data === void 0 ? void 0 : data.conversationUrl) || msg.conversationUrl\n          };\n        }));\n      } catch (error) {\n        console.error(\"Не удалось догрузить превью диалога:\", error);\n      } finally {\n        previewHydrationInFlight.current.delete(key);\n      }\n    }\n  };\n  const rememberConversationSeen = message => {\n    const key = getConversationKey(message);\n    if (!key) return;\n    const fingerprint = getConversationFingerprint(message);\n    if (!fingerprint) return;\n    const seen = loadSeenMap();\n    seen[key] = {\n      fingerprint,\n      seenAt: Date.now()\n    };\n    saveSeenMap(seen);\n\n    // Immediately update UI so the badge doesn't come back on refresh.\n    setMessages(prev => prev.map(msg => {\n      const msgKey = getConversationKey(msg);\n      if (!msgKey || msgKey !== key) return msg;\n      return {\n        ...msg,\n        unread: false\n      };\n    }));\n  };\n  const loadMessages = async (opts = {}) => {\n    const silent = Boolean(opts && typeof opts === \"object\" && opts.silent);\n    if (messagesRefreshInFlight.current) return;\n    messagesRefreshInFlight.current = true;\n    if (!silent) {\n      setLoading(true);\n      setError(null);\n    }\n    try {\n      // Request only a limited number of conversations per account to keep the endpoint fast/stable.\n      const params = new URLSearchParams();\n      params.set(\"limit\", \"30\");\n      const data = await apiFetchJson(`/api/messages?${params.toString()}`, {\n        timeoutMs: 120000\n      });\n      const list = Array.isArray(data) ? data : [];\n      const seen = new Set();\n      const deduped = [];\n      for (const item of list) {\n        const key = item.conversationId || item.conversationUrl || item.id || `${item.accountId || \"\"}|${item.sender || \"\"}|${item.adTitle || \"\"}|${item.message || \"\"}|${item.time || \"\"}`;\n        if (seen.has(key)) continue;\n        seen.add(key);\n        deduped.push(item);\n      }\n      const seenMap = loadSeenMap();\n      const merged = deduped.map(item => {\n        const key = getConversationKey(item);\n        if (!key) return item;\n        const entry = seenMap[key];\n        if (!entry || typeof entry !== \"object\") return item;\n        const currentFingerprint = getConversationFingerprint(item);\n        if (entry.fingerprint && entry.fingerprint === currentFingerprint) {\n          return {\n            ...item,\n            unread: false\n          };\n        }\n        return item;\n      });\n      setMessages(merged);\n      hydrateMissingPreviewImages(merged);\n    } catch (err) {\n      console.error(\"Ошибка загрузки сообщений:\", err);\n      if (!silent) setError(err.message || \"Не удалось загрузить сообщения\");\n    } finally {\n      if (!silent) setLoading(false);\n      messagesRefreshInFlight.current = false;\n    }\n  };\n\n  // NOTE: Backend does not guarantee a \"mark read\" API (and Kleinanzeigen state may lag).\n  // We persist \"seen\" locally so a refresh won't resurrect the \"new\" badge.\n  const markAsRead = message => rememberConversationSeen(message);\n  const handleReplyImageSelect = event => {\n    var _event$target;\n    const files = Array.from((event === null || event === void 0 ? void 0 : (_event$target = event.target) === null || _event$target === void 0 ? void 0 : _event$target.files) || []);\n    if (event !== null && event !== void 0 && event.target) event.target.value = \"\";\n    if (!files.length) return;\n    const nextItems = files.filter(file => String((file === null || file === void 0 ? void 0 : file.type) || \"\").toLowerCase().startsWith(\"image/\")).slice(0, 10).map(file => ({\n      id: `img-${Date.now()}-${Math.random().toString(16).slice(2)}`,\n      file,\n      previewUrl: URL.createObjectURL(file)\n    }));\n    if (!nextItems.length) return;\n    setReplyImages(prev => {\n      const existing = Array.isArray(prev) ? prev : [];\n      return [...existing, ...nextItems].slice(0, 10);\n    });\n  };\n  const removeReplyImage = id => {\n    setReplyImages(prev => {\n      const existing = Array.isArray(prev) ? prev : [];\n      const target = existing.find(item => (item === null || item === void 0 ? void 0 : item.id) === id);\n      if (target !== null && target !== void 0 && target.previewUrl) {\n        URL.revokeObjectURL(target.previewUrl);\n      }\n      return existing.filter(item => (item === null || item === void 0 ? void 0 : item.id) !== id);\n    });\n  };\n  const formatRequestError = (error, fallbackText) => {\n    var _error$data, _error$data2;\n    const baseMessage = String((error === null || error === void 0 ? void 0 : error.message) || fallbackText || \"Ошибка запроса\").trim();\n    const debugId = (error === null || error === void 0 ? void 0 : (_error$data = error.data) === null || _error$data === void 0 ? void 0 : _error$data.debugId) || (error === null || error === void 0 ? void 0 : error.debugId) || \"\";\n    const requestId = (error === null || error === void 0 ? void 0 : (_error$data2 = error.data) === null || _error$data2 === void 0 ? void 0 : _error$data2.requestId) || (error === null || error === void 0 ? void 0 : error.requestId) || \"\";\n    if (debugId) {\n      return `${baseMessage} (debugId: ${debugId})`;\n    }\n    if (requestId) {\n      return `${baseMessage} (requestId: ${requestId})`;\n    }\n    return baseMessage;\n  };\n  const confirmDeclineOffer = async () => {\n    if (!selectedMessage || decliningOffer) return;\n    if (!selectedMessage.conversationId && !selectedMessage.conversationUrl) {\n      alert(\"Не найден идентификатор диалога.\");\n      return;\n    }\n    setDecliningOffer(true);\n    try {\n      const result = await apiFetchJson(\"/api/messages/offer/decline\", {\n        method: \"POST\",\n        timeoutMs: 240000,\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          accountId: selectedMessage.accountId,\n          conversationId: selectedMessage.conversationId,\n          conversationUrl: selectedMessage.conversationUrl\n        })\n      });\n      const serverMessages = Array.isArray(result.messages) ? result.messages : [];\n      if (serverMessages.length) {\n        const lastMessage = serverMessages[serverMessages.length - 1];\n        const nextConversationId = result.conversationId || selectedMessage.conversationId;\n        const nextConversationUrl = result.conversationUrl || selectedMessage.conversationUrl;\n        setMessages(prev => prev.map(msg => msg.id === selectedMessage.id ? {\n          ...msg,\n          message: (lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.text) || msg.message,\n          date: (lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.date) || msg.date,\n          time: (lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.time) || msg.time,\n          conversationId: nextConversationId || msg.conversationId,\n          conversationUrl: nextConversationUrl || msg.conversationUrl,\n          unread: false\n        } : msg));\n        setSelectedMessage(prev => ({\n          ...prev,\n          messages: serverMessages,\n          conversationId: nextConversationId || prev.conversationId,\n          conversationUrl: nextConversationUrl || prev.conversationUrl\n        }));\n        writeThreadCacheEntry(selectedMessage, {\n          adTitle: selectedMessage.adTitle,\n          adImage: selectedMessage.adImage,\n          sender: selectedMessage.sender,\n          messages: serverMessages,\n          conversationId: nextConversationId,\n          conversationUrl: nextConversationUrl\n        });\n      } else {\n        // Fallback: refresh thread when backend doesn't return messages.\n        fetchThread(selectedMessage, {\n          force: true\n        });\n      }\n      setDeclineConfirmOpen(false);\n    } catch (error) {\n      console.error(\"Ошибка отклонения заявки:\", error, {\n        status: error === null || error === void 0 ? void 0 : error.status,\n        code: error === null || error === void 0 ? void 0 : error.code,\n        data: (error === null || error === void 0 ? void 0 : error.data) || null\n      });\n      alert(formatRequestError(error, \"Не удалось отклонить заявку\"));\n    } finally {\n      setDecliningOffer(false);\n    }\n  };\n  const sendReply = async () => {\n    if (!selectedMessage) return;\n    if (!selectedMessage.conversationId && !selectedMessage.conversationUrl && !selectedMessage.sender && !selectedMessage.adTitle) {\n      alert(\"Не найден идентификатор диалога.\");\n      return;\n    }\n    const textToSend = replyText.trim();\n    const imagesToSend = Array.isArray(replyImages) ? replyImages : [];\n    if (imagesToSend.length && !selectedMessage.conversationId && !selectedMessage.conversationUrl) {\n      alert(\"Для отправки фото нужен conversationId диалога. Откройте диалог и попробуйте снова.\");\n      return;\n    }\n    if (!textToSend && imagesToSend.length === 0) return;\n    const now = new Date();\n    const optimisticId = `local-${now.getTime()}-${Math.random().toString(16).slice(2)}`;\n    const optimisticAttachments = imagesToSend.map(item => {\n      var _item$file, _item$file2;\n      return {\n        url: (item === null || item === void 0 ? void 0 : item.previewUrl) || \"\",\n        name: (item === null || item === void 0 ? void 0 : (_item$file = item.file) === null || _item$file === void 0 ? void 0 : _item$file.name) || \"\",\n        type: (item === null || item === void 0 ? void 0 : (_item$file2 = item.file) === null || _item$file2 === void 0 ? void 0 : _item$file2.type) || \"\",\n        local: true\n      };\n    }).filter(item => item === null || item === void 0 ? void 0 : item.url);\n    const previewText = textToSend || (optimisticAttachments.length ? \"Фото\" : \"\");\n    const optimisticMessage = {\n      id: optimisticId,\n      text: textToSend,\n      date: now.toISOString().slice(0, 10),\n      time: now.toTimeString().slice(0, 5),\n      direction: \"outgoing\",\n      sender: \"Вы\",\n      pending: true,\n      ...(optimisticAttachments.length ? {\n        attachments: optimisticAttachments\n      } : {})\n    };\n\n    // Optimistic UI: show message immediately in the thread and conversation list.\n    setReplyText(\"\");\n    setReplyImages([]);\n    setSelectedMessage(prev => {\n      if (!prev) return prev;\n      const existing = Array.isArray(prev.messages) && prev.messages.length ? prev.messages : prev.message ? [{\n        id: prev.id,\n        text: prev.message,\n        sender: prev.sender,\n        date: prev.date,\n        time: prev.time,\n        direction: \"incoming\"\n      }] : [];\n      return {\n        ...prev,\n        messages: [...existing, optimisticMessage]\n      };\n    });\n    setMessages(prev => prev.map(msg => msg.id === selectedMessage.id ? {\n      ...msg,\n      message: previewText,\n      date: optimisticMessage.date,\n      time: optimisticMessage.time,\n      unread: false\n    } : msg));\n    setSending(true);\n    try {\n      const result = optimisticAttachments.length ? await (() => {\n        const form = new FormData();\n        form.append(\"accountId\", String(selectedMessage.accountId));\n        if (selectedMessage.conversationId) form.append(\"conversationId\", String(selectedMessage.conversationId));\n        if (selectedMessage.conversationUrl) form.append(\"conversationUrl\", String(selectedMessage.conversationUrl));\n        if (textToSend) form.append(\"text\", textToSend);\n        imagesToSend.forEach(item => {\n          if (!(item !== null && item !== void 0 && item.file)) return;\n          form.append(\"images\", item.file, item.file.name || \"image.jpg\");\n        });\n        return apiFetchJson(\"/api/messages/send-media\", {\n          method: \"POST\",\n          timeoutMs: 240000,\n          body: form\n        });\n      })() : await apiFetchJson(\"/api/messages/send\", {\n        method: \"POST\",\n        timeoutMs: 180000,\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          accountId: selectedMessage.accountId,\n          conversationId: selectedMessage.conversationId,\n          conversationUrl: selectedMessage.conversationUrl,\n          participant: selectedMessage.sender,\n          adTitle: selectedMessage.adTitle,\n          text: textToSend\n        })\n      });\n      if (result.success) {\n        const resolvedConversationId = result.conversationId || selectedMessage.conversationId;\n        const resolvedConversationUrl = result.conversationUrl || selectedMessage.conversationUrl;\n        const serverMessages = Array.isArray(result.messages) ? result.messages : [];\n        const hasSameOutgoing = optimisticAttachments.length ? serverMessages.some(m => String((m === null || m === void 0 ? void 0 : m.direction) || \"\").toLowerCase() === \"outgoing\" && (Array.isArray(m === null || m === void 0 ? void 0 : m.attachments) && m.attachments.length > 0 || textToSend && String((m === null || m === void 0 ? void 0 : m.text) || \"\") === textToSend)) : serverMessages.some(m => String((m === null || m === void 0 ? void 0 : m.direction) || \"\").toLowerCase() === \"outgoing\" && String((m === null || m === void 0 ? void 0 : m.text) || \"\") === textToSend);\n        const nextMessages = serverMessages.length ? hasSameOutgoing ? serverMessages : [...serverMessages, {\n          ...optimisticMessage,\n          pending: false\n        }] : null;\n        if (nextMessages) {\n          const lastMessage = nextMessages[nextMessages.length - 1];\n          setMessages(prev => prev.map(msg => msg.id === selectedMessage.id ? {\n            ...msg,\n            message: (lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.text) || msg.message,\n            date: (lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.date) || msg.date,\n            time: (lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.time) || msg.time,\n            conversationId: resolvedConversationId || msg.conversationId,\n            conversationUrl: resolvedConversationUrl || msg.conversationUrl\n          } : msg));\n          setSelectedMessage(prev => ({\n            ...prev,\n            messages: nextMessages,\n            conversationId: resolvedConversationId,\n            conversationUrl: resolvedConversationUrl\n          }));\n          writeThreadCacheEntry(selectedMessage, {\n            adTitle: selectedMessage.adTitle,\n            adImage: selectedMessage.adImage,\n            sender: selectedMessage.sender,\n            messages: nextMessages,\n            conversationId: resolvedConversationId,\n            conversationUrl: resolvedConversationUrl\n          });\n        } else {\n          // Backend may respond without thread messages. Keep optimistic entry and mark it as sent.\n          setSelectedMessage(prev => {\n            if (!prev) return prev;\n            const updated = Array.isArray(prev.messages) ? prev.messages : [];\n            return {\n              ...prev,\n              messages: updated.map(m => (m === null || m === void 0 ? void 0 : m.id) === optimisticId ? {\n                ...m,\n                pending: false\n              } : m),\n              conversationId: resolvedConversationId,\n              conversationUrl: resolvedConversationUrl\n            };\n          });\n          setMessages(prev => prev.map(msg => msg.id === selectedMessage.id ? {\n            ...msg,\n            conversationId: resolvedConversationId || msg.conversationId,\n            conversationUrl: resolvedConversationUrl || msg.conversationUrl\n          } : msg));\n        }\n      } else {\n        // Revert optimistic update on logical failure.\n        setSelectedMessage(prev => {\n          if (!prev) return prev;\n          const updated = Array.isArray(prev.messages) ? prev.messages : [];\n          return {\n            ...prev,\n            messages: updated.filter(m => (m === null || m === void 0 ? void 0 : m.id) !== optimisticId)\n          };\n        });\n        setReplyText(textToSend);\n        setReplyImages(imagesToSend);\n        const debugId = result !== null && result !== void 0 && result.debugId ? ` (debugId: ${result.debugId})` : \"\";\n        alert(\"Ошибка: \" + (result.error || \"Не удалось отправить\") + debugId);\n      }\n    } catch (err) {\n      console.error(\"Ошибка отправки:\", err, {\n        status: err === null || err === void 0 ? void 0 : err.status,\n        code: err === null || err === void 0 ? void 0 : err.code,\n        data: (err === null || err === void 0 ? void 0 : err.data) || null\n      });\n      setSelectedMessage(prev => {\n        if (!prev) return prev;\n        const updated = Array.isArray(prev.messages) ? prev.messages : [];\n        return {\n          ...prev,\n          messages: updated.filter(m => (m === null || m === void 0 ? void 0 : m.id) !== optimisticId)\n        };\n      });\n      setReplyText(textToSend);\n      setReplyImages(imagesToSend);\n      alert(formatRequestError(err, \"Ошибка при отправке сообщения\"));\n    } finally {\n      setSending(false);\n    }\n  };\n  const getTimeAgo = (date, time) => {\n    if (!date && !time) return \"\";\n    const now = new Date();\n    try {\n      const messageDate = new Date(date + \"T\" + (time || \"00:00\"));\n      if (isNaN(messageDate.getTime())) return time || date || \"\";\n      const diffHours = Math.floor((now - messageDate) / (1000 * 60 * 60));\n      if (diffHours < 1) return time || \"Только что\";\n      if (diffHours < 24) return time;\n      if (diffHours < 48) return \"Вчера\";\n      return date;\n    } catch {\n      return time || date || \"\";\n    }\n  };\n  const formatMessageDate = (date, time) => {\n    if (!date && !time) return \"\";\n    const parts = [];\n    if (date) {\n      try {\n        const d = new Date(date + \"T00:00\");\n        if (!isNaN(d.getTime())) {\n          const now = new Date();\n          const diffDays = Math.floor((now - d) / (1000 * 60 * 60 * 24));\n          if (diffDays === 0) parts.push(\"Сегодня\");else if (diffDays === 1) parts.push(\"Вчера\");else parts.push(d.toLocaleDateString(\"ru-RU\", {\n            day: \"numeric\",\n            month: \"short\"\n          }));\n        } else {\n          parts.push(date);\n        }\n      } catch {\n        parts.push(date);\n      }\n    }\n    if (time) parts.push(time);\n    return parts.join(\", \");\n  };\n  const threadMessages = selectedMessage !== null && selectedMessage !== void 0 && (_selectedMessage$mess = selectedMessage.messages) !== null && _selectedMessage$mess !== void 0 && _selectedMessage$mess.length ? selectedMessage.messages : selectedMessage ? [{\n    id: selectedMessage.id,\n    text: selectedMessage.message,\n    sender: selectedMessage.sender,\n    date: selectedMessage.date,\n    time: selectedMessage.time,\n    direction: \"incoming\"\n  }] : [];\n  const fetchThread = async (message, {\n    force = false\n  } = {}) => {\n    const cached = !force ? readThreadCacheEntry(message) : null;\n    if (cached !== null && cached !== void 0 && cached.payload) {\n      const cachedPayload = cached.payload;\n      const updatedFromCache = {\n        ...message,\n        adTitle: cachedPayload.adTitle || message.adTitle,\n        adImage: cachedPayload.adImage || message.adImage,\n        sender: message.sender || cachedPayload.sender || \"\",\n        messages: Array.isArray(cachedPayload.messages) ? cachedPayload.messages : [],\n        conversationId: cachedPayload.conversationId || message.conversationId,\n        conversationUrl: cachedPayload.conversationUrl || message.conversationUrl\n      };\n      setMessages(prev => prev.map(msg => String(msg.id) === String(message.id) ? {\n        ...msg,\n        adTitle: updatedFromCache.adTitle,\n        adImage: updatedFromCache.adImage,\n        conversationId: updatedFromCache.conversationId,\n        conversationUrl: updatedFromCache.conversationUrl\n      } : msg));\n      setSelectedMessage(updatedFromCache);\n      return;\n    }\n    setLoadingThread(true);\n    try {\n      const params = new URLSearchParams();\n      params.set(\"accountId\", message.accountId);\n      if (message.conversationId) params.set(\"conversationId\", message.conversationId);\n      if (message.conversationUrl) params.set(\"conversationUrl\", message.conversationUrl);\n      if (!message.conversationId && !message.conversationUrl) {\n        if (message.sender) params.set(\"participant\", message.sender);\n        if (message.adTitle) params.set(\"adTitle\", message.adTitle);\n      }\n      const data = await apiFetchJson(`/api/messages/thread?${params.toString()}`);\n      if (data.success) {\n        const adImage = normalizePreviewImageUrl(data.adImage || message.adImage);\n        const updated = {\n          ...message,\n          adTitle: data.adTitle || message.adTitle,\n          adImage,\n          sender: message.sender || data.participant || \"\",\n          messages: data.messages || [],\n          conversationId: data.conversationId || message.conversationId,\n          conversationUrl: data.conversationUrl || message.conversationUrl\n        };\n        setMessages(prev => prev.map(msg => String(msg.id) === String(message.id) ? {\n          ...msg,\n          adTitle: updated.adTitle,\n          adImage: updated.adImage,\n          conversationId: updated.conversationId,\n          conversationUrl: updated.conversationUrl\n        } : msg));\n        setSelectedMessage(updated);\n        writeThreadCacheEntry(updated, updated);\n      }\n    } catch (err) {\n      console.error(\"Ошибка загрузки диалога:\", err);\n    } finally {\n      setLoadingThread(false);\n    }\n  };\n  const handleKeyDown = e => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      sendReply();\n    }\n  };\n  const unreadCount = messages.filter(m => m.unread).length;\n  const showConversationList = !isMobileView || !selectedMessage;\n  const showChatPanel = !isMobileView || Boolean(selectedMessage);\n  const selectedRawPreviewImage = selectedMessage ? getRawMessagePreviewImage(selectedMessage) : \"\";\n  const selectedPreviewImage = selectedMessage ? toMessageImageSrc(selectedRawPreviewImage, selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.accountId) : \"\";\n  const selectedDirectPreviewImage = normalizePreviewImageUrl(selectedRawPreviewImage);\n  const hasReplyPayload = Boolean(replyText.trim()) || replyImages.length > 0;\n  const canSendReply = !sending && hasReplyPayload;\n\n  // Spinner SVG for loading states\n  const Spinner = ({\n    size = 20,\n    color = \"#7dd3fc\"\n  }) => /*#__PURE__*/_jsxDEV(\"svg\", {\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    style: {\n      animation: \"spin 1s linear infinite\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"circle\", {\n      cx: \"12\",\n      cy: \"12\",\n      r: \"10\",\n      stroke: color,\n      strokeWidth: \"3\",\n      fill: \"none\",\n      strokeDasharray: \"31.4\",\n      strokeDashoffset: \"10\",\n      strokeLinecap: \"round\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 908,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 907,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }\n        .msg-conv-item:hover { background: rgba(59,130,246,0.12) !important; }\n        .msg-send-btn:hover:not(:disabled) { background: #16a34a !important; }\n        .msg-refresh-btn:hover:not(:disabled) { background: #0284c7 !important; transform: scale(1.02); }\n        .msg-refresh-btn:active:not(:disabled) { transform: scale(0.98); }\n        .msg-translate-btn:hover { opacity: 1 !important; transform: translateY(-1px) scale(1.02) !important; }\n        .msg-translate-btn:active { transform: translateY(0px) scale(0.98) !important; }\n      `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 914,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section-header\",\n      style: {\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"space-between\",\n        gap: \"12px\",\n        marginBottom: \"20px\",\n        flexWrap: \"wrap\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          margin: 0,\n          color: \"#f8fafc\",\n          display: \"flex\",\n          alignItems: \"center\",\n          gap: \"14px\",\n          fontWeight: 700\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            width: \"42px\",\n            height: \"42px\",\n            borderRadius: \"14px\",\n            background: \"linear-gradient(135deg, rgba(249, 115, 22, 0.25), rgba(194, 65, 12, 0.2))\",\n            border: \"1px solid rgba(251, 146, 60, 0.4)\",\n            boxShadow: \"0 4px 15px rgba(251, 146, 60, 0.28)\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\"\n          },\n          children: /*#__PURE__*/_jsxDEV(MessageIcon, {\n            size: 22,\n            color: \"#fdba74\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 953,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 942,\n          columnNumber: 11\n        }, this), \"\\u0421\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u044F\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 934,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 926,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages-layout\",\n      style: {\n        display: \"flex\",\n        gap: \"20px\",\n        height: \"calc(100vh - 220px)\",\n        minHeight: \"500px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"messages-list\",\n        style: {\n          width: \"400px\",\n          minWidth: \"340px\",\n          background: \"linear-gradient(145deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.95) 100%)\",\n          borderRadius: \"20px\",\n          overflow: \"hidden\",\n          boxShadow: \"0 20px 50px rgba(0,0,0,0.4), 0 0 30px rgba(0,0,0,0.2)\",\n          border: \"1px solid rgba(148,163,184,0.12)\",\n          color: \"#e2e8f0\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          backdropFilter: \"blur(10px)\",\n          ...(showConversationList ? {} : {\n            display: \"none\"\n          })\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: \"16px 20px\",\n            borderBottom: \"1px solid rgba(148,163,184,0.15)\",\n            background: \"rgba(15,23,42,0.5)\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              marginBottom: \"12px\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              style: {\n                margin: 0,\n                fontSize: \"18px\",\n                fontWeight: 700\n              },\n              children: \"\\u0414\\u0438\\u0430\\u043B\\u043E\\u0433\\u0438\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 982,\n              columnNumber: 15\n            }, this), unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                padding: \"5px 14px\",\n                background: \"linear-gradient(135deg, #10b981, #059669)\",\n                color: \"white\",\n                borderRadius: \"9999px\",\n                fontSize: \"12px\",\n                fontWeight: 600,\n                boxShadow: \"0 0 12px rgba(16, 185, 129, 0.4)\",\n                border: \"1px solid rgba(16, 185, 129, 0.3)\"\n              },\n              children: [unreadCount, \" \", unreadCount === 1 ? \"новое\" : \"новых\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 984,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 981,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"msg-refresh-btn\",\n            onClick: loadMessages,\n            disabled: loading,\n            style: {\n              width: \"100%\",\n              padding: \"10px 16px\",\n              background: loading ? \"rgba(14,165,233,0.3)\" : \"linear-gradient(135deg, #0ea5e9, #0284c7)\",\n              color: \"white\",\n              border: \"none\",\n              borderRadius: \"10px\",\n              fontSize: \"13px\",\n              fontWeight: 600,\n              cursor: loading ? \"not-allowed\" : \"pointer\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              gap: \"8px\",\n              transition: \"all 0.15s ease\"\n            },\n            children: loading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Spinner, {\n                size: 16,\n                color: \"#fff\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1021,\n                columnNumber: 19\n              }, this), \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439...\"]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                width: \"16\",\n                height: \"16\",\n                viewBox: \"0 0 24 24\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                strokeWidth: \"2.5\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                children: [/*#__PURE__*/_jsxDEV(\"polyline\", {\n                  points: \"23 4 23 10 17 10\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1027,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1028,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1026,\n                columnNumber: 19\n              }, this), \"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u044F\"]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 998,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 976,\n          columnNumber: 11\n        }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            margin: \"12px\",\n            padding: \"12px 16px\",\n            background: \"rgba(239,68,68,0.15)\",\n            border: \"1px solid rgba(239,68,68,0.3)\",\n            borderRadius: \"10px\",\n            fontSize: \"13px\",\n            color: \"#fca5a5\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 600,\n              marginBottom: \"4px\"\n            },\n            children: \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0438\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1047,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1048,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: loadMessages,\n            style: {\n              marginTop: \"8px\",\n              padding: \"4px 12px\",\n              background: \"rgba(239,68,68,0.3)\",\n              color: \"#fca5a5\",\n              border: \"1px solid rgba(239,68,68,0.4)\",\n              borderRadius: \"6px\",\n              fontSize: \"12px\",\n              cursor: \"pointer\"\n            },\n            children: \"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043D\\u043E\\u0432\\u0430\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1049,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1038,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            flex: 1,\n            overflow: \"auto\"\n          },\n          children: loading && messages.length === 0 ?\n          /*#__PURE__*/\n          // Loading skeleton\n          _jsxDEV(\"div\", {\n            style: {\n              padding: \"8px 0\"\n            },\n            children: [1, 2, 3, 4, 5].map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                padding: \"14px 20px\",\n                display: \"flex\",\n                gap: \"12px\",\n                alignItems: \"center\",\n                borderBottom: \"1px solid rgba(148,163,184,0.08)\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  width: \"52px\",\n                  height: \"52px\",\n                  borderRadius: \"12px\",\n                  background: \"rgba(148,163,184,0.1)\",\n                  flexShrink: 0,\n                  animation: \"pulse 1.5s ease-in-out infinite\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1080,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  flex: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    height: \"14px\",\n                    width: \"60%\",\n                    background: \"rgba(148,163,184,0.1)\",\n                    borderRadius: \"4px\",\n                    marginBottom: \"8px\",\n                    animation: \"pulse 1.5s ease-in-out infinite\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1089,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    height: \"12px\",\n                    width: \"80%\",\n                    background: \"rgba(148,163,184,0.08)\",\n                    borderRadius: \"4px\",\n                    marginBottom: \"6px\",\n                    animation: \"pulse 1.5s ease-in-out infinite\",\n                    animationDelay: \"0.1s\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1097,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    height: \"10px\",\n                    width: \"40%\",\n                    background: \"rgba(148,163,184,0.06)\",\n                    borderRadius: \"4px\",\n                    animation: \"pulse 1.5s ease-in-out infinite\",\n                    animationDelay: \"0.2s\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1106,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1088,\n                columnNumber: 21\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1073,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1071,\n            columnNumber: 15\n          }, this) : messages.length === 0 && !loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              padding: \"60px 20px\",\n              textAlign: \"center\",\n              color: \"#64748b\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"40px\",\n                marginBottom: \"12px\",\n                opacity: 0.5\n              },\n              children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                width: \"48\",\n                height: \"48\",\n                viewBox: \"0 0 24 24\",\n                fill: \"none\",\n                stroke: \"currentColor\",\n                strokeWidth: \"1.5\",\n                style: {\n                  margin: \"0 auto\",\n                  display: \"block\",\n                  color: \"#475569\"\n                },\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1126,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1125,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1124,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"15px\",\n                fontWeight: 600,\n                marginBottom: \"4px\"\n              },\n              children: \"\\u041D\\u0435\\u0442 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1129,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"13px\"\n              },\n              children: \"\\u041D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435 \\\"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\\\" \\u0434\\u043B\\u044F \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0438\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1130,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1119,\n            columnNumber: 15\n          }, this) : messages.map(message => {\n            const rawPreviewImage = getRawMessagePreviewImage(message);\n            const previewImage = toMessageImageSrc(rawPreviewImage, message === null || message === void 0 ? void 0 : message.accountId);\n            const directPreviewImage = normalizePreviewImageUrl(rawPreviewImage);\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"msg-conv-item\",\n              onClick: () => {\n                markAsRead(message);\n                setSelectedMessage(message);\n                fetchThread(message);\n              },\n              style: {\n                padding: \"14px 20px\",\n                borderBottom: \"1px solid rgba(148,163,184,0.08)\",\n                cursor: \"pointer\",\n                background: (selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.id) === message.id ? \"rgba(59,130,246,0.15)\" : message.unread ? \"rgba(34,197,94,0.08)\" : \"transparent\",\n                borderLeft: (selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.id) === message.id ? \"3px solid #3b82f6\" : message.unread ? \"3px solid #22c55e\" : \"3px solid transparent\",\n                display: \"flex\",\n                alignItems: \"flex-start\",\n                gap: \"12px\",\n                transition: \"background 0.15s ease\",\n                animation: \"fadeIn 0.2s ease\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  width: \"52px\",\n                  height: \"52px\",\n                  borderRadius: \"50%\",\n                  overflow: \"hidden\",\n                  background: \"rgba(15,23,42,0.6)\",\n                  border: \"1px solid rgba(148,163,184,0.15)\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  flexShrink: 0\n                },\n                children: [previewImage ? /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: previewImage,\n                  \"data-direct-src\": directPreviewImage || \"\",\n                  \"data-fallback-tried\": \"0\",\n                  alt: \"\",\n                  style: {\n                    width: \"100%\",\n                    height: \"100%\",\n                    objectFit: \"cover\"\n                  },\n                  loading: \"lazy\",\n                  referrerPolicy: \"no-referrer\",\n                  onError: e => {\n                    var _imageNode$dataset, _imageNode$dataset2;\n                    const imageNode = e.currentTarget;\n                    const directSrc = String(((_imageNode$dataset = imageNode.dataset) === null || _imageNode$dataset === void 0 ? void 0 : _imageNode$dataset.directSrc) || \"\").trim();\n                    const fallbackTried = ((_imageNode$dataset2 = imageNode.dataset) === null || _imageNode$dataset2 === void 0 ? void 0 : _imageNode$dataset2.fallbackTried) === \"1\";\n                    const currentSrc = String(imageNode.getAttribute(\"src\") || \"\").trim();\n                    if (!fallbackTried && directSrc && directSrc !== currentSrc) {\n                      imageNode.dataset.fallbackTried = \"1\";\n                      imageNode.setAttribute(\"src\", directSrc);\n                      return;\n                    }\n                    imageNode.style.display = \"none\";\n                    const fallbackNode = imageNode.nextElementSibling;\n                    if (fallbackNode) fallbackNode.style.display = \"flex\";\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1181,\n                  columnNumber: 23\n                }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    width: \"100%\",\n                    height: \"100%\",\n                    background: message.unread ? \"linear-gradient(135deg, #22c55e, #16a34a)\" : \"linear-gradient(135deg, #3b82f6, #2563eb)\",\n                    color: \"white\",\n                    display: previewImage ? \"none\" : \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    fontSize: \"20px\",\n                    fontWeight: 700\n                  },\n                  children: (message.sender || \"?\").charAt(0).toUpperCase()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1205,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1168,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  flex: 1,\n                  minWidth: 0\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"3px\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      fontWeight: 700,\n                      fontSize: \"14px\",\n                      color: \"#f1f5f9\",\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\",\n                      whiteSpace: \"nowrap\",\n                      maxWidth: \"65%\"\n                    },\n                    children: message.sender || \"Неизвестный\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1226,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      fontSize: \"11px\",\n                      color: \"#64748b\",\n                      whiteSpace: \"nowrap\",\n                      flexShrink: 0\n                    },\n                    children: getTimeAgo(message.date, message.time)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1237,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1225,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    fontSize: \"13px\",\n                    color: \"#94a3b8\",\n                    fontWeight: 600,\n                    overflow: \"hidden\",\n                    textOverflow: \"ellipsis\",\n                    whiteSpace: \"nowrap\",\n                    marginBottom: \"3px\"\n                  },\n                  children: message.adTitle || \"Без названия\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1248,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    fontSize: \"12px\",\n                    color: \"#64748b\",\n                    overflow: \"hidden\",\n                    textOverflow: \"ellipsis\",\n                    whiteSpace: \"nowrap\",\n                    marginBottom: \"4px\"\n                  },\n                  children: message.message || \"\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1261,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    gap: \"6px\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      fontSize: \"11px\",\n                      color: \"#475569\",\n                      background: \"rgba(148,163,184,0.1)\",\n                      padding: \"1px 6px\",\n                      borderRadius: \"4px\"\n                    },\n                    children: message.accountName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1278,\n                    columnNumber: 23\n                  }, this), message.unread && /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      padding: \"3px 10px\",\n                      background: \"linear-gradient(135deg, #8b5cf6, #7c3aed)\",\n                      color: \"white\",\n                      borderRadius: \"9999px\",\n                      fontSize: \"10px\",\n                      fontWeight: 700,\n                      textTransform: \"uppercase\",\n                      letterSpacing: \"0.5px\",\n                      boxShadow: \"0 0 10px rgba(139, 92, 246, 0.4)\",\n                      border: \"1px solid rgba(139, 92, 246, 0.3)\"\n                    },\n                    children: \"new\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1288,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1273,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1223,\n                columnNumber: 19\n              }, this)]\n            }, message.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1138,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1068,\n          columnNumber: 11\n        }, this), messages.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: \"8px 20px\",\n            borderTop: \"1px solid rgba(148,163,184,0.1)\",\n            fontSize: \"11px\",\n            color: \"#475569\",\n            textAlign: \"center\",\n            background: \"rgba(15,23,42,0.3)\"\n          },\n          children: [messages.length, \" \", messages.length === 1 ? \"диалог\" : messages.length < 5 ? \"диалога\" : \"диалогов\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1313,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 961,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"messages-chat\",\n        style: {\n          flex: 1,\n          position: \"relative\",\n          background: \"linear-gradient(145deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.95) 100%)\",\n          borderRadius: \"20px\",\n          overflow: \"hidden\",\n          boxShadow: \"0 20px 50px rgba(0,0,0,0.4), 0 0 30px rgba(0,0,0,0.2)\",\n          border: \"1px solid rgba(148,163,184,0.12)\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          color: \"#e2e8f0\",\n          backdropFilter: \"blur(10px)\",\n          ...(showChatPanel ? {} : {\n            display: \"none\"\n          })\n        },\n        children: selectedMessage ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              padding: \"14px 20px\",\n              borderBottom: \"1px solid rgba(148,163,184,0.15)\",\n              background: \"rgba(15,23,42,0.6)\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: \"flex\",\n                  gap: \"14px\",\n                  alignItems: \"center\",\n                  flex: 1,\n                  minWidth: 0\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    width: \"50px\",\n                    height: \"50px\",\n                    borderRadius: \"10px\",\n                    overflow: \"hidden\",\n                    border: \"1px solid rgba(148,163,184,0.15)\",\n                    background: \"rgba(15,23,42,0.8)\",\n                    flexShrink: 0,\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\"\n                  },\n                  children: selectedPreviewImage ? /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: selectedPreviewImage,\n                    \"data-direct-src\": selectedDirectPreviewImage || \"\",\n                    \"data-fallback-tried\": \"0\",\n                    alt: \"\",\n                    style: {\n                      width: \"100%\",\n                      height: \"100%\",\n                      objectFit: \"cover\"\n                    },\n                    onError: e => {\n                      var _imageNode$dataset3, _imageNode$dataset4;\n                      const imageNode = e.currentTarget;\n                      const directSrc = String(((_imageNode$dataset3 = imageNode.dataset) === null || _imageNode$dataset3 === void 0 ? void 0 : _imageNode$dataset3.directSrc) || \"\").trim();\n                      const fallbackTried = ((_imageNode$dataset4 = imageNode.dataset) === null || _imageNode$dataset4 === void 0 ? void 0 : _imageNode$dataset4.fallbackTried) === \"1\";\n                      const currentSrc = String(imageNode.getAttribute(\"src\") || \"\").trim();\n                      if (!fallbackTried && directSrc && directSrc !== currentSrc) {\n                        imageNode.dataset.fallbackTried = \"1\";\n                        imageNode.setAttribute(\"src\", directSrc);\n                        return;\n                      }\n                      imageNode.style.display = \"none\";\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1365,\n                    columnNumber: 25\n                  }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n                    width: \"24\",\n                    height: \"24\",\n                    viewBox: \"0 0 24 24\",\n                    fill: \"none\",\n                    stroke: \"#475569\",\n                    strokeWidth: \"1.5\",\n                    children: [/*#__PURE__*/_jsxDEV(\"rect\", {\n                      x: \"3\",\n                      y: \"3\",\n                      width: \"18\",\n                      height: \"18\",\n                      rx: \"2\",\n                      ry: \"2\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1386,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                      cx: \"8.5\",\n                      cy: \"8.5\",\n                      r: \"1.5\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1387,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"polyline\", {\n                      points: \"21 15 16 10 5 21\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1388,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1385,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1352,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    minWidth: 0\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      fontWeight: 700,\n                      fontSize: \"15px\",\n                      color: \"#f1f5f9\",\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\",\n                      whiteSpace: \"nowrap\"\n                    },\n                    children: selectedMessage.sender || \"Неизвестный\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1394,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      fontSize: \"13px\",\n                      color: \"#94a3b8\",\n                      fontWeight: 500,\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\",\n                      whiteSpace: \"nowrap\",\n                      marginTop: \"2px\"\n                    },\n                    children: selectedMessage.adTitle || \"Без названия\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1404,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      fontSize: \"11px\",\n                      color: \"#475569\",\n                      marginTop: \"2px\"\n                    },\n                    children: selectedMessage.accountName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1415,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1393,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1350,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setSelectedMessage(null),\n                style: {\n                  background: \"rgba(148,163,184,0.1)\",\n                  border: \"none\",\n                  width: isMobileView ? \"auto\" : \"32px\",\n                  height: \"32px\",\n                  padding: isMobileView ? \"0 10px\" : 0,\n                  borderRadius: \"8px\",\n                  cursor: \"pointer\",\n                  color: \"#94a3b8\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  fontSize: \"16px\",\n                  fontWeight: 600,\n                  flexShrink: 0\n                },\n                children: isMobileView ? \"← Назад\" : /*#__PURE__*/_jsxDEV(\"svg\", {\n                  width: \"16\",\n                  height: \"16\",\n                  viewBox: \"0 0 24 24\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  strokeWidth: \"2.5\",\n                  strokeLinecap: \"round\",\n                  children: [/*#__PURE__*/_jsxDEV(\"line\", {\n                    x1: \"18\",\n                    y1: \"6\",\n                    x2: \"6\",\n                    y2: \"18\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1448,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n                    x1: \"6\",\n                    y1: \"6\",\n                    x2: \"18\",\n                    y2: \"18\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1449,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1447,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1425,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1349,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1344,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: chatScrollRef,\n            style: {\n              flex: 1,\n              padding: \"20px\",\n              overflow: \"auto\",\n              background: \"rgba(8,12,24,0.4)\"\n            },\n            children: loadingThread ? /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                flexDirection: \"column\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                height: \"100%\",\n                gap: \"12px\",\n                color: \"#64748b\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(Spinner, {\n                size: 32,\n                color: \"#3b82f6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1473,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  fontSize: \"14px\"\n                },\n                children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0434\\u0438\\u0430\\u043B\\u043E\\u0433\\u0430...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1474,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1464,\n              columnNumber: 19\n            }, this) : threadMessages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                color: \"#64748b\",\n                textAlign: \"center\",\n                paddingTop: \"40px\"\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: \"14px\"\n                },\n                children: \"\\u041D\\u0435\\u0442 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439 \\u0432 \\u044D\\u0442\\u043E\\u043C \\u0434\\u0438\\u0430\\u043B\\u043E\\u0433\\u0435\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1478,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1477,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: threadMessages.map((messageItem, idx) => {\n                const isOutgoing = messageItem.direction === \"outgoing\";\n                const isPending = Boolean(messageItem.pending);\n                const isOffer = isPaymentAndShippingMessage(messageItem);\n                const messageKey = String(messageItem.id || `idx-${idx}`);\n                const translation = translationByMessageId[messageKey] || null;\n                const hasText = Boolean(String(messageItem.text || \"\").trim());\n                const attachmentSrcs = extractAttachmentUrls(messageItem).map(url => toMessageImageSrc(url, selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.accountId)).filter(Boolean);\n                const canTranslate = !isOffer && !isOutgoing && hasText;\n                const toggleTranslate = async () => {\n                  if (!canTranslate) return;\n\n                  // Toggle off when already shown.\n                  if (translation !== null && translation !== void 0 && translation.shown && translation !== null && translation !== void 0 && translation.translatedText) {\n                    setTranslationByMessageId(prev => ({\n                      ...prev,\n                      [messageKey]: {\n                        ...prev[messageKey],\n                        shown: false\n                      }\n                    }));\n                    return;\n                  }\n\n                  // Toggle on when already fetched.\n                  if (translation !== null && translation !== void 0 && translation.translatedText && !(translation !== null && translation !== void 0 && translation.loading)) {\n                    setTranslationByMessageId(prev => ({\n                      ...prev,\n                      [messageKey]: {\n                        ...prev[messageKey],\n                        shown: true,\n                        error: \"\"\n                      }\n                    }));\n                    return;\n                  }\n                  if (translateInFlight.current.has(messageKey)) return;\n                  translateInFlight.current.add(messageKey);\n                  setTranslationByMessageId(prev => ({\n                    ...prev,\n                    [messageKey]: {\n                      ...prev[messageKey],\n                      loading: true,\n                      shown: true,\n                      error: \"\"\n                    }\n                  }));\n                  try {\n                    const result = await apiFetchJson(\"/api/translate\", {\n                      method: \"POST\",\n                      headers: {\n                        \"Content-Type\": \"application/json\"\n                      },\n                      body: JSON.stringify({\n                        text: String(messageItem.text || \"\"),\n                        to: \"ru\",\n                        accountId: selectedMessage === null || selectedMessage === void 0 ? void 0 : selectedMessage.accountId\n                      })\n                    });\n                    setTranslationByMessageId(prev => ({\n                      ...prev,\n                      [messageKey]: {\n                        loading: false,\n                        shown: true,\n                        error: \"\",\n                        translatedText: (result === null || result === void 0 ? void 0 : result.translatedText) || \"\"\n                      }\n                    }));\n                  } catch (error) {\n                    console.error(\"Ошибка перевода:\", error);\n                    setTranslationByMessageId(prev => ({\n                      ...prev,\n                      [messageKey]: {\n                        loading: false,\n                        shown: true,\n                        translatedText: \"\",\n                        error: (error === null || error === void 0 ? void 0 : error.message) || \"Не удалось перевести\"\n                      }\n                    }));\n                  } finally {\n                    translateInFlight.current.delete(messageKey);\n                  }\n                };\n                const offerTitle = String((messageItem === null || messageItem === void 0 ? void 0 : messageItem.title) || \"Anfrage erhalten\").trim() || \"Anfrage erhalten\";\n                const offerItemCents = pickOfferField(messageItem, \"itemPriceInEuroCent\");\n                const offerShippingCents = pickOfferField(messageItem, \"shippingCostInEuroCent\");\n                const offerTotalCents = pickOfferField(messageItem, \"sellerTotalInEuroCent\");\n                const offerCarrierName = pickOfferField(messageItem, \"carrierName\");\n                const offerOptionName = pickOfferField(messageItem, \"shippingOptionName\");\n                const offerOptionDesc = pickOfferField(messageItem, \"shippingOptionDescription\");\n                const offerLiabilityCents = pickOfferField(messageItem, \"liabilityLimitInEuroCent\");\n                const acceptCta = getOfferActionText(messageItem, \"ACCEPT_BUYER_OFFER_LEARN_MORE_ACTION\", \"Anfrage akzeptieren\");\n                const declineCta = getOfferActionText(messageItem, \"CANCEL_OFFER_ACTION\", \"Anfrage ablehnen\");\n                const counterCta = getOfferActionText(messageItem, \"MAKE_COUNTER_OFFER_ACTION\", \"Gegenangebot machen\");\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    marginBottom: \"12px\",\n                    display: \"flex\",\n                    justifyContent: isOutgoing ? \"flex-end\" : \"flex-start\",\n                    animation: \"fadeIn 0.2s ease\"\n                  },\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      maxWidth: isOffer ? \"520px\" : \"70%\",\n                      minWidth: isOffer ? \"240px\" : \"120px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        fontSize: \"11px\",\n                        color: isOutgoing ? \"#86efac\" : \"#7dd3fc\",\n                        fontWeight: 600,\n                        marginBottom: \"4px\",\n                        paddingLeft: isOutgoing ? \"0\" : \"12px\",\n                        paddingRight: isOutgoing ? \"12px\" : \"0\",\n                        textAlign: isOutgoing ? \"right\" : \"left\"\n                      },\n                      children: messageItem.sender || (isOutgoing ? \"Вы\" : selectedMessage.sender || \"\")\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1600,\n                      columnNumber: 30\n                    }, this), isOffer ? /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        borderRadius: \"18px\",\n                        padding: \"14px 14px 12px 14px\",\n                        background: \"linear-gradient(145deg, rgba(2,6,23,0.55) 0%, rgba(15,23,42,0.95) 58%, rgba(6,78,59,0.22) 100%)\",\n                        border: \"1px solid rgba(34,197,94,0.22)\",\n                        boxShadow: \"0 18px 40px rgba(0,0,0,0.45)\"\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          display: \"flex\",\n                          justifyContent: \"space-between\",\n                          alignItems: \"flex-start\",\n                          gap: \"12px\",\n                          marginBottom: \"12px\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            display: \"flex\",\n                            gap: \"10px\",\n                            alignItems: \"center\",\n                            minWidth: 0\n                          },\n                          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                            style: {\n                              width: \"36px\",\n                              height: \"36px\",\n                              borderRadius: \"12px\",\n                              background: \"rgba(34,197,94,0.18)\",\n                              border: \"1px solid rgba(34,197,94,0.25)\",\n                              display: \"flex\",\n                              alignItems: \"center\",\n                              justifyContent: \"center\",\n                              flexShrink: 0\n                            },\n                            children: /*#__PURE__*/_jsxDEV(\"span\", {\n                              style: {\n                                color: \"#4ade80\",\n                                fontWeight: 900,\n                                fontSize: \"16px\"\n                              },\n                              children: \"\\u20AC\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1639,\n                              columnNumber: 40\n                            }, this)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1628,\n                            columnNumber: 38\n                          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                            style: {\n                              minWidth: 0\n                            },\n                            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                              style: {\n                                fontSize: \"14px\",\n                                fontWeight: 800,\n                                color: \"#bbf7d0\",\n                                overflow: \"hidden\",\n                                textOverflow: \"ellipsis\",\n                                whiteSpace: \"nowrap\"\n                              },\n                              children: offerTitle\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1642,\n                              columnNumber: 40\n                            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                              style: {\n                                fontSize: \"12px\",\n                                color: \"rgba(148,163,184,0.9)\",\n                                marginTop: \"1px\"\n                              },\n                              children: \"Sicher bezahlen\"\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 1652,\n                              columnNumber: 40\n                            }, this)]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1641,\n                            columnNumber: 38\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1627,\n                          columnNumber: 36\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            fontSize: \"20px\",\n                            fontWeight: 900,\n                            color: \"#4ade80\",\n                            whiteSpace: \"nowrap\"\n                          },\n                          children: formatEuroFromCents(offerTotalCents)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1661,\n                          columnNumber: 36\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1620,\n                        columnNumber: 34\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          display: \"flex\",\n                          flexDirection: \"column\",\n                          gap: \"8px\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            display: \"flex\",\n                            justifyContent: \"space-between\",\n                            color: \"rgba(226,232,240,0.92)\",\n                            fontSize: \"13px\"\n                          },\n                          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              color: \"rgba(148,163,184,0.95)\"\n                            },\n                            children: \"Betrag\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1673,\n                            columnNumber: 38\n                          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              fontWeight: 700\n                            },\n                            children: formatEuroFromCents(offerItemCents)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1674,\n                            columnNumber: 38\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1672,\n                          columnNumber: 36\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            display: \"flex\",\n                            justifyContent: \"space-between\",\n                            color: \"rgba(226,232,240,0.92)\",\n                            fontSize: \"13px\"\n                          },\n                          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              color: \"rgba(148,163,184,0.95)\"\n                            },\n                            children: \"Versand\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1677,\n                            columnNumber: 38\n                          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              fontWeight: 700\n                            },\n                            children: formatEuroFromCents(offerShippingCents)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1678,\n                            columnNumber: 38\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1676,\n                          columnNumber: 36\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            display: \"flex\",\n                            justifyContent: \"space-between\",\n                            fontSize: \"13px\",\n                            paddingTop: \"6px\",\n                            borderTop: \"1px solid rgba(148,163,184,0.12)\"\n                          },\n                          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              color: \"rgba(148,163,184,0.95)\",\n                              fontWeight: 800\n                            },\n                            children: \"Gesamt\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1687,\n                            columnNumber: 38\n                          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              fontWeight: 900,\n                              color: \"#e2e8f0\"\n                            },\n                            children: formatEuroFromCents(offerTotalCents)\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1688,\n                            columnNumber: 38\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1680,\n                          columnNumber: 36\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1671,\n                        columnNumber: 34\n                      }, this), offerCarrierName || offerOptionName || offerOptionDesc ? /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          marginTop: \"12px\",\n                          padding: \"12px\",\n                          borderRadius: \"14px\",\n                          background: \"rgba(2,6,23,0.25)\",\n                          border: \"1px solid rgba(148,163,184,0.14)\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            fontSize: \"13px\",\n                            fontWeight: 800,\n                            color: \"#e2e8f0\"\n                          },\n                          children: [\"Inkl. \", offerCarrierName || \"Versand\", \" \", offerOptionName || \"\"]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1700,\n                          columnNumber: 38\n                        }, this), offerOptionDesc ? /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            marginTop: \"4px\",\n                            fontSize: \"12px\",\n                            color: \"rgba(148,163,184,0.95)\"\n                          },\n                          children: offerOptionDesc\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1704,\n                          columnNumber: 40\n                        }, this) : null, offerLiabilityCents ? /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            marginTop: \"6px\",\n                            fontSize: \"12px\",\n                            color: \"rgba(148,163,184,0.95)\"\n                          },\n                          children: [\"Mit Sendungsverfolgung und Haftung bis \", formatEuroFromCents(offerLiabilityCents)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1709,\n                          columnNumber: 40\n                        }, this) : null]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1693,\n                        columnNumber: 36\n                      }, this) : null, hasText ? /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          marginTop: \"12px\",\n                          fontSize: \"13px\",\n                          lineHeight: \"1.5\",\n                          color: \"rgba(226,232,240,0.92)\"\n                        },\n                        children: messageItem.text\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1717,\n                        columnNumber: 36\n                      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          marginTop: \"12px\",\n                          display: \"flex\",\n                          flexDirection: \"column\",\n                          gap: \"10px\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                          type: \"button\",\n                          disabled: true,\n                          style: {\n                            width: \"100%\",\n                            padding: \"10px 14px\",\n                            borderRadius: \"9999px\",\n                            border: \"1px solid rgba(34,197,94,0.32)\",\n                            background: \"linear-gradient(135deg, rgba(34,197,94,0.55), rgba(22,163,74,0.45))\",\n                            color: \"rgba(255,255,255,0.95)\",\n                            fontWeight: 900,\n                            cursor: \"not-allowed\",\n                            opacity: 0.75\n                          },\n                          title: \"\\u0421\\u043A\\u043E\\u0440\\u043E\",\n                          children: acceptCta\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1728,\n                          columnNumber: 36\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          style: {\n                            display: \"flex\",\n                            gap: \"10px\"\n                          },\n                          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                            type: \"button\",\n                            onClick: () => setDeclineConfirmOpen(true),\n                            disabled: decliningOffer,\n                            style: {\n                              flex: 1,\n                              padding: \"10px 14px\",\n                              borderRadius: \"9999px\",\n                              border: \"1px solid rgba(148,163,184,0.28)\",\n                              background: \"rgba(2,6,23,0.35)\",\n                              color: \"rgba(226,232,240,0.95)\",\n                              fontWeight: 800,\n                              cursor: decliningOffer ? \"not-allowed\" : \"pointer\",\n                              opacity: decliningOffer ? 0.7 : 1\n                            },\n                            children: declineCta\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1747,\n                            columnNumber: 38\n                          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                            type: \"button\",\n                            disabled: true,\n                            style: {\n                              flex: 1,\n                              padding: \"10px 14px\",\n                              borderRadius: \"9999px\",\n                              border: \"1px solid rgba(148,163,184,0.22)\",\n                              background: \"rgba(2,6,23,0.25)\",\n                              color: \"rgba(148,163,184,0.95)\",\n                              fontWeight: 800,\n                              cursor: \"not-allowed\",\n                              opacity: 0.75\n                            },\n                            title: \"\\u0421\\u043A\\u043E\\u0440\\u043E\",\n                            children: counterCta\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1765,\n                            columnNumber: 38\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1746,\n                          columnNumber: 36\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1727,\n                        columnNumber: 34\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          fontSize: \"10px\",\n                          color: \"rgba(148,163,184,0.8)\",\n                          marginTop: \"10px\",\n                          textAlign: \"right\"\n                        },\n                        children: isPending ? \"Отправка...\" : formatMessageDate(messageItem.date || selectedMessage.date, messageItem.time || selectedMessage.time)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1786,\n                        columnNumber: 34\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1613,\n                      columnNumber: 32\n                    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        position: \"relative\",\n                        padding: canTranslate ? \"10px 14px 18px 14px\" : \"10px 14px\",\n                        borderRadius: isOutgoing ? \"14px 14px 4px 14px\" : \"14px 14px 14px 4px\",\n                        background: isOutgoing ? \"linear-gradient(135deg, #1a4731, #14532d)\" : \"rgba(15,23,42,0.8)\",\n                        border: isOutgoing ? \"1px solid rgba(34,197,94,0.25)\" : \"1px solid rgba(148,163,184,0.15)\"\n                      },\n                      children: [attachmentSrcs.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          display: \"grid\",\n                          gridTemplateColumns: \"repeat(auto-fit, minmax(120px, 1fr))\",\n                          gap: \"8px\",\n                          marginBottom: hasText ? \"8px\" : \"0\"\n                        },\n                        children: attachmentSrcs.map((src, imageIdx) => /*#__PURE__*/_jsxDEV(\"img\", {\n                          src: src,\n                          alt: \"\",\n                          loading: \"lazy\",\n                          referrerPolicy: \"no-referrer\",\n                          style: {\n                            width: \"100%\",\n                            maxHeight: \"220px\",\n                            objectFit: \"cover\",\n                            borderRadius: \"12px\",\n                            border: \"1px solid rgba(148,163,184,0.14)\"\n                          }\n                        }, `${messageKey}-img-${imageIdx}`, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1818,\n                          columnNumber: 40\n                        }, this))\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1811,\n                        columnNumber: 36\n                      }, this), hasText ? /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          fontSize: \"14px\",\n                          lineHeight: \"1.5\",\n                          whiteSpace: \"pre-wrap\",\n                          wordBreak: \"break-word\",\n                          color: \"#e2e8f0\"\n                        },\n                        children: messageItem.text\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1837,\n                        columnNumber: 36\n                      }, this) : null, canTranslate && /*#__PURE__*/_jsxDEV(\"button\", {\n                        type: \"button\",\n                        className: \"msg-translate-btn\",\n                        onClick: toggleTranslate,\n                        title: \"\\u041F\\u0435\\u0440\\u0435\\u0432\\u0435\\u0441\\u0442\\u0438 \\u043D\\u0430 \\u0440\\u0443\\u0441\\u0441\\u043A\\u0438\\u0439\",\n                        style: {\n                          position: \"absolute\",\n                          left: \"8px\",\n                          bottom: \"6px\",\n                          width: \"22px\",\n                          height: \"22px\",\n                          borderRadius: \"8px\",\n                          border: \"1px solid rgba(148,163,184,0.18)\",\n                          background: \"rgba(2,6,23,0.25)\",\n                          color: \"#94a3b8\",\n                          display: \"inline-flex\",\n                          alignItems: \"center\",\n                          justifyContent: \"center\",\n                          cursor: \"pointer\",\n                          opacity: 0.75,\n                          transition: \"transform 0.12s ease, opacity 0.12s ease, background 0.12s ease\"\n                        },\n                        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                          width: \"14\",\n                          height: \"14\",\n                          viewBox: \"0 0 24 24\",\n                          fill: \"none\",\n                          stroke: \"currentColor\",\n                          strokeWidth: \"2.2\",\n                          strokeLinecap: \"round\",\n                          strokeLinejoin: \"round\",\n                          children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M5 5h6\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1874,\n                            columnNumber: 40\n                          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M8 5c0 6-3 10-6 12\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1875,\n                            columnNumber: 40\n                          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M7 13c2 2 4 4 7 6\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1876,\n                            columnNumber: 40\n                          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M14 19h7\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1877,\n                            columnNumber: 40\n                          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M17 4l4 15\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1878,\n                            columnNumber: 40\n                          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M20 19l-3-9-3 9\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 1879,\n                            columnNumber: 40\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1873,\n                          columnNumber: 38\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1850,\n                        columnNumber: 36\n                      }, this), (translation === null || translation === void 0 ? void 0 : translation.shown) && /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          marginTop: \"10px\",\n                          paddingTop: \"8px\",\n                          borderTop: \"1px dashed rgba(148,163,184,0.18)\",\n                          fontSize: \"13px\",\n                          lineHeight: \"1.45\",\n                          color: translation !== null && translation !== void 0 && translation.error ? \"#fb7185\" : \"#cbd5e1\",\n                          opacity: 0.95\n                        },\n                        children: translation !== null && translation !== void 0 && translation.loading ? /*#__PURE__*/_jsxDEV(\"span\", {\n                          style: {\n                            color: \"#94a3b8\"\n                          },\n                          children: \"\\u041F\\u0435\\u0440\\u0435\\u0432\\u043E\\u0434...\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1896,\n                          columnNumber: 40\n                        }, this) : translation !== null && translation !== void 0 && translation.error ? /*#__PURE__*/_jsxDEV(\"span\", {\n                          children: translation.error\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1898,\n                          columnNumber: 40\n                        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n                          children: translation.translatedText\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1900,\n                          columnNumber: 40\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1886,\n                        columnNumber: 36\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          fontSize: \"10px\",\n                          color: \"#64748b\",\n                          marginTop: \"6px\",\n                          textAlign: \"right\"\n                        },\n                        children: isPending ? \"Отправка...\" : formatMessageDate(messageItem.date || selectedMessage.date, messageItem.time || selectedMessage.time)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1906,\n                        columnNumber: 34\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1799,\n                      columnNumber: 32\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1595,\n                    columnNumber: 28\n                  }, this)\n                }, messageItem.id || idx, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1586,\n                  columnNumber: 26\n                }, this);\n              })\n            }, void 0, false)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1457,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              padding: \"14px 20px\",\n              borderTop: \"1px solid rgba(148,163,184,0.15)\",\n              background: \"rgba(15,23,42,0.6)\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              ref: fileInputRef,\n              type: \"file\",\n              accept: \"image/*\",\n              multiple: true,\n              onChange: handleReplyImageSelect,\n              style: {\n                display: \"none\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1933,\n              columnNumber: 17\n            }, this), replyImages.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginBottom: \"10px\",\n                display: \"flex\",\n                gap: \"8px\",\n                overflowX: \"auto\",\n                paddingBottom: \"2px\"\n              },\n              children: replyImages.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: \"relative\",\n                  width: \"72px\",\n                  height: \"72px\",\n                  borderRadius: \"10px\",\n                  border: \"1px solid rgba(148,163,184,0.2)\",\n                  overflow: \"hidden\",\n                  flexShrink: 0\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  src: item.previewUrl,\n                  alt: \"\",\n                  style: {\n                    width: \"100%\",\n                    height: \"100%\",\n                    objectFit: \"cover\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1963,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => removeReplyImage(item.id),\n                  style: {\n                    position: \"absolute\",\n                    top: \"4px\",\n                    right: \"4px\",\n                    width: \"20px\",\n                    height: \"20px\",\n                    borderRadius: \"9999px\",\n                    border: \"none\",\n                    background: \"rgba(2,6,23,0.72)\",\n                    color: \"#f8fafc\",\n                    fontSize: \"12px\",\n                    cursor: \"pointer\",\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\"\n                  },\n                  title: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\",\n                  children: \"\\xD7\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1968,\n                  columnNumber: 25\n                }, this)]\n              }, item.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1951,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1943,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                gap: \"10px\",\n                alignItems: \"flex-end\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                onClick: () => {\n                  var _fileInputRef$current;\n                  return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n                },\n                disabled: sending,\n                \"aria-label\": \"Bilder hochladen\",\n                style: {\n                  width: \"42px\",\n                  height: \"42px\",\n                  borderRadius: \"12px\",\n                  border: \"1px solid rgba(148,163,184,0.25)\",\n                  background: \"rgba(15,23,42,0.7)\",\n                  color: \"#cbd5e1\",\n                  cursor: sending ? \"not-allowed\" : \"pointer\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  flexShrink: 0\n                },\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  viewBox: \"0 0 24 24\",\n                  width: \"18\",\n                  height: \"18\",\n                  fill: \"currentColor\",\n                  \"aria-hidden\": \"true\",\n                  children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                    d: \"M12.0004 8.54376C9.72753 8.54376 7.88501 10.4042 7.88501 12.6991C7.88501 14.994 9.72753 16.8544 12.0004 16.8544C14.2733 16.8544 16.1158 14.994 16.1158 12.6991C16.1158 10.4042 14.2733 8.54376 12.0004 8.54376ZM9.88501 12.6991C9.88501 11.5195 10.8321 10.5632 12.0004 10.5632C13.1687 10.5632 14.1158 11.5195 14.1158 12.6991C14.1158 13.8787 13.1687 14.835 12.0004 14.835C10.8321 14.835 9.88501 13.8787 9.88501 12.6991Z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2017,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                    d: \"M9.23077 4C8.91601 4 8.61962 4.14963 8.43077 4.40388L6.65385 6.79612H4.38462C3.75218 6.79612 3.14564 7.04979 2.69844 7.50134C2.25124 7.95288 2 8.5653 2 9.20388V17.5922C2 18.2308 2.25124 18.8432 2.69844 19.2948C3.14564 19.7463 3.75218 20 4.38462 20H19.6154C20.2478 20 20.8544 19.7463 21.3016 19.2948C21.7488 18.8432 22 18.2308 22 17.5922V9.20388C22 8.5653 21.7488 7.95288 21.3016 7.50134C20.8544 7.04979 20.2478 6.79612 19.6154 6.79612H17.3462L15.5692 4.40388C15.3804 4.14963 15.084 4 14.7692 4H9.23077ZM7.95385 8.41165L9.73077 6.01942H14.2692L16.0462 8.41165C16.235 8.6659 16.5314 8.81553 16.8462 8.81553H19.6154C19.7179 8.81553 19.8163 8.85665 19.8888 8.9292C19.9614 9.00175 20.0025 9.10014 20.0025 9.20263V17.5909C20.0025 17.6934 19.9614 17.7918 19.8888 17.8644C19.8163 17.9369 19.7179 17.978 19.6154 17.978H4.38462C4.28208 17.978 4.1837 17.9369 4.11115 17.8644C4.0386 17.7918 3.99748 17.6934 3.99748 17.5909V9.20263C3.99748 9.10014 4.0386 9.00175 4.11115 8.9292C4.1837 8.85665 4.28208 8.81553 4.38462 8.81553H7.15385C7.4686 8.81553 7.765 8.6659 7.95385 8.41165Z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2018,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2016,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1997,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: replyText,\n                onChange: e => setReplyText(e.target.value),\n                onKeyDown: handleKeyDown,\n                placeholder: \"Nachricht schreiben...\",\n                rows: 1,\n                style: {\n                  flex: 1,\n                  padding: \"10px 14px\",\n                  border: \"1px solid rgba(148,163,184,0.2)\",\n                  borderRadius: \"12px\",\n                  resize: \"none\",\n                  minHeight: \"42px\",\n                  maxHeight: \"120px\",\n                  background: \"rgba(15,23,42,0.6)\",\n                  color: \"#e2e8f0\",\n                  fontSize: \"14px\",\n                  lineHeight: \"1.4\",\n                  outline: \"none\",\n                  fontFamily: \"inherit\"\n                },\n                onInput: e => {\n                  e.target.style.height = \"42px\";\n                  e.target.style.height = Math.min(e.target.scrollHeight, 120) + \"px\";\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2022,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"msg-send-btn\",\n                onClick: sendReply,\n                disabled: !canSendReply,\n                style: {\n                  padding: \"10px 20px\",\n                  background: sending ? \"rgba(34,197,94,0.4)\" : !hasReplyPayload ? \"rgba(148,163,184,0.15)\" : \"linear-gradient(135deg, #22c55e, #16a34a)\",\n                  color: !hasReplyPayload ? \"#64748b\" : \"white\",\n                  border: \"none\",\n                  borderRadius: \"12px\",\n                  cursor: !canSendReply ? \"not-allowed\" : \"pointer\",\n                  whiteSpace: \"nowrap\",\n                  fontSize: \"14px\",\n                  fontWeight: 600,\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  gap: \"6px\",\n                  height: \"42px\",\n                  transition: \"all 0.15s ease\"\n                },\n                children: sending ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(Spinner, {\n                    size: 14,\n                    color: \"#fff\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2076,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2077,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                    width: \"16\",\n                    height: \"16\",\n                    viewBox: \"0 0 24 24\",\n                    fill: \"none\",\n                    stroke: \"currentColor\",\n                    strokeWidth: \"2.5\",\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    children: [/*#__PURE__*/_jsxDEV(\"line\", {\n                      x1: \"22\",\n                      y1: \"2\",\n                      x2: \"11\",\n                      y2: \"13\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2082,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"polygon\", {\n                      points: \"22 2 15 22 11 13 2 9 22 2\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2083,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2081,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2085,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2049,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1996,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"11px\",\n                color: \"#475569\",\n                marginTop: \"6px\"\n              },\n              children: \"Enter \\u0434\\u043B\\u044F \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0438, Shift+Enter \\u0434\\u043B\\u044F \\u043D\\u043E\\u0432\\u043E\\u0439 \\u0441\\u0442\\u0440\\u043E\\u043A\\u0438\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2090,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1928,\n            columnNumber: 15\n          }, this), declineConfirmOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              inset: 0,\n              background: \"rgba(2,6,23,0.65)\",\n              backdropFilter: \"blur(2px)\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              zIndex: 40,\n              padding: \"16px\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                width: \"100%\",\n                maxWidth: \"420px\",\n                borderRadius: \"16px\",\n                border: \"1px solid rgba(148,163,184,0.2)\",\n                background: \"linear-gradient(145deg, rgba(15,23,42,0.96), rgba(2,6,23,0.98))\",\n                boxShadow: \"0 18px 60px rgba(0,0,0,0.5)\",\n                padding: \"18px\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: \"16px\",\n                  fontWeight: 700,\n                  color: \"#f8fafc\",\n                  marginBottom: \"8px\"\n                },\n                children: \"Anfrage ablehnen\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2116,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: \"13px\",\n                  lineHeight: \"1.5\",\n                  color: \"#94a3b8\",\n                  marginBottom: \"16px\"\n                },\n                children: \"M\\xF6chtest du diese Anfrage wirklich ablehnen?\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2119,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: \"flex\",\n                  gap: \"10px\",\n                  justifyContent: \"flex-end\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => setDeclineConfirmOpen(false),\n                  disabled: decliningOffer,\n                  style: {\n                    padding: \"10px 14px\",\n                    borderRadius: \"10px\",\n                    border: \"1px solid rgba(148,163,184,0.22)\",\n                    background: \"rgba(15,23,42,0.65)\",\n                    color: \"#cbd5e1\",\n                    cursor: decliningOffer ? \"not-allowed\" : \"pointer\"\n                  },\n                  children: \"Abbrechen\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2123,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: confirmDeclineOffer,\n                  disabled: decliningOffer,\n                  style: {\n                    padding: \"10px 14px\",\n                    borderRadius: \"10px\",\n                    border: \"1px solid rgba(239,68,68,0.35)\",\n                    background: \"linear-gradient(135deg, rgba(239,68,68,0.78), rgba(185,28,28,0.82))\",\n                    color: \"#fff\",\n                    fontWeight: 700,\n                    cursor: decliningOffer ? \"not-allowed\" : \"pointer\",\n                    display: \"inline-flex\",\n                    alignItems: \"center\",\n                    gap: \"6px\",\n                    minWidth: \"158px\",\n                    justifyContent: \"center\"\n                  },\n                  children: decliningOffer ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                    children: [/*#__PURE__*/_jsxDEV(Spinner, {\n                      size: 14,\n                      color: \"#fff\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2159,\n                      columnNumber: 29\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"Bitte warten\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2160,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true) : \"Anfrage ablehnen\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2138,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2122,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2107,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2096,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true) :\n        /*#__PURE__*/\n        // Empty state\n        _jsxDEV(\"div\", {\n          style: {\n            flex: 1,\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            color: \"#475569\"\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              textAlign: \"center\",\n              maxWidth: \"280px\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              width: \"64\",\n              height: \"64\",\n              viewBox: \"0 0 24 24\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              strokeWidth: \"1\",\n              style: {\n                margin: \"0 auto 16px\",\n                display: \"block\",\n                color: \"#334155\"\n              },\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2182,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2181,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              style: {\n                margin: \"0 0 8px\",\n                fontSize: \"16px\",\n                color: \"#64748b\"\n              },\n              children: \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0434\\u0438\\u0430\\u043B\\u043E\\u0433\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2184,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                margin: 0,\n                fontSize: \"13px\",\n                lineHeight: \"1.5\"\n              },\n              children: \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0434\\u0438\\u0430\\u043B\\u043E\\u0433 \\u0438\\u0437 \\u0441\\u043F\\u0438\\u0441\\u043A\\u0430 \\u0441\\u043B\\u0435\\u0432\\u0430 \\u0434\\u043B\\u044F \\u043F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440\\u0430 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439 \\u0438 \\u043E\\u0442\\u0432\\u0435\\u0442\\u0430\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2187,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2180,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2173,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1327,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 959,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(MessagesTab, \"Dc5Yo6+Tq5uRu92B7QXIW4KBCnM=\");\n_c = MessagesTab;\nexport default MessagesTab;\nvar _c;\n$RefreshReg$(_c, \"MessagesTab\");","map":{"version":3,"names":["React","useState","useEffect","useRef","apiFetchJson","getAccessToken","MessageIcon","jsxDEV","_jsxDEV","Fragment","_Fragment","SEEN_STORAGE_KEY","THREAD_CACHE_TTL_MS","detectMobileView","_window$screen","window","viewportWidth","innerWidth","document","documentElement","clientWidth","screenWidth","screen","width","effectiveWidth","Math","min","mobileUa","test","navigator","userAgent","hasCoarsePointer","matchMedia","matches","noHover","touchPoints","Number","maxTouchPoints","touchLikeDevice","normalizePreviewImageUrl","value","raw","String","trim","normalizeRuleForKleinanzeigen","parsed","host","hostname","toLowerCase","isProdAdsImage","pathname","startsWith","ruleParam","searchParams","get","malformedRule","validRule","set","URL","href","toMessageImageSrc","accountId","normalized","accountToken","undefined","accessToken","src","separator","includes","encodeURIComponent","params","URLSearchParams","toString","getRawMessagePreviewImage","message","_message$ad","_message$ad2","_message$ad3","candidates","adImage","adImageUrl","adImageURL","imageUrl","image","thumbnailUrl","thumbnail","previewImage","ad","candidate","getMessagePreviewImage","hasMessagePreviewImage","Boolean","isPaymentAndShippingMessage","type","toUpperCase","paymentAndShippingMessageType","formatEuroFromCents","cents","isFinite","toLocaleString","style","currency","pickOfferField","key","direct","actions","Array","isArray","withKey","find","action","getOfferActionText","actionType","fallback","item","ctaText","extractAttachmentUrls","buckets","attachments","images","imageUrls","media","pictures","filter","urls","bucket","push","gatewayUrl","url","getConversationKey","convo","conversationId","conversationUrl","id","convoId","getConversationFingerprint","date","time","text","loadSeenMap","localStorage","getItem","JSON","parse","saveSeenMap","next","setItem","stringify","MessagesTab","_s","_selectedMessage$mess","messages","setMessages","selectedMessage","setSelectedMessage","replyText","setReplyText","replyImages","setReplyImages","sending","setSending","loading","setLoading","loadingThread","setLoadingThread","error","setError","isMobileView","setIsMobileView","translationByMessageId","setTranslationByMessageId","declineConfirmOpen","setDeclineConfirmOpen","decliningOffer","setDecliningOffer","chatScrollRef","fileInputRef","previewHydrationInFlight","Set","messagesRefreshInFlight","translateInFlight","threadCacheRef","Map","clearComposerImages","prev","existing","forEach","previewUrl","revokeObjectURL","getThreadCacheKeyForMessage","readThreadCacheEntry","entry","current","expiresAt","Date","now","delete","writeThreadCacheEntry","payload","adTitle","sender","loadMessages","intervalId","setInterval","visibilityState","silent","clearInterval","container","scrollTo","top","scrollHeight","behavior","handleResize","addEventListener","removeEventListener","hydrateMissingPreviewImages","list","length","slice","has","add","data","map","msg","sameConversation","console","rememberConversationSeen","fingerprint","seen","seenAt","msgKey","unread","opts","timeoutMs","deduped","seenMap","merged","currentFingerprint","err","markAsRead","handleReplyImageSelect","event","_event$target","files","from","target","nextItems","file","random","createObjectURL","removeReplyImage","formatRequestError","fallbackText","_error$data","_error$data2","baseMessage","debugId","requestId","confirmDeclineOffer","alert","result","method","headers","body","serverMessages","lastMessage","nextConversationId","nextConversationUrl","fetchThread","force","status","code","sendReply","textToSend","imagesToSend","optimisticId","getTime","optimisticAttachments","_item$file","_item$file2","name","local","previewText","optimisticMessage","toISOString","toTimeString","direction","pending","form","FormData","append","participant","success","resolvedConversationId","resolvedConversationUrl","hasSameOutgoing","some","m","nextMessages","updated","getTimeAgo","messageDate","isNaN","diffHours","floor","formatMessageDate","parts","d","diffDays","toLocaleDateString","day","month","join","threadMessages","cached","cachedPayload","updatedFromCache","handleKeyDown","e","shiftKey","preventDefault","unreadCount","showConversationList","showChatPanel","selectedRawPreviewImage","selectedPreviewImage","selectedDirectPreviewImage","hasReplyPayload","canSendReply","Spinner","size","color","height","viewBox","animation","children","cx","cy","r","stroke","strokeWidth","fill","strokeDasharray","strokeDashoffset","strokeLinecap","fileName","_jsxFileName","lineNumber","columnNumber","className","display","alignItems","justifyContent","gap","marginBottom","flexWrap","margin","fontWeight","borderRadius","background","border","boxShadow","minHeight","minWidth","overflow","flexDirection","backdropFilter","padding","borderBottom","fontSize","onClick","disabled","cursor","transition","strokeLinejoin","points","marginTop","flex","i","flexShrink","animationDelay","textAlign","opacity","rawPreviewImage","directPreviewImage","borderLeft","alt","objectFit","referrerPolicy","onError","_imageNode$dataset","_imageNode$dataset2","imageNode","currentTarget","directSrc","dataset","fallbackTried","currentSrc","getAttribute","setAttribute","fallbackNode","nextElementSibling","charAt","textOverflow","whiteSpace","maxWidth","accountName","textTransform","letterSpacing","borderTop","position","_imageNode$dataset3","_imageNode$dataset4","x","y","rx","ry","x1","y1","x2","y2","ref","paddingTop","messageItem","idx","isOutgoing","isPending","isOffer","messageKey","translation","hasText","attachmentSrcs","canTranslate","toggleTranslate","shown","translatedText","to","offerTitle","title","offerItemCents","offerShippingCents","offerTotalCents","offerCarrierName","offerOptionName","offerOptionDesc","offerLiabilityCents","acceptCta","declineCta","counterCta","paddingLeft","paddingRight","lineHeight","gridTemplateColumns","imageIdx","maxHeight","wordBreak","left","bottom","accept","multiple","onChange","overflowX","paddingBottom","right","_fileInputRef$current","click","onKeyDown","placeholder","rows","resize","outline","fontFamily","onInput","inset","zIndex","_c","$RefreshReg$"],"sources":["/Users/eurocare/Downloads/barvihaluxury-main/frontend/src/components/MessagesTab.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { apiFetchJson, getAccessToken } from \"../api\";\nimport { MessageIcon } from \"./Icons\";\n\nconst SEEN_STORAGE_KEY = \"kl_messages_seen_v1\";\nconst THREAD_CACHE_TTL_MS = 2 * 60 * 1000;\n\nconst detectMobileView = () => {\n  if (typeof window === \"undefined\") return false;\n  const viewportWidth = window.innerWidth || document.documentElement.clientWidth || 0;\n  const screenWidth = typeof window.screen?.width === \"number\" ? window.screen.width : viewportWidth;\n  const effectiveWidth = Math.min(viewportWidth || screenWidth, screenWidth || viewportWidth);\n  const mobileUa = /Android|webOS|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(\n    (typeof navigator !== \"undefined\" && navigator.userAgent) || \"\"\n  );\n  const hasCoarsePointer = typeof window.matchMedia === \"function\"\n    ? window.matchMedia(\"(pointer: coarse)\").matches\n    : false;\n  const noHover = typeof window.matchMedia === \"function\"\n    ? window.matchMedia(\"(hover: none)\").matches\n    : false;\n  const touchPoints = typeof navigator !== \"undefined\" ? Number(navigator.maxTouchPoints || 0) : 0;\n  const touchLikeDevice = hasCoarsePointer || noHover || touchPoints > 1;\n  return effectiveWidth <= 768 || (touchLikeDevice && effectiveWidth <= 1024) || (mobileUa && effectiveWidth <= 1180);\n};\n\nconst normalizePreviewImageUrl = (value) => {\n  const raw = String(value || \"\").trim();\n  if (!raw) return \"\";\n  if (/^data:/i.test(raw)) return \"\";\n  const normalizeRuleForKleinanzeigen = (parsed) => {\n    const host = String(parsed.hostname || \"\").toLowerCase();\n    const isProdAdsImage = host === \"img.kleinanzeigen.de\"\n      && parsed.pathname.startsWith(\"/api/v1/prod-ads/images/\");\n    if (!isProdAdsImage) return parsed;\n    const ruleParam = String(parsed.searchParams.get(\"rule\") || \"\");\n    const malformedRule = /(imageid|\\$\\{.*\\}|\\$_\\{.*\\})/i.test(ruleParam);\n    const validRule = /^\\$_[a-z0-9_.-]+$/i.test(ruleParam);\n    if (!validRule || malformedRule) {\n      parsed.searchParams.set(\"rule\", \"$_57.JPG\");\n    }\n    return parsed;\n  };\n  if (/^(https?:)?\\/\\//i.test(raw)) {\n    try {\n      const parsed = normalizeRuleForKleinanzeigen(new URL(raw.startsWith(\"//\") ? `https:${raw}` : raw));\n      return parsed.href;\n    } catch {\n      return raw.startsWith(\"//\") ? `https:${raw}` : raw;\n    }\n  }\n  if (/^img\\.kleinanzeigen\\.de/i.test(raw)) return normalizePreviewImageUrl(`https://${raw}`);\n  if (/^\\/api\\/v1\\/prod-ads\\/images\\//i.test(raw)) return normalizePreviewImageUrl(`https://img.kleinanzeigen.de${raw}`);\n  try {\n    const parsed = normalizeRuleForKleinanzeigen(new URL(raw, \"https://www.kleinanzeigen.de\"));\n    return parsed.href;\n  } catch {\n    return \"\";\n  }\n};\n\nconst toMessageImageSrc = (value, accountId) => {\n  const normalized = normalizePreviewImageUrl(value);\n  if (!normalized) return \"\";\n  const accountToken = accountId !== undefined && accountId !== null && String(accountId).trim()\n    ? String(accountId).trim()\n    : \"\";\n  const accessToken = getAccessToken();\n  if (normalized.startsWith(\"/api/messages/image?\")) {\n    let src = normalized;\n    if (accountToken && !/[?&]accountId=/i.test(src)) {\n      const separator = src.includes(\"?\") ? \"&\" : \"?\";\n      src = `${src}${separator}accountId=${encodeURIComponent(accountToken)}`;\n    }\n    if (accessToken && !/[?&](accessToken|token)=/i.test(src)) {\n      const separator = src.includes(\"?\") ? \"&\" : \"?\";\n      src = `${src}${separator}accessToken=${encodeURIComponent(accessToken)}`;\n    }\n    return src;\n  }\n  if (/^https?:\\/\\//i.test(normalized)) {\n    if (!accountToken) return normalized;\n    const params = new URLSearchParams();\n    params.set(\"url\", normalized);\n    params.set(\"accountId\", accountToken);\n    if (accessToken) {\n      params.set(\"accessToken\", accessToken);\n    }\n    return `/api/messages/image?${params.toString()}`;\n  }\n  return normalized;\n};\n\nconst getRawMessagePreviewImage = (message) => {\n  if (!message || typeof message !== \"object\") return \"\";\n  const candidates = [\n    message.adImage,\n    message.adImageUrl,\n    message.adImageURL,\n    message.imageUrl,\n    message.image,\n    message.thumbnailUrl,\n    message.thumbnail,\n    message.previewImage,\n    message.ad?.image,\n    message.ad?.imageUrl,\n    message.ad?.thumbnailUrl\n  ];\n  for (const candidate of candidates) {\n    const normalized = normalizePreviewImageUrl(candidate);\n    if (normalized) return normalized;\n  }\n  return \"\";\n};\n\nconst getMessagePreviewImage = (message) =>\n  toMessageImageSrc(getRawMessagePreviewImage(message), message?.accountId);\n\nconst hasMessagePreviewImage = (message) => Boolean(getRawMessagePreviewImage(message));\n\nconst isPaymentAndShippingMessage = (message) => {\n  if (!message || typeof message !== \"object\") return false;\n  const type = String(message.type || \"\").toUpperCase();\n  return type === \"PAYMENT_AND_SHIPPING_MESSAGE\" || Boolean(message.paymentAndShippingMessageType);\n};\n\nconst formatEuroFromCents = (value) => {\n  const cents = Number(value);\n  if (!Number.isFinite(cents)) return \"\";\n  return (cents / 100).toLocaleString(\"de-DE\", { style: \"currency\", currency: \"EUR\" });\n};\n\nconst pickOfferField = (message, key) => {\n  if (!message || typeof message !== \"object\") return null;\n  const direct = message[key];\n  if (direct !== undefined && direct !== null) return direct;\n  const actions = Array.isArray(message.actions) ? message.actions : [];\n  const withKey = actions.find((action) => action && action[key] !== undefined && action[key] !== null);\n  return withKey ? withKey[key] : null;\n};\n\nconst getOfferActionText = (message, actionType, fallback = \"\") => {\n  const actions = Array.isArray(message?.actions) ? message.actions : [];\n  const action = actions.find((item) => item?.actionType === actionType);\n  return action?.ctaText || fallback;\n};\n\nconst extractAttachmentUrls = (message) => {\n  const buckets = [\n    message?.attachments,\n    message?.images,\n    message?.imageUrls,\n    message?.media,\n    message?.pictures\n  ].filter((value) => Array.isArray(value));\n  const urls = [];\n  for (const bucket of buckets) {\n    for (const item of bucket) {\n      if (!item) continue;\n      if (typeof item === \"string\") {\n        urls.push(item);\n        continue;\n      }\n      if (typeof item === \"object\") {\n        // Kleinanzeigen message attachments often need the gateway URL (auth required),\n        // while the api.kleinanzeigen.de URL can return 401.\n        const candidate = item.gatewayUrl\n          || item.url\n          || item.href\n          || item.src\n          || item.imageUrl\n          || item.thumbnailUrl;\n        if (candidate) urls.push(candidate);\n      }\n    }\n  }\n  return urls.filter(Boolean);\n};\n\nconst getConversationKey = (message) => {\n  if (!message || typeof message !== \"object\") return \"\";\n  const accountId = message.accountId != null ? String(message.accountId) : \"\";\n  const convo = message.conversationId || message.conversationUrl || message.id || \"\";\n  const convoId = convo != null ? String(convo) : \"\";\n  if (!accountId || !convoId) return \"\";\n  return `${accountId}|${convoId}`;\n};\n\nconst getConversationFingerprint = (message) => {\n  if (!message || typeof message !== \"object\") return \"\";\n  const date = String(message.date || \"\").trim();\n  const time = String(message.time || \"\").trim();\n  const text = String(message.message || \"\").trim();\n  return `${date}|${time}|${text}`;\n};\n\nconst loadSeenMap = () => {\n  if (typeof window === \"undefined\" || !window.localStorage) return {};\n  try {\n    const raw = window.localStorage.getItem(SEEN_STORAGE_KEY);\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    return parsed && typeof parsed === \"object\" ? parsed : {};\n  } catch {\n    return {};\n  }\n};\n\nconst saveSeenMap = (next) => {\n  if (typeof window === \"undefined\" || !window.localStorage) return;\n  try {\n    window.localStorage.setItem(SEEN_STORAGE_KEY, JSON.stringify(next || {}));\n  } catch {\n    // ignore quota / serialization issues\n  }\n};\n\nconst MessagesTab = () => {\n  const [messages, setMessages] = useState([]);\n  const [selectedMessage, setSelectedMessage] = useState(null);\n  const [replyText, setReplyText] = useState(\"\");\n  const [replyImages, setReplyImages] = useState([]);\n  const [sending, setSending] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingThread, setLoadingThread] = useState(false);\n  const [error, setError] = useState(null);\n  const [isMobileView, setIsMobileView] = useState(() => detectMobileView());\n  const [translationByMessageId, setTranslationByMessageId] = useState({});\n  const [declineConfirmOpen, setDeclineConfirmOpen] = useState(false);\n  const [decliningOffer, setDecliningOffer] = useState(false);\n  const chatScrollRef = useRef(null);\n  const fileInputRef = useRef(null);\n  const previewHydrationInFlight = useRef(new Set());\n  const messagesRefreshInFlight = useRef(false);\n  const translateInFlight = useRef(new Set());\n  const threadCacheRef = useRef(new Map());\n\n  const clearComposerImages = () => {\n    setReplyImages((prev) => {\n      const existing = Array.isArray(prev) ? prev : [];\n      existing.forEach((item) => {\n        if (item?.previewUrl) {\n          URL.revokeObjectURL(item.previewUrl);\n        }\n      });\n      return [];\n    });\n  };\n\n  const getThreadCacheKeyForMessage = (message) => {\n    if (!message || typeof message !== \"object\") return \"\";\n    const accountId = message.accountId != null ? String(message.accountId) : \"\";\n    const conversationId = message.conversationId != null ? String(message.conversationId) : \"\";\n    const conversationUrl = message.conversationUrl != null ? String(message.conversationUrl) : \"\";\n    if (!accountId) return \"\";\n    if (conversationId) return `${accountId}|cid:${conversationId}`;\n    if (conversationUrl) return `${accountId}|url:${conversationUrl}`;\n    return \"\";\n  };\n\n  const readThreadCacheEntry = (message) => {\n    const key = getThreadCacheKeyForMessage(message);\n    if (!key) return null;\n    const entry = threadCacheRef.current.get(key);\n    if (!entry || typeof entry !== \"object\") return null;\n    if (!entry.expiresAt || entry.expiresAt < Date.now()) {\n      threadCacheRef.current.delete(key);\n      return null;\n    }\n    return entry;\n  };\n\n  const writeThreadCacheEntry = (message, payload) => {\n    const key = getThreadCacheKeyForMessage(message);\n    if (!key || !payload || typeof payload !== \"object\") return;\n    threadCacheRef.current.set(key, {\n      expiresAt: Date.now() + THREAD_CACHE_TTL_MS,\n      payload: {\n        adTitle: payload.adTitle || \"\",\n        adImage: payload.adImage || \"\",\n        sender: payload.sender || \"\",\n        messages: Array.isArray(payload.messages) ? payload.messages : [],\n        conversationId: payload.conversationId || message?.conversationId || \"\",\n        conversationUrl: payload.conversationUrl || message?.conversationUrl || \"\"\n      }\n    });\n  };\n\n  useEffect(() => {\n    loadMessages();\n  }, []);\n\n  useEffect(() => {\n    const intervalId = window.setInterval(() => {\n      // Avoid background polling when the tab is hidden (mobile data / lower load).\n      if (typeof document !== \"undefined\" && document.visibilityState !== \"visible\") return;\n      loadMessages({ silent: true });\n    }, 3 * 60 * 1000);\n\n    return () => window.clearInterval(intervalId);\n  }, []);\n\n  useEffect(() => {\n    if (!selectedMessage) return;\n    const container = chatScrollRef.current;\n    if (!container) return;\n    container.scrollTo({ top: container.scrollHeight, behavior: \"smooth\" });\n  }, [selectedMessage?.id, selectedMessage?.messages]);\n\n  useEffect(() => {\n    // Reset composer state when switching conversations.\n    setReplyText(\"\");\n    clearComposerImages();\n    setDeclineConfirmOpen(false);\n    setDecliningOffer(false);\n  }, [selectedMessage?.id]);\n\n  useEffect(() => {\n    const handleResize = () => {\n      setIsMobileView(detectMobileView());\n    };\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  const hydrateMissingPreviewImages = async (list) => {\n    if (!Array.isArray(list) || !list.length) return;\n\n    const candidates = list\n      .filter((item) => item && !hasMessagePreviewImage(item))\n      .slice(0, 10);\n\n    for (const item of candidates) {\n      const key = String(item.conversationId || item.conversationUrl || item.id || \"\");\n      if (!key || previewHydrationInFlight.current.has(key)) continue;\n      previewHydrationInFlight.current.add(key);\n\n      try {\n        const params = new URLSearchParams();\n        if (item.accountId != null) params.set(\"accountId\", String(item.accountId));\n        if (item.conversationId) params.set(\"conversationId\", String(item.conversationId));\n        if (item.conversationUrl) params.set(\"conversationUrl\", String(item.conversationUrl));\n        if (!item.conversationId && !item.conversationUrl) {\n          if (item.sender) params.set(\"participant\", String(item.sender));\n          if (item.adTitle) params.set(\"adTitle\", String(item.adTitle));\n        }\n        if (!params.get(\"accountId\")) continue;\n\n        const data = await apiFetchJson(`/api/messages/thread?${params.toString()}`);\n        const adImage = normalizePreviewImageUrl(data?.adImage);\n        if (!adImage) continue;\n\n        setMessages((prev) => prev.map((msg) => {\n          const sameConversation = (\n            (item.conversationId && msg.conversationId && String(item.conversationId) === String(msg.conversationId))\n            || (item.conversationUrl && msg.conversationUrl && String(item.conversationUrl) === String(msg.conversationUrl))\n            || String(msg.id) === String(item.id)\n          );\n          if (!sameConversation) return msg;\n          return {\n            ...msg,\n            adImage,\n            adTitle: data?.adTitle || msg.adTitle,\n            conversationId: data?.conversationId || msg.conversationId,\n            conversationUrl: data?.conversationUrl || msg.conversationUrl\n          };\n        }));\n      } catch (error) {\n        console.error(\"Не удалось догрузить превью диалога:\", error);\n      } finally {\n        previewHydrationInFlight.current.delete(key);\n      }\n    }\n  };\n\n  const rememberConversationSeen = (message) => {\n    const key = getConversationKey(message);\n    if (!key) return;\n    const fingerprint = getConversationFingerprint(message);\n    if (!fingerprint) return;\n\n    const seen = loadSeenMap();\n    seen[key] = { fingerprint, seenAt: Date.now() };\n    saveSeenMap(seen);\n\n    // Immediately update UI so the badge doesn't come back on refresh.\n    setMessages((prev) => prev.map((msg) => {\n      const msgKey = getConversationKey(msg);\n      if (!msgKey || msgKey !== key) return msg;\n      return { ...msg, unread: false };\n    }));\n  };\n\n  const loadMessages = async (opts = {}) => {\n    const silent = Boolean(opts && typeof opts === \"object\" && opts.silent);\n    if (messagesRefreshInFlight.current) return;\n    messagesRefreshInFlight.current = true;\n\n    if (!silent) {\n      setLoading(true);\n      setError(null);\n    }\n    try {\n      // Request only a limited number of conversations per account to keep the endpoint fast/stable.\n      const params = new URLSearchParams();\n      params.set(\"limit\", \"30\");\n      const data = await apiFetchJson(`/api/messages?${params.toString()}`, { timeoutMs: 120000 });\n      const list = Array.isArray(data) ? data : [];\n      const seen = new Set();\n      const deduped = [];\n      for (const item of list) {\n        const key = item.conversationId\n          || item.conversationUrl\n          || item.id\n          || `${item.accountId || \"\"}|${item.sender || \"\"}|${item.adTitle || \"\"}|${item.message || \"\"}|${item.time || \"\"}`;\n        if (seen.has(key)) continue;\n        seen.add(key);\n        deduped.push(item);\n      }\n      const seenMap = loadSeenMap();\n      const merged = deduped.map((item) => {\n        const key = getConversationKey(item);\n        if (!key) return item;\n        const entry = seenMap[key];\n        if (!entry || typeof entry !== \"object\") return item;\n        const currentFingerprint = getConversationFingerprint(item);\n        if (entry.fingerprint && entry.fingerprint === currentFingerprint) {\n          return { ...item, unread: false };\n        }\n        return item;\n      });\n\n      setMessages(merged);\n      hydrateMissingPreviewImages(merged);\n    } catch (err) {\n      console.error(\"Ошибка загрузки сообщений:\", err);\n      if (!silent) setError(err.message || \"Не удалось загрузить сообщения\");\n    } finally {\n      if (!silent) setLoading(false);\n      messagesRefreshInFlight.current = false;\n    }\n  };\n\n  // NOTE: Backend does not guarantee a \"mark read\" API (and Kleinanzeigen state may lag).\n  // We persist \"seen\" locally so a refresh won't resurrect the \"new\" badge.\n  const markAsRead = (message) => rememberConversationSeen(message);\n\n  const handleReplyImageSelect = (event) => {\n    const files = Array.from(event?.target?.files || []);\n    if (event?.target) event.target.value = \"\";\n    if (!files.length) return;\n\n    const nextItems = files\n      .filter((file) => String(file?.type || \"\").toLowerCase().startsWith(\"image/\"))\n      .slice(0, 10)\n      .map((file) => ({\n        id: `img-${Date.now()}-${Math.random().toString(16).slice(2)}`,\n        file,\n        previewUrl: URL.createObjectURL(file)\n      }));\n\n    if (!nextItems.length) return;\n    setReplyImages((prev) => {\n      const existing = Array.isArray(prev) ? prev : [];\n      return [...existing, ...nextItems].slice(0, 10);\n    });\n  };\n\n  const removeReplyImage = (id) => {\n    setReplyImages((prev) => {\n      const existing = Array.isArray(prev) ? prev : [];\n      const target = existing.find((item) => item?.id === id);\n      if (target?.previewUrl) {\n        URL.revokeObjectURL(target.previewUrl);\n      }\n      return existing.filter((item) => item?.id !== id);\n    });\n  };\n\n  const formatRequestError = (error, fallbackText) => {\n    const baseMessage = String(error?.message || fallbackText || \"Ошибка запроса\").trim();\n    const debugId = error?.data?.debugId || error?.debugId || \"\";\n    const requestId = error?.data?.requestId || error?.requestId || \"\";\n    if (debugId) {\n      return `${baseMessage} (debugId: ${debugId})`;\n    }\n    if (requestId) {\n      return `${baseMessage} (requestId: ${requestId})`;\n    }\n    return baseMessage;\n  };\n\n  const confirmDeclineOffer = async () => {\n    if (!selectedMessage || decliningOffer) return;\n    if (!selectedMessage.conversationId && !selectedMessage.conversationUrl) {\n      alert(\"Не найден идентификатор диалога.\");\n      return;\n    }\n    setDecliningOffer(true);\n    try {\n      const result = await apiFetchJson(\"/api/messages/offer/decline\", {\n        method: \"POST\",\n        timeoutMs: 240000,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          accountId: selectedMessage.accountId,\n          conversationId: selectedMessage.conversationId,\n          conversationUrl: selectedMessage.conversationUrl\n        })\n      });\n\n      const serverMessages = Array.isArray(result.messages) ? result.messages : [];\n      if (serverMessages.length) {\n        const lastMessage = serverMessages[serverMessages.length - 1];\n        const nextConversationId = result.conversationId || selectedMessage.conversationId;\n        const nextConversationUrl = result.conversationUrl || selectedMessage.conversationUrl;\n        setMessages((prev) => prev.map((msg) => (\n          msg.id === selectedMessage.id\n            ? {\n              ...msg,\n              message: lastMessage?.text || msg.message,\n              date: lastMessage?.date || msg.date,\n              time: lastMessage?.time || msg.time,\n              conversationId: nextConversationId || msg.conversationId,\n              conversationUrl: nextConversationUrl || msg.conversationUrl,\n              unread: false\n            }\n            : msg\n        )));\n        setSelectedMessage((prev) => ({\n          ...prev,\n          messages: serverMessages,\n          conversationId: nextConversationId || prev.conversationId,\n          conversationUrl: nextConversationUrl || prev.conversationUrl\n        }));\n        writeThreadCacheEntry(selectedMessage, {\n          adTitle: selectedMessage.adTitle,\n          adImage: selectedMessage.adImage,\n          sender: selectedMessage.sender,\n          messages: serverMessages,\n          conversationId: nextConversationId,\n          conversationUrl: nextConversationUrl\n        });\n      } else {\n        // Fallback: refresh thread when backend doesn't return messages.\n        fetchThread(selectedMessage, { force: true });\n      }\n      setDeclineConfirmOpen(false);\n    } catch (error) {\n      console.error(\"Ошибка отклонения заявки:\", error, {\n        status: error?.status,\n        code: error?.code,\n        data: error?.data || null\n      });\n      alert(formatRequestError(error, \"Не удалось отклонить заявку\"));\n    } finally {\n      setDecliningOffer(false);\n    }\n  };\n\n  const sendReply = async () => {\n    if (!selectedMessage) return;\n    if (!selectedMessage.conversationId && !selectedMessage.conversationUrl\n      && !selectedMessage.sender && !selectedMessage.adTitle) {\n      alert(\"Не найден идентификатор диалога.\");\n      return;\n    }\n\n    const textToSend = replyText.trim();\n    const imagesToSend = Array.isArray(replyImages) ? replyImages : [];\n    if (imagesToSend.length && !selectedMessage.conversationId && !selectedMessage.conversationUrl) {\n      alert(\"Для отправки фото нужен conversationId диалога. Откройте диалог и попробуйте снова.\");\n      return;\n    }\n    if (!textToSend && imagesToSend.length === 0) return;\n    const now = new Date();\n    const optimisticId = `local-${now.getTime()}-${Math.random().toString(16).slice(2)}`;\n    const optimisticAttachments = imagesToSend.map((item) => ({\n      url: item?.previewUrl || \"\",\n      name: item?.file?.name || \"\",\n      type: item?.file?.type || \"\",\n      local: true\n    })).filter((item) => item?.url);\n    const previewText = textToSend || (optimisticAttachments.length ? \"Фото\" : \"\");\n    const optimisticMessage = {\n      id: optimisticId,\n      text: textToSend,\n      date: now.toISOString().slice(0, 10),\n      time: now.toTimeString().slice(0, 5),\n      direction: \"outgoing\",\n      sender: \"Вы\",\n      pending: true,\n      ...(optimisticAttachments.length ? { attachments: optimisticAttachments } : {})\n    };\n\n    // Optimistic UI: show message immediately in the thread and conversation list.\n    setReplyText(\"\");\n    setReplyImages([]);\n    setSelectedMessage((prev) => {\n      if (!prev) return prev;\n      const existing = Array.isArray(prev.messages) && prev.messages.length\n        ? prev.messages\n        : prev.message\n          ? [{\n            id: prev.id,\n            text: prev.message,\n            sender: prev.sender,\n            date: prev.date,\n            time: prev.time,\n            direction: \"incoming\"\n          }]\n          : [];\n      return {\n        ...prev,\n        messages: [...existing, optimisticMessage]\n      };\n    });\n    setMessages((prev) => prev.map((msg) => (\n      msg.id === selectedMessage.id\n        ? {\n          ...msg,\n          message: previewText,\n          date: optimisticMessage.date,\n          time: optimisticMessage.time,\n          unread: false\n        }\n        : msg\n    )));\n\n    setSending(true);\n    try {\n      const result = optimisticAttachments.length\n        ? await (() => {\n          const form = new FormData();\n          form.append(\"accountId\", String(selectedMessage.accountId));\n          if (selectedMessage.conversationId) form.append(\"conversationId\", String(selectedMessage.conversationId));\n          if (selectedMessage.conversationUrl) form.append(\"conversationUrl\", String(selectedMessage.conversationUrl));\n          if (textToSend) form.append(\"text\", textToSend);\n          imagesToSend.forEach((item) => {\n            if (!item?.file) return;\n            form.append(\"images\", item.file, item.file.name || \"image.jpg\");\n          });\n          return apiFetchJson(\"/api/messages/send-media\", {\n            method: \"POST\",\n            timeoutMs: 240000,\n            body: form\n          });\n        })()\n        : await apiFetchJson(\"/api/messages/send\", {\n          method: \"POST\",\n          timeoutMs: 180000,\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            accountId: selectedMessage.accountId,\n            conversationId: selectedMessage.conversationId,\n            conversationUrl: selectedMessage.conversationUrl,\n            participant: selectedMessage.sender,\n            adTitle: selectedMessage.adTitle,\n            text: textToSend\n          })\n        });\n      if (result.success) {\n        const resolvedConversationId = result.conversationId || selectedMessage.conversationId;\n        const resolvedConversationUrl = result.conversationUrl || selectedMessage.conversationUrl;\n        const serverMessages = Array.isArray(result.messages) ? result.messages : [];\n        const hasSameOutgoing = optimisticAttachments.length\n          ? serverMessages.some((m) => (\n            String(m?.direction || \"\").toLowerCase() === \"outgoing\"\n            && (\n              (Array.isArray(m?.attachments) && m.attachments.length > 0)\n              || (textToSend && String(m?.text || \"\") === textToSend)\n            )\n          ))\n          : serverMessages.some((m) => (\n            String(m?.direction || \"\").toLowerCase() === \"outgoing\"\n            && String(m?.text || \"\") === textToSend\n          ));\n        const nextMessages = serverMessages.length\n          ? (hasSameOutgoing ? serverMessages : [...serverMessages, { ...optimisticMessage, pending: false }])\n          : null;\n\n        if (nextMessages) {\n          const lastMessage = nextMessages[nextMessages.length - 1];\n          setMessages((prev) => prev.map((msg) => (\n            msg.id === selectedMessage.id\n              ? {\n                ...msg,\n                message: lastMessage?.text || msg.message,\n                date: lastMessage?.date || msg.date,\n                time: lastMessage?.time || msg.time,\n                conversationId: resolvedConversationId || msg.conversationId,\n                conversationUrl: resolvedConversationUrl || msg.conversationUrl\n              }\n              : msg\n          )));\n          setSelectedMessage((prev) => ({\n            ...prev,\n            messages: nextMessages,\n            conversationId: resolvedConversationId,\n            conversationUrl: resolvedConversationUrl\n          }));\n          writeThreadCacheEntry(selectedMessage, {\n            adTitle: selectedMessage.adTitle,\n            adImage: selectedMessage.adImage,\n            sender: selectedMessage.sender,\n            messages: nextMessages,\n            conversationId: resolvedConversationId,\n            conversationUrl: resolvedConversationUrl\n          });\n        } else {\n          // Backend may respond without thread messages. Keep optimistic entry and mark it as sent.\n          setSelectedMessage((prev) => {\n            if (!prev) return prev;\n            const updated = Array.isArray(prev.messages) ? prev.messages : [];\n            return {\n              ...prev,\n              messages: updated.map((m) => (m?.id === optimisticId ? { ...m, pending: false } : m)),\n              conversationId: resolvedConversationId,\n              conversationUrl: resolvedConversationUrl\n            };\n          });\n          setMessages((prev) => prev.map((msg) => (\n            msg.id === selectedMessage.id\n              ? {\n                ...msg,\n                conversationId: resolvedConversationId || msg.conversationId,\n                conversationUrl: resolvedConversationUrl || msg.conversationUrl\n              }\n              : msg\n          )));\n        }\n      } else {\n        // Revert optimistic update on logical failure.\n        setSelectedMessage((prev) => {\n          if (!prev) return prev;\n          const updated = Array.isArray(prev.messages) ? prev.messages : [];\n          return { ...prev, messages: updated.filter((m) => m?.id !== optimisticId) };\n        });\n        setReplyText(textToSend);\n        setReplyImages(imagesToSend);\n        const debugId = result?.debugId ? ` (debugId: ${result.debugId})` : \"\";\n        alert(\"Ошибка: \" + (result.error || \"Не удалось отправить\") + debugId);\n      }\n    } catch (err) {\n      console.error(\"Ошибка отправки:\", err, {\n        status: err?.status,\n        code: err?.code,\n        data: err?.data || null\n      });\n      setSelectedMessage((prev) => {\n        if (!prev) return prev;\n        const updated = Array.isArray(prev.messages) ? prev.messages : [];\n        return { ...prev, messages: updated.filter((m) => m?.id !== optimisticId) };\n      });\n      setReplyText(textToSend);\n      setReplyImages(imagesToSend);\n      alert(formatRequestError(err, \"Ошибка при отправке сообщения\"));\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const getTimeAgo = (date, time) => {\n    if (!date && !time) return \"\";\n    const now = new Date();\n    try {\n      const messageDate = new Date(date + \"T\" + (time || \"00:00\"));\n      if (isNaN(messageDate.getTime())) return time || date || \"\";\n      const diffHours = Math.floor((now - messageDate) / (1000 * 60 * 60));\n      if (diffHours < 1) return time || \"Только что\";\n      if (diffHours < 24) return time;\n      if (diffHours < 48) return \"Вчера\";\n      return date;\n    } catch {\n      return time || date || \"\";\n    }\n  };\n\n  const formatMessageDate = (date, time) => {\n    if (!date && !time) return \"\";\n    const parts = [];\n    if (date) {\n      try {\n        const d = new Date(date + \"T00:00\");\n        if (!isNaN(d.getTime())) {\n          const now = new Date();\n          const diffDays = Math.floor((now - d) / (1000 * 60 * 60 * 24));\n          if (diffDays === 0) parts.push(\"Сегодня\");\n          else if (diffDays === 1) parts.push(\"Вчера\");\n          else parts.push(d.toLocaleDateString(\"ru-RU\", { day: \"numeric\", month: \"short\" }));\n        } else {\n          parts.push(date);\n        }\n      } catch {\n        parts.push(date);\n      }\n    }\n    if (time) parts.push(time);\n    return parts.join(\", \");\n  };\n\n  const threadMessages = selectedMessage?.messages?.length\n    ? selectedMessage.messages\n    : selectedMessage\n      ? [{\n        id: selectedMessage.id,\n        text: selectedMessage.message,\n        sender: selectedMessage.sender,\n        date: selectedMessage.date,\n        time: selectedMessage.time,\n        direction: \"incoming\"\n      }]\n      : [];\n\n  const fetchThread = async (message, { force = false } = {}) => {\n    const cached = !force ? readThreadCacheEntry(message) : null;\n    if (cached?.payload) {\n      const cachedPayload = cached.payload;\n      const updatedFromCache = {\n        ...message,\n        adTitle: cachedPayload.adTitle || message.adTitle,\n        adImage: cachedPayload.adImage || message.adImage,\n        sender: message.sender || cachedPayload.sender || \"\",\n        messages: Array.isArray(cachedPayload.messages) ? cachedPayload.messages : [],\n        conversationId: cachedPayload.conversationId || message.conversationId,\n        conversationUrl: cachedPayload.conversationUrl || message.conversationUrl\n      };\n      setMessages((prev) => prev.map((msg) => (\n        String(msg.id) === String(message.id)\n          ? {\n            ...msg,\n            adTitle: updatedFromCache.adTitle,\n            adImage: updatedFromCache.adImage,\n            conversationId: updatedFromCache.conversationId,\n            conversationUrl: updatedFromCache.conversationUrl\n          }\n          : msg\n      )));\n      setSelectedMessage(updatedFromCache);\n      return;\n    }\n\n    setLoadingThread(true);\n    try {\n      const params = new URLSearchParams();\n      params.set(\"accountId\", message.accountId);\n      if (message.conversationId) params.set(\"conversationId\", message.conversationId);\n      if (message.conversationUrl) params.set(\"conversationUrl\", message.conversationUrl);\n      if (!message.conversationId && !message.conversationUrl) {\n        if (message.sender) params.set(\"participant\", message.sender);\n        if (message.adTitle) params.set(\"adTitle\", message.adTitle);\n      }\n      const data = await apiFetchJson(`/api/messages/thread?${params.toString()}`);\n      if (data.success) {\n        const adImage = normalizePreviewImageUrl(data.adImage || message.adImage);\n        const updated = {\n          ...message,\n          adTitle: data.adTitle || message.adTitle,\n          adImage,\n          sender: message.sender || data.participant || \"\",\n          messages: data.messages || [],\n          conversationId: data.conversationId || message.conversationId,\n          conversationUrl: data.conversationUrl || message.conversationUrl\n        };\n        setMessages((prev) => prev.map((msg) => (\n          String(msg.id) === String(message.id)\n            ? {\n              ...msg,\n              adTitle: updated.adTitle,\n              adImage: updated.adImage,\n              conversationId: updated.conversationId,\n              conversationUrl: updated.conversationUrl\n            }\n            : msg\n        )));\n        setSelectedMessage(updated);\n        writeThreadCacheEntry(updated, updated);\n      }\n    } catch (err) {\n      console.error(\"Ошибка загрузки диалога:\", err);\n    } finally {\n      setLoadingThread(false);\n    }\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      sendReply();\n    }\n  };\n\n  const unreadCount = messages.filter(m => m.unread).length;\n  const showConversationList = !isMobileView || !selectedMessage;\n  const showChatPanel = !isMobileView || Boolean(selectedMessage);\n  const selectedRawPreviewImage = selectedMessage ? getRawMessagePreviewImage(selectedMessage) : \"\";\n  const selectedPreviewImage = selectedMessage\n    ? toMessageImageSrc(selectedRawPreviewImage, selectedMessage?.accountId)\n    : \"\";\n  const selectedDirectPreviewImage = normalizePreviewImageUrl(selectedRawPreviewImage);\n  const hasReplyPayload = Boolean(replyText.trim()) || replyImages.length > 0;\n  const canSendReply = !sending && hasReplyPayload;\n\n  // Spinner SVG for loading states\n  const Spinner = ({ size = 20, color = \"#7dd3fc\" }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" style={{ animation: \"spin 1s linear infinite\" }}>\n      <circle cx=\"12\" cy=\"12\" r=\"10\" stroke={color} strokeWidth=\"3\" fill=\"none\" strokeDasharray=\"31.4\" strokeDashoffset=\"10\" strokeLinecap=\"round\" />\n    </svg>\n  );\n\n  return (\n    <>\n      <style>{`\n        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }\n        .msg-conv-item:hover { background: rgba(59,130,246,0.12) !important; }\n        .msg-send-btn:hover:not(:disabled) { background: #16a34a !important; }\n        .msg-refresh-btn:hover:not(:disabled) { background: #0284c7 !important; transform: scale(1.02); }\n        .msg-refresh-btn:active:not(:disabled) { transform: scale(0.98); }\n        .msg-translate-btn:hover { opacity: 1 !important; transform: translateY(-1px) scale(1.02) !important; }\n        .msg-translate-btn:active { transform: translateY(0px) scale(0.98) !important; }\n      `}</style>\n\n      <div className=\"section-header\" style={{\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"space-between\",\n        gap: \"12px\",\n        marginBottom: \"20px\",\n        flexWrap: \"wrap\"\n      }}>\n        <h2 style={{\n          margin: 0,\n          color: \"#f8fafc\",\n          display: \"flex\",\n          alignItems: \"center\",\n          gap: \"14px\",\n          fontWeight: 700\n        }}>\n          <span style={{\n            width: \"42px\",\n            height: \"42px\",\n            borderRadius: \"14px\",\n            background: \"linear-gradient(135deg, rgba(249, 115, 22, 0.25), rgba(194, 65, 12, 0.2))\",\n            border: \"1px solid rgba(251, 146, 60, 0.4)\",\n            boxShadow: \"0 4px 15px rgba(251, 146, 60, 0.28)\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\"\n          }}>\n            <MessageIcon size={22} color=\"#fdba74\" />\n          </span>\n          Сообщения\n        </h2>\n      </div>\n\n      <div className=\"messages-layout\" style={{ display: \"flex\", gap: \"20px\", height: \"calc(100vh - 220px)\", minHeight: \"500px\" }}>\n        {/* Conversation List */}\n        <div className=\"messages-list\" style={{\n          width: \"400px\",\n          minWidth: \"340px\",\n          background: \"linear-gradient(145deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.95) 100%)\",\n          borderRadius: \"20px\",\n          overflow: \"hidden\",\n          boxShadow: \"0 20px 50px rgba(0,0,0,0.4), 0 0 30px rgba(0,0,0,0.2)\",\n          border: \"1px solid rgba(148,163,184,0.12)\",\n          color: \"#e2e8f0\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          backdropFilter: \"blur(10px)\",\n          ...(showConversationList ? {} : { display: \"none\" })\n        }}>\n          {/* Header */}\n          <div style={{\n            padding: \"16px 20px\",\n            borderBottom: \"1px solid rgba(148,163,184,0.15)\",\n            background: \"rgba(15,23,42,0.5)\"\n          }}>\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"12px\" }}>\n              <h3 style={{ margin: 0, fontSize: \"18px\", fontWeight: 700 }}>Диалоги</h3>\n              {unreadCount > 0 && (\n                <span style={{\n                  padding: \"5px 14px\",\n                  background: \"linear-gradient(135deg, #10b981, #059669)\",\n                  color: \"white\",\n                  borderRadius: \"9999px\",\n                  fontSize: \"12px\",\n                  fontWeight: 600,\n                  boxShadow: \"0 0 12px rgba(16, 185, 129, 0.4)\",\n                  border: \"1px solid rgba(16, 185, 129, 0.3)\"\n                }}>\n                  {unreadCount} {unreadCount === 1 ? \"новое\" : \"новых\"}\n                </span>\n              )}\n            </div>\n            <button\n              className=\"msg-refresh-btn\"\n              onClick={loadMessages}\n              disabled={loading}\n              style={{\n                width: \"100%\",\n                padding: \"10px 16px\",\n                background: loading ? \"rgba(14,165,233,0.3)\" : \"linear-gradient(135deg, #0ea5e9, #0284c7)\",\n                color: \"white\",\n                border: \"none\",\n                borderRadius: \"10px\",\n                fontSize: \"13px\",\n                fontWeight: 600,\n                cursor: loading ? \"not-allowed\" : \"pointer\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                gap: \"8px\",\n                transition: \"all 0.15s ease\"\n              }}\n            >\n              {loading ? (\n                <>\n                  <Spinner size={16} color=\"#fff\" />\n                  Загрузка сообщений...\n                </>\n              ) : (\n                <>\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                    <polyline points=\"23 4 23 10 17 10\" />\n                    <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\" />\n                  </svg>\n                  Обновить сообщения\n                </>\n              )}\n            </button>\n          </div>\n\n          {/* Error state */}\n          {error && (\n            <div style={{\n              margin: \"12px\",\n              padding: \"12px 16px\",\n              background: \"rgba(239,68,68,0.15)\",\n              border: \"1px solid rgba(239,68,68,0.3)\",\n              borderRadius: \"10px\",\n              fontSize: \"13px\",\n              color: \"#fca5a5\"\n            }}>\n              <div style={{ fontWeight: 600, marginBottom: \"4px\" }}>Ошибка загрузки</div>\n              <div>{error}</div>\n              <button\n                onClick={loadMessages}\n                style={{\n                  marginTop: \"8px\",\n                  padding: \"4px 12px\",\n                  background: \"rgba(239,68,68,0.3)\",\n                  color: \"#fca5a5\",\n                  border: \"1px solid rgba(239,68,68,0.4)\",\n                  borderRadius: \"6px\",\n                  fontSize: \"12px\",\n                  cursor: \"pointer\"\n                }}\n              >\n                Попробовать снова\n              </button>\n            </div>\n          )}\n\n          {/* Conversation list */}\n          <div style={{ flex: 1, overflow: \"auto\" }}>\n            {loading && messages.length === 0 ? (\n              // Loading skeleton\n              <div style={{ padding: \"8px 0\" }}>\n                {[1, 2, 3, 4, 5].map(i => (\n                  <div key={i} style={{\n                    padding: \"14px 20px\",\n                    display: \"flex\",\n                    gap: \"12px\",\n                    alignItems: \"center\",\n                    borderBottom: \"1px solid rgba(148,163,184,0.08)\"\n                  }}>\n                    <div style={{\n                      width: \"52px\",\n                      height: \"52px\",\n                      borderRadius: \"12px\",\n                      background: \"rgba(148,163,184,0.1)\",\n                      flexShrink: 0,\n                      animation: \"pulse 1.5s ease-in-out infinite\"\n                    }} />\n                    <div style={{ flex: 1 }}>\n                      <div style={{\n                        height: \"14px\",\n                        width: \"60%\",\n                        background: \"rgba(148,163,184,0.1)\",\n                        borderRadius: \"4px\",\n                        marginBottom: \"8px\",\n                        animation: \"pulse 1.5s ease-in-out infinite\"\n                      }} />\n                      <div style={{\n                        height: \"12px\",\n                        width: \"80%\",\n                        background: \"rgba(148,163,184,0.08)\",\n                        borderRadius: \"4px\",\n                        marginBottom: \"6px\",\n                        animation: \"pulse 1.5s ease-in-out infinite\",\n                        animationDelay: \"0.1s\"\n                      }} />\n                      <div style={{\n                        height: \"10px\",\n                        width: \"40%\",\n                        background: \"rgba(148,163,184,0.06)\",\n                        borderRadius: \"4px\",\n                        animation: \"pulse 1.5s ease-in-out infinite\",\n                        animationDelay: \"0.2s\"\n                      }} />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : messages.length === 0 && !loading ? (\n              <div style={{\n                padding: \"60px 20px\",\n                textAlign: \"center\",\n                color: \"#64748b\"\n              }}>\n                <div style={{ fontSize: \"40px\", marginBottom: \"12px\", opacity: 0.5 }}>\n                  <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" style={{ margin: \"0 auto\", display: \"block\", color: \"#475569\" }}>\n                    <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\n                  </svg>\n                </div>\n                <div style={{ fontSize: \"15px\", fontWeight: 600, marginBottom: \"4px\" }}>Нет сообщений</div>\n                <div style={{ fontSize: \"13px\" }}>Нажмите \"Обновить\" для загрузки</div>\n              </div>\n            ) : (\n              messages.map((message) => {\n                const rawPreviewImage = getRawMessagePreviewImage(message);\n                const previewImage = toMessageImageSrc(rawPreviewImage, message?.accountId);\n                const directPreviewImage = normalizePreviewImageUrl(rawPreviewImage);\n                return (\n                <div\n                  key={message.id}\n                  className=\"msg-conv-item\"\n                  onClick={() => {\n                    markAsRead(message);\n                    setSelectedMessage(message);\n                    fetchThread(message);\n                  }}\n                  style={{\n                    padding: \"14px 20px\",\n                    borderBottom: \"1px solid rgba(148,163,184,0.08)\",\n                    cursor: \"pointer\",\n                    background: selectedMessage?.id === message.id\n                      ? \"rgba(59,130,246,0.15)\"\n                      : message.unread\n                        ? \"rgba(34,197,94,0.08)\"\n                        : \"transparent\",\n                    borderLeft: selectedMessage?.id === message.id\n                      ? \"3px solid #3b82f6\"\n                      : message.unread\n                        ? \"3px solid #22c55e\"\n                        : \"3px solid transparent\",\n                    display: \"flex\",\n                    alignItems: \"flex-start\",\n                    gap: \"12px\",\n                    transition: \"background 0.15s ease\",\n                    animation: \"fadeIn 0.2s ease\"\n                  }}\n                >\n                  {/* Product image / avatar */}\n                  <div style={{\n                    width: \"52px\",\n                    height: \"52px\",\n                    borderRadius: \"50%\",\n                    overflow: \"hidden\",\n                    background: \"rgba(15,23,42,0.6)\",\n                    border: \"1px solid rgba(148,163,184,0.15)\",\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    flexShrink: 0\n                  }}>\n                    {previewImage ? (\n                      <img\n                        src={previewImage}\n                        data-direct-src={directPreviewImage || \"\"}\n                        data-fallback-tried=\"0\"\n                        alt=\"\"\n                        style={{ width: \"100%\", height: \"100%\", objectFit: \"cover\" }}\n                        loading=\"lazy\"\n                        referrerPolicy=\"no-referrer\"\n                        onError={(e) => {\n                          const imageNode = e.currentTarget;\n                          const directSrc = String(imageNode.dataset?.directSrc || \"\").trim();\n                          const fallbackTried = imageNode.dataset?.fallbackTried === \"1\";\n                          const currentSrc = String(imageNode.getAttribute(\"src\") || \"\").trim();\n                          if (!fallbackTried && directSrc && directSrc !== currentSrc) {\n                            imageNode.dataset.fallbackTried = \"1\";\n                            imageNode.setAttribute(\"src\", directSrc);\n                            return;\n                          }\n                          imageNode.style.display = \"none\";\n                          const fallbackNode = imageNode.nextElementSibling;\n                          if (fallbackNode) fallbackNode.style.display = \"flex\";\n                        }}\n                      />\n                    ) : null}\n                    <div style={{\n                      width: \"100%\",\n                      height: \"100%\",\n                      background: message.unread\n                        ? \"linear-gradient(135deg, #22c55e, #16a34a)\"\n                        : \"linear-gradient(135deg, #3b82f6, #2563eb)\",\n                      color: \"white\",\n                      display: previewImage ? \"none\" : \"flex\",\n                      alignItems: \"center\",\n                      justifyContent: \"center\",\n                      fontSize: \"20px\",\n                      fontWeight: 700\n                    }}>\n                      {(message.sender || \"?\").charAt(0).toUpperCase()}\n                    </div>\n                  </div>\n\n                  {/* Content */}\n                  <div style={{ flex: 1, minWidth: 0 }}>\n                    {/* Top row: sender + time */}\n                    <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"3px\" }}>\n                      <span style={{\n                        fontWeight: 700,\n                        fontSize: \"14px\",\n                        color: \"#f1f5f9\",\n                        overflow: \"hidden\",\n                        textOverflow: \"ellipsis\",\n                        whiteSpace: \"nowrap\",\n                        maxWidth: \"65%\"\n                      }}>\n                        {message.sender || \"Неизвестный\"}\n                      </span>\n                      <span style={{\n                        fontSize: \"11px\",\n                        color: \"#64748b\",\n                        whiteSpace: \"nowrap\",\n                        flexShrink: 0\n                      }}>\n                        {getTimeAgo(message.date, message.time)}\n                      </span>\n                    </div>\n\n                    {/* Ad title */}\n                    <div style={{\n                      fontSize: \"13px\",\n                      color: \"#94a3b8\",\n                      fontWeight: 600,\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\",\n                      whiteSpace: \"nowrap\",\n                      marginBottom: \"3px\"\n                    }}>\n                      {message.adTitle || \"Без названия\"}\n                    </div>\n\n                    {/* Last message preview */}\n                    <div style={{\n                      fontSize: \"12px\",\n                      color: \"#64748b\",\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\",\n                      whiteSpace: \"nowrap\",\n                      marginBottom: \"4px\"\n                    }}>\n                      {message.message || \"\"}\n                    </div>\n\n                    {/* Account label + unread badge */}\n                    <div style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: \"6px\"\n                    }}>\n                      <span style={{\n                        fontSize: \"11px\",\n                        color: \"#475569\",\n                        background: \"rgba(148,163,184,0.1)\",\n                        padding: \"1px 6px\",\n                        borderRadius: \"4px\"\n                      }}>\n                        {message.accountName}\n                      </span>\n                      {message.unread && (\n                        <span style={{\n                          padding: \"3px 10px\",\n                          background: \"linear-gradient(135deg, #8b5cf6, #7c3aed)\",\n                          color: \"white\",\n                          borderRadius: \"9999px\",\n                          fontSize: \"10px\",\n                          fontWeight: 700,\n                          textTransform: \"uppercase\",\n                          letterSpacing: \"0.5px\",\n                          boxShadow: \"0 0 10px rgba(139, 92, 246, 0.4)\",\n                          border: \"1px solid rgba(139, 92, 246, 0.3)\"\n                        }}>\n                          new\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                );\n              })\n            )}\n          </div>\n\n          {/* Message count footer */}\n          {messages.length > 0 && (\n            <div style={{\n              padding: \"8px 20px\",\n              borderTop: \"1px solid rgba(148,163,184,0.1)\",\n              fontSize: \"11px\",\n              color: \"#475569\",\n              textAlign: \"center\",\n              background: \"rgba(15,23,42,0.3)\"\n            }}>\n              {messages.length} {messages.length === 1 ? \"диалог\" : messages.length < 5 ? \"диалога\" : \"диалогов\"}\n            </div>\n          )}\n        </div>\n\n        {/* Chat Panel */}\n        <div className=\"messages-chat\" style={{\n          flex: 1,\n          position: \"relative\",\n          background: \"linear-gradient(145deg, rgba(30, 41, 59, 0.6) 0%, rgba(15, 23, 42, 0.95) 100%)\",\n          borderRadius: \"20px\",\n          overflow: \"hidden\",\n          boxShadow: \"0 20px 50px rgba(0,0,0,0.4), 0 0 30px rgba(0,0,0,0.2)\",\n          border: \"1px solid rgba(148,163,184,0.12)\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          color: \"#e2e8f0\",\n          backdropFilter: \"blur(10px)\",\n          ...(showChatPanel ? {} : { display: \"none\" })\n        }}>\n          {selectedMessage ? (\n            <>\n              {/* Chat header */}\n              <div style={{\n                padding: \"14px 20px\",\n                borderBottom: \"1px solid rgba(148,163,184,0.15)\",\n                background: \"rgba(15,23,42,0.6)\"\n              }}>\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n                  <div style={{ display: \"flex\", gap: \"14px\", alignItems: \"center\", flex: 1, minWidth: 0 }}>\n                    {/* Product image in header */}\n                    <div style={{\n                      width: \"50px\",\n                      height: \"50px\",\n                      borderRadius: \"10px\",\n                      overflow: \"hidden\",\n                      border: \"1px solid rgba(148,163,184,0.15)\",\n                      background: \"rgba(15,23,42,0.8)\",\n                      flexShrink: 0,\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      justifyContent: \"center\"\n                    }}>\n                      {selectedPreviewImage ? (\n                        <img\n                          src={selectedPreviewImage}\n                          data-direct-src={selectedDirectPreviewImage || \"\"}\n                          data-fallback-tried=\"0\"\n                          alt=\"\"\n                          style={{ width: \"100%\", height: \"100%\", objectFit: \"cover\" }}\n                          onError={(e) => {\n                            const imageNode = e.currentTarget;\n                            const directSrc = String(imageNode.dataset?.directSrc || \"\").trim();\n                            const fallbackTried = imageNode.dataset?.fallbackTried === \"1\";\n                            const currentSrc = String(imageNode.getAttribute(\"src\") || \"\").trim();\n                            if (!fallbackTried && directSrc && directSrc !== currentSrc) {\n                              imageNode.dataset.fallbackTried = \"1\";\n                              imageNode.setAttribute(\"src\", directSrc);\n                              return;\n                            }\n                            imageNode.style.display = \"none\";\n                          }}\n                        />\n                      ) : (\n                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#475569\" strokeWidth=\"1.5\">\n                          <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\" />\n                          <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\" />\n                          <polyline points=\"21 15 16 10 5 21\" />\n                        </svg>\n                      )}\n                    </div>\n\n                    <div style={{ minWidth: 0 }}>\n                      <div style={{\n                        fontWeight: 700,\n                        fontSize: \"15px\",\n                        color: \"#f1f5f9\",\n                        overflow: \"hidden\",\n                        textOverflow: \"ellipsis\",\n                        whiteSpace: \"nowrap\"\n                      }}>\n                        {selectedMessage.sender || \"Неизвестный\"}\n                      </div>\n                      <div style={{\n                        fontSize: \"13px\",\n                        color: \"#94a3b8\",\n                        fontWeight: 500,\n                        overflow: \"hidden\",\n                        textOverflow: \"ellipsis\",\n                        whiteSpace: \"nowrap\",\n                        marginTop: \"2px\"\n                      }}>\n                        {selectedMessage.adTitle || \"Без названия\"}\n                      </div>\n                      <div style={{\n                        fontSize: \"11px\",\n                        color: \"#475569\",\n                        marginTop: \"2px\"\n                      }}>\n                        {selectedMessage.accountName}\n                      </div>\n                    </div>\n                  </div>\n\n                  <button\n                    onClick={() => setSelectedMessage(null)}\n                    style={{\n                      background: \"rgba(148,163,184,0.1)\",\n                      border: \"none\",\n                      width: isMobileView ? \"auto\" : \"32px\",\n                      height: \"32px\",\n                      padding: isMobileView ? \"0 10px\" : 0,\n                      borderRadius: \"8px\",\n                      cursor: \"pointer\",\n                      color: \"#94a3b8\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      justifyContent: \"center\",\n                      fontSize: \"16px\",\n                      fontWeight: 600,\n                      flexShrink: 0\n                    }}\n                  >\n                    {isMobileView ? (\n                      \"← Назад\"\n                    ) : (\n                      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\">\n                        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\n                        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\n                      </svg>\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              {/* Messages area */}\n              <div ref={chatScrollRef} style={{\n                flex: 1,\n                padding: \"20px\",\n                overflow: \"auto\",\n                background: \"rgba(8,12,24,0.4)\"\n              }}>\n                {loadingThread ? (\n                  <div style={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    height: \"100%\",\n                    gap: \"12px\",\n                    color: \"#64748b\"\n                  }}>\n                    <Spinner size={32} color=\"#3b82f6\" />\n                    <span style={{ fontSize: \"14px\" }}>Загрузка диалога...</span>\n                  </div>\n                ) : threadMessages.length === 0 ? (\n                  <div style={{ color: \"#64748b\", textAlign: \"center\", paddingTop: \"40px\" }}>\n                    <div style={{ fontSize: \"14px\" }}>Нет сообщений в этом диалоге</div>\n                  </div>\n                ) : (\n                  <>\n\t                    {threadMessages.map((messageItem, idx) => {\n\t                      const isOutgoing = messageItem.direction === \"outgoing\";\n\t                      const isPending = Boolean(messageItem.pending);\n\t                      const isOffer = isPaymentAndShippingMessage(messageItem);\n\t                      const messageKey = String(messageItem.id || `idx-${idx}`);\n\t                      const translation = translationByMessageId[messageKey] || null;\n\t                      const hasText = Boolean(String(messageItem.text || \"\").trim());\n\t                      const attachmentSrcs = extractAttachmentUrls(messageItem)\n\t                        .map((url) => toMessageImageSrc(url, selectedMessage?.accountId))\n\t                        .filter(Boolean);\n\t                      const canTranslate = !isOffer && !isOutgoing && hasText;\n\n\t                      const toggleTranslate = async () => {\n\t                        if (!canTranslate) return;\n\n                        // Toggle off when already shown.\n                        if (translation?.shown && translation?.translatedText) {\n                          setTranslationByMessageId((prev) => ({\n                            ...prev,\n                            [messageKey]: { ...prev[messageKey], shown: false }\n                          }));\n                          return;\n                        }\n\n                        // Toggle on when already fetched.\n                        if (translation?.translatedText && !translation?.loading) {\n                          setTranslationByMessageId((prev) => ({\n                            ...prev,\n                            [messageKey]: { ...prev[messageKey], shown: true, error: \"\" }\n                          }));\n                          return;\n                        }\n\n                        if (translateInFlight.current.has(messageKey)) return;\n                        translateInFlight.current.add(messageKey);\n                        setTranslationByMessageId((prev) => ({\n                          ...prev,\n                          [messageKey]: {\n                            ...prev[messageKey],\n                            loading: true,\n                            shown: true,\n                            error: \"\"\n                          }\n                        }));\n\n                        try {\n                          const result = await apiFetchJson(\"/api/translate\", {\n                            method: \"POST\",\n                            headers: { \"Content-Type\": \"application/json\" },\n                            body: JSON.stringify({\n                              text: String(messageItem.text || \"\"),\n                              to: \"ru\",\n                              accountId: selectedMessage?.accountId\n                            })\n                          });\n                          setTranslationByMessageId((prev) => ({\n                            ...prev,\n                            [messageKey]: {\n                              loading: false,\n                              shown: true,\n                              error: \"\",\n                              translatedText: result?.translatedText || \"\"\n                            }\n                          }));\n                        } catch (error) {\n                          console.error(\"Ошибка перевода:\", error);\n                          setTranslationByMessageId((prev) => ({\n                            ...prev,\n                            [messageKey]: {\n                              loading: false,\n                              shown: true,\n                              translatedText: \"\",\n                              error: error?.message || \"Не удалось перевести\"\n                            }\n                          }));\n                        } finally {\n                          translateInFlight.current.delete(messageKey);\n                        }\n\t                      };\n\t                      const offerTitle = String(messageItem?.title || \"Anfrage erhalten\").trim() || \"Anfrage erhalten\";\n\t                      const offerItemCents = pickOfferField(messageItem, \"itemPriceInEuroCent\");\n\t                      const offerShippingCents = pickOfferField(messageItem, \"shippingCostInEuroCent\");\n\t                      const offerTotalCents = pickOfferField(messageItem, \"sellerTotalInEuroCent\");\n\t                      const offerCarrierName = pickOfferField(messageItem, \"carrierName\");\n\t                      const offerOptionName = pickOfferField(messageItem, \"shippingOptionName\");\n\t                      const offerOptionDesc = pickOfferField(messageItem, \"shippingOptionDescription\");\n\t                      const offerLiabilityCents = pickOfferField(messageItem, \"liabilityLimitInEuroCent\");\n\n\t                      const acceptCta = getOfferActionText(\n\t                        messageItem,\n\t                        \"ACCEPT_BUYER_OFFER_LEARN_MORE_ACTION\",\n\t                        \"Anfrage akzeptieren\"\n\t                      );\n\t                      const declineCta = getOfferActionText(\n\t                        messageItem,\n\t                        \"CANCEL_OFFER_ACTION\",\n\t                        \"Anfrage ablehnen\"\n\t                      );\n\t                      const counterCta = getOfferActionText(\n\t                        messageItem,\n\t                        \"MAKE_COUNTER_OFFER_ACTION\",\n\t                        \"Gegenangebot machen\"\n\t                      );\n\t                      return (\n\t                        <div\n\t                          key={messageItem.id || idx}\n\t                          style={{\n                            marginBottom: \"12px\",\n                            display: \"flex\",\n                            justifyContent: isOutgoing ? \"flex-end\" : \"flex-start\",\n                            animation: \"fadeIn 0.2s ease\"\n                          }}\n\t                        >\n\t                          <div style={{\n\t                            maxWidth: isOffer ? \"520px\" : \"70%\",\n\t                            minWidth: isOffer ? \"240px\" : \"120px\"\n\t                          }}>\n\t                            {/* Sender name */}\n\t                            <div style={{\n\t                              fontSize: \"11px\",\n\t                              color: isOutgoing ? \"#86efac\" : \"#7dd3fc\",\n                              fontWeight: 600,\n                              marginBottom: \"4px\",\n                              paddingLeft: isOutgoing ? \"0\" : \"12px\",\n                              paddingRight: isOutgoing ? \"12px\" : \"0\",\n                              textAlign: isOutgoing ? \"right\" : \"left\"\n                            }}>\n\t                              {messageItem.sender || (isOutgoing ? \"Вы\" : selectedMessage.sender || \"\")}\n\t                            </div>\n\n\t                            {isOffer ? (\n\t                              <div style={{\n\t                                borderRadius: \"18px\",\n\t                                padding: \"14px 14px 12px 14px\",\n\t                                background: \"linear-gradient(145deg, rgba(2,6,23,0.55) 0%, rgba(15,23,42,0.95) 58%, rgba(6,78,59,0.22) 100%)\",\n\t                                border: \"1px solid rgba(34,197,94,0.22)\",\n\t                                boxShadow: \"0 18px 40px rgba(0,0,0,0.45)\"\n\t                              }}>\n\t                                <div style={{\n\t                                  display: \"flex\",\n\t                                  justifyContent: \"space-between\",\n\t                                  alignItems: \"flex-start\",\n\t                                  gap: \"12px\",\n\t                                  marginBottom: \"12px\"\n\t                                }}>\n\t                                  <div style={{ display: \"flex\", gap: \"10px\", alignItems: \"center\", minWidth: 0 }}>\n\t                                    <div style={{\n\t                                      width: \"36px\",\n\t                                      height: \"36px\",\n\t                                      borderRadius: \"12px\",\n\t                                      background: \"rgba(34,197,94,0.18)\",\n\t                                      border: \"1px solid rgba(34,197,94,0.25)\",\n\t                                      display: \"flex\",\n\t                                      alignItems: \"center\",\n\t                                      justifyContent: \"center\",\n\t                                      flexShrink: 0\n\t                                    }}>\n\t                                      <span style={{ color: \"#4ade80\", fontWeight: 900, fontSize: \"16px\" }}>€</span>\n\t                                    </div>\n\t                                    <div style={{ minWidth: 0 }}>\n\t                                      <div style={{\n\t                                        fontSize: \"14px\",\n\t                                        fontWeight: 800,\n\t                                        color: \"#bbf7d0\",\n\t                                        overflow: \"hidden\",\n\t                                        textOverflow: \"ellipsis\",\n\t                                        whiteSpace: \"nowrap\"\n\t                                      }}>\n\t                                        {offerTitle}\n\t                                      </div>\n\t                                      <div style={{\n\t                                        fontSize: \"12px\",\n\t                                        color: \"rgba(148,163,184,0.9)\",\n\t                                        marginTop: \"1px\"\n\t                                      }}>\n\t                                        Sicher bezahlen\n\t                                      </div>\n\t                                    </div>\n\t                                  </div>\n\t                                  <div style={{\n\t                                    fontSize: \"20px\",\n\t                                    fontWeight: 900,\n\t                                    color: \"#4ade80\",\n\t                                    whiteSpace: \"nowrap\"\n\t                                  }}>\n\t                                    {formatEuroFromCents(offerTotalCents)}\n\t                                  </div>\n\t                                </div>\n\n\t                                <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"8px\" }}>\n\t                                  <div style={{ display: \"flex\", justifyContent: \"space-between\", color: \"rgba(226,232,240,0.92)\", fontSize: \"13px\" }}>\n\t                                    <span style={{ color: \"rgba(148,163,184,0.95)\" }}>Betrag</span>\n\t                                    <span style={{ fontWeight: 700 }}>{formatEuroFromCents(offerItemCents)}</span>\n\t                                  </div>\n\t                                  <div style={{ display: \"flex\", justifyContent: \"space-between\", color: \"rgba(226,232,240,0.92)\", fontSize: \"13px\" }}>\n\t                                    <span style={{ color: \"rgba(148,163,184,0.95)\" }}>Versand</span>\n\t                                    <span style={{ fontWeight: 700 }}>{formatEuroFromCents(offerShippingCents)}</span>\n\t                                  </div>\n\t                                  <div style={{\n\t                                    display: \"flex\",\n\t                                    justifyContent: \"space-between\",\n\t                                    fontSize: \"13px\",\n\t                                    paddingTop: \"6px\",\n\t                                    borderTop: \"1px solid rgba(148,163,184,0.12)\"\n\t                                  }}>\n\t                                    <span style={{ color: \"rgba(148,163,184,0.95)\", fontWeight: 800 }}>Gesamt</span>\n\t                                    <span style={{ fontWeight: 900, color: \"#e2e8f0\" }}>{formatEuroFromCents(offerTotalCents)}</span>\n\t                                  </div>\n\t                                </div>\n\n\t                                {(offerCarrierName || offerOptionName || offerOptionDesc) ? (\n\t                                  <div style={{\n\t                                    marginTop: \"12px\",\n\t                                    padding: \"12px\",\n\t                                    borderRadius: \"14px\",\n\t                                    background: \"rgba(2,6,23,0.25)\",\n\t                                    border: \"1px solid rgba(148,163,184,0.14)\"\n\t                                  }}>\n\t                                    <div style={{ fontSize: \"13px\", fontWeight: 800, color: \"#e2e8f0\" }}>\n\t                                      Inkl. {offerCarrierName || \"Versand\"} {offerOptionName || \"\"}\n\t                                    </div>\n\t                                    {offerOptionDesc ? (\n\t                                      <div style={{ marginTop: \"4px\", fontSize: \"12px\", color: \"rgba(148,163,184,0.95)\" }}>\n\t                                        {offerOptionDesc}\n\t                                      </div>\n\t                                    ) : null}\n\t                                    {offerLiabilityCents ? (\n\t                                      <div style={{ marginTop: \"6px\", fontSize: \"12px\", color: \"rgba(148,163,184,0.95)\" }}>\n\t                                        Mit Sendungsverfolgung und Haftung bis {formatEuroFromCents(offerLiabilityCents)}\n\t                                      </div>\n\t                                    ) : null}\n\t                                  </div>\n\t                                ) : null}\n\n\t                                {hasText ? (\n\t                                  <div style={{\n\t                                    marginTop: \"12px\",\n\t                                    fontSize: \"13px\",\n\t                                    lineHeight: \"1.5\",\n\t                                    color: \"rgba(226,232,240,0.92)\"\n\t                                  }}>\n\t                                    {messageItem.text}\n\t                                  </div>\n\t                                ) : null}\n\n\t                                <div style={{ marginTop: \"12px\", display: \"flex\", flexDirection: \"column\", gap: \"10px\" }}>\n\t                                  <button\n\t                                    type=\"button\"\n\t                                    disabled\n\t                                    style={{\n\t                                      width: \"100%\",\n\t                                      padding: \"10px 14px\",\n\t                                      borderRadius: \"9999px\",\n\t                                      border: \"1px solid rgba(34,197,94,0.32)\",\n\t                                      background: \"linear-gradient(135deg, rgba(34,197,94,0.55), rgba(22,163,74,0.45))\",\n\t                                      color: \"rgba(255,255,255,0.95)\",\n\t                                      fontWeight: 900,\n\t                                      cursor: \"not-allowed\",\n\t                                      opacity: 0.75\n\t                                    }}\n\t                                    title=\"Скоро\"\n\t                                  >\n\t                                    {acceptCta}\n\t                                  </button>\n\t                                  <div style={{ display: \"flex\", gap: \"10px\" }}>\n\t                                    <button\n\t                                      type=\"button\"\n\t                                      onClick={() => setDeclineConfirmOpen(true)}\n\t                                      disabled={decliningOffer}\n\t                                      style={{\n\t                                        flex: 1,\n\t                                        padding: \"10px 14px\",\n\t                                        borderRadius: \"9999px\",\n\t                                        border: \"1px solid rgba(148,163,184,0.28)\",\n\t                                        background: \"rgba(2,6,23,0.35)\",\n\t                                        color: \"rgba(226,232,240,0.95)\",\n\t                                        fontWeight: 800,\n\t                                        cursor: decliningOffer ? \"not-allowed\" : \"pointer\",\n\t                                        opacity: decliningOffer ? 0.7 : 1\n\t                                      }}\n\t                                    >\n\t                                      {declineCta}\n\t                                    </button>\n\t                                    <button\n\t                                      type=\"button\"\n\t                                      disabled\n\t                                      style={{\n\t                                        flex: 1,\n\t                                        padding: \"10px 14px\",\n\t                                        borderRadius: \"9999px\",\n\t                                        border: \"1px solid rgba(148,163,184,0.22)\",\n\t                                        background: \"rgba(2,6,23,0.25)\",\n\t                                        color: \"rgba(148,163,184,0.95)\",\n\t                                        fontWeight: 800,\n\t                                        cursor: \"not-allowed\",\n\t                                        opacity: 0.75\n\t                                      }}\n\t                                      title=\"Скоро\"\n\t                                    >\n\t                                      {counterCta}\n\t                                    </button>\n\t                                  </div>\n\t                                </div>\n\n\t                                <div style={{\n\t                                  fontSize: \"10px\",\n\t                                  color: \"rgba(148,163,184,0.8)\",\n\t                                  marginTop: \"10px\",\n\t                                  textAlign: \"right\"\n\t                                }}>\n\t                                  {isPending ? \"Отправка...\" : formatMessageDate(\n\t                                    messageItem.date || selectedMessage.date,\n\t                                    messageItem.time || selectedMessage.time\n\t                                  )}\n\t                                </div>\n\t                              </div>\n\t                            ) : (\n\t                              <div style={{\n\t                                position: \"relative\",\n\t                                padding: canTranslate ? \"10px 14px 18px 14px\" : \"10px 14px\",\n\t                                borderRadius: isOutgoing ? \"14px 14px 4px 14px\" : \"14px 14px 14px 4px\",\n\t                                background: isOutgoing\n\t                                  ? \"linear-gradient(135deg, #1a4731, #14532d)\"\n\t                                  : \"rgba(15,23,42,0.8)\",\n\t                                border: isOutgoing\n\t                                  ? \"1px solid rgba(34,197,94,0.25)\"\n\t                                  : \"1px solid rgba(148,163,184,0.15)\"\n\t                              }}>\n\t                                {attachmentSrcs.length > 0 && (\n\t                                  <div style={{\n\t                                    display: \"grid\",\n\t                                    gridTemplateColumns: \"repeat(auto-fit, minmax(120px, 1fr))\",\n\t                                    gap: \"8px\",\n\t                                    marginBottom: hasText ? \"8px\" : \"0\"\n\t                                  }}>\n\t                                    {attachmentSrcs.map((src, imageIdx) => (\n\t                                      <img\n\t                                        key={`${messageKey}-img-${imageIdx}`}\n\t                                        src={src}\n\t                                        alt=\"\"\n\t                                        loading=\"lazy\"\n\t                                        referrerPolicy=\"no-referrer\"\n\t                                        style={{\n\t                                          width: \"100%\",\n\t                                          maxHeight: \"220px\",\n\t                                          objectFit: \"cover\",\n\t                                          borderRadius: \"12px\",\n\t                                          border: \"1px solid rgba(148,163,184,0.14)\"\n\t                                        }}\n\t                                      />\n\t                                    ))}\n\t                                  </div>\n\t                                )}\n\n\t                                {hasText ? (\n\t                                  <div style={{\n\t                                    fontSize: \"14px\",\n\t                                    lineHeight: \"1.5\",\n\t                                    whiteSpace: \"pre-wrap\",\n\t                                    wordBreak: \"break-word\",\n\t                                    color: \"#e2e8f0\"\n\t                                  }}>\n\t                                    {messageItem.text}\n\t                                  </div>\n\t                                ) : null}\n\n\t                                {/* Translate button */}\n\t                                {canTranslate && (\n\t                                  <button\n\t                                    type=\"button\"\n\t                                    className=\"msg-translate-btn\"\n\t                                    onClick={toggleTranslate}\n\t                                    title=\"Перевести на русский\"\n\t                                    style={{\n\t                                      position: \"absolute\",\n\t                                      left: \"8px\",\n\t                                      bottom: \"6px\",\n\t                                      width: \"22px\",\n\t                                      height: \"22px\",\n\t                                      borderRadius: \"8px\",\n\t                                      border: \"1px solid rgba(148,163,184,0.18)\",\n\t                                      background: \"rgba(2,6,23,0.25)\",\n\t                                      color: \"#94a3b8\",\n\t                                      display: \"inline-flex\",\n\t                                      alignItems: \"center\",\n\t                                      justifyContent: \"center\",\n\t                                      cursor: \"pointer\",\n\t                                      opacity: 0.75,\n\t                                      transition: \"transform 0.12s ease, opacity 0.12s ease, background 0.12s ease\"\n\t                                    }}\n\t                                  >\n\t                                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n\t                                      <path d=\"M5 5h6\" />\n\t                                      <path d=\"M8 5c0 6-3 10-6 12\" />\n\t                                      <path d=\"M7 13c2 2 4 4 7 6\" />\n\t                                      <path d=\"M14 19h7\" />\n\t                                      <path d=\"M17 4l4 15\" />\n\t                                      <path d=\"M20 19l-3-9-3 9\" />\n\t                                    </svg>\n\t                                  </button>\n\t                                )}\n\n\t                                {/* Translation result */}\n\t                                {translation?.shown && (\n\t                                  <div style={{\n\t                                    marginTop: \"10px\",\n\t                                    paddingTop: \"8px\",\n\t                                    borderTop: \"1px dashed rgba(148,163,184,0.18)\",\n\t                                    fontSize: \"13px\",\n\t                                    lineHeight: \"1.45\",\n\t                                    color: translation?.error ? \"#fb7185\" : \"#cbd5e1\",\n\t                                    opacity: 0.95\n\t                                  }}>\n\t                                    {translation?.loading ? (\n\t                                      <span style={{ color: \"#94a3b8\" }}>Перевод...</span>\n\t                                    ) : translation?.error ? (\n\t                                      <span>{translation.error}</span>\n\t                                    ) : (\n\t                                      <span>{translation.translatedText}</span>\n\t                                    )}\n\t                                  </div>\n\t                                )}\n\n\t                                {/* Timestamp */}\n\t                                <div style={{\n\t                                  fontSize: \"10px\",\n\t                                  color: \"#64748b\",\n\t                                  marginTop: \"6px\",\n\t                                  textAlign: \"right\"\n\t                                }}>\n\t                                  {isPending ? \"Отправка...\" : formatMessageDate(\n\t                                    messageItem.date || selectedMessage.date,\n\t                                    messageItem.time || selectedMessage.time\n\t                                  )}\n\t                                </div>\n\t                              </div>\n\t                            )}\n\t                          </div>\n\t                        </div>\n\t                      );\n\t                    })}\n                  </>\n                )}\n              </div>\n\n              {/* Reply input */}\n              <div style={{\n                padding: \"14px 20px\",\n                borderTop: \"1px solid rgba(148,163,184,0.15)\",\n                background: \"rgba(15,23,42,0.6)\"\n              }}>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  onChange={handleReplyImageSelect}\n                  style={{ display: \"none\" }}\n                />\n\n                {replyImages.length > 0 && (\n                  <div style={{\n                    marginBottom: \"10px\",\n                    display: \"flex\",\n                    gap: \"8px\",\n                    overflowX: \"auto\",\n                    paddingBottom: \"2px\"\n                  }}>\n                    {replyImages.map((item) => (\n                      <div\n                        key={item.id}\n                        style={{\n                          position: \"relative\",\n                          width: \"72px\",\n                          height: \"72px\",\n                          borderRadius: \"10px\",\n                          border: \"1px solid rgba(148,163,184,0.2)\",\n                          overflow: \"hidden\",\n                          flexShrink: 0\n                        }}\n                      >\n                        <img\n                          src={item.previewUrl}\n                          alt=\"\"\n                          style={{ width: \"100%\", height: \"100%\", objectFit: \"cover\" }}\n                        />\n                        <button\n                          type=\"button\"\n                          onClick={() => removeReplyImage(item.id)}\n                          style={{\n                            position: \"absolute\",\n                            top: \"4px\",\n                            right: \"4px\",\n                            width: \"20px\",\n                            height: \"20px\",\n                            borderRadius: \"9999px\",\n                            border: \"none\",\n                            background: \"rgba(2,6,23,0.72)\",\n                            color: \"#f8fafc\",\n                            fontSize: \"12px\",\n                            cursor: \"pointer\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                            justifyContent: \"center\"\n                          }}\n                          title=\"Удалить\"\n                        >\n                          ×\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                <div style={{ display: \"flex\", gap: \"10px\", alignItems: \"flex-end\" }}>\n                  <button\n                    type=\"button\"\n                    onClick={() => fileInputRef.current?.click()}\n                    disabled={sending}\n                    aria-label=\"Bilder hochladen\"\n                    style={{\n                      width: \"42px\",\n                      height: \"42px\",\n                      borderRadius: \"12px\",\n                      border: \"1px solid rgba(148,163,184,0.25)\",\n                      background: \"rgba(15,23,42,0.7)\",\n                      color: \"#cbd5e1\",\n                      cursor: sending ? \"not-allowed\" : \"pointer\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      justifyContent: \"center\",\n                      flexShrink: 0\n                    }}\n                  >\n                    <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" fill=\"currentColor\" aria-hidden=\"true\">\n                      <path d=\"M12.0004 8.54376C9.72753 8.54376 7.88501 10.4042 7.88501 12.6991C7.88501 14.994 9.72753 16.8544 12.0004 16.8544C14.2733 16.8544 16.1158 14.994 16.1158 12.6991C16.1158 10.4042 14.2733 8.54376 12.0004 8.54376ZM9.88501 12.6991C9.88501 11.5195 10.8321 10.5632 12.0004 10.5632C13.1687 10.5632 14.1158 11.5195 14.1158 12.6991C14.1158 13.8787 13.1687 14.835 12.0004 14.835C10.8321 14.835 9.88501 13.8787 9.88501 12.6991Z\" />\n                      <path d=\"M9.23077 4C8.91601 4 8.61962 4.14963 8.43077 4.40388L6.65385 6.79612H4.38462C3.75218 6.79612 3.14564 7.04979 2.69844 7.50134C2.25124 7.95288 2 8.5653 2 9.20388V17.5922C2 18.2308 2.25124 18.8432 2.69844 19.2948C3.14564 19.7463 3.75218 20 4.38462 20H19.6154C20.2478 20 20.8544 19.7463 21.3016 19.2948C21.7488 18.8432 22 18.2308 22 17.5922V9.20388C22 8.5653 21.7488 7.95288 21.3016 7.50134C20.8544 7.04979 20.2478 6.79612 19.6154 6.79612H17.3462L15.5692 4.40388C15.3804 4.14963 15.084 4 14.7692 4H9.23077ZM7.95385 8.41165L9.73077 6.01942H14.2692L16.0462 8.41165C16.235 8.6659 16.5314 8.81553 16.8462 8.81553H19.6154C19.7179 8.81553 19.8163 8.85665 19.8888 8.9292C19.9614 9.00175 20.0025 9.10014 20.0025 9.20263V17.5909C20.0025 17.6934 19.9614 17.7918 19.8888 17.8644C19.8163 17.9369 19.7179 17.978 19.6154 17.978H4.38462C4.28208 17.978 4.1837 17.9369 4.11115 17.8644C4.0386 17.7918 3.99748 17.6934 3.99748 17.5909V9.20263C3.99748 9.10014 4.0386 9.00175 4.11115 8.9292C4.1837 8.85665 4.28208 8.81553 4.38462 8.81553H7.15385C7.4686 8.81553 7.765 8.6659 7.95385 8.41165Z\" />\n                    </svg>\n                  </button>\n\n                  <textarea\n                    value={replyText}\n                    onChange={(e) => setReplyText(e.target.value)}\n                    onKeyDown={handleKeyDown}\n                    placeholder=\"Nachricht schreiben...\"\n                    rows={1}\n                    style={{\n                      flex: 1,\n                      padding: \"10px 14px\",\n                      border: \"1px solid rgba(148,163,184,0.2)\",\n                      borderRadius: \"12px\",\n                      resize: \"none\",\n                      minHeight: \"42px\",\n                      maxHeight: \"120px\",\n                      background: \"rgba(15,23,42,0.6)\",\n                      color: \"#e2e8f0\",\n                      fontSize: \"14px\",\n                      lineHeight: \"1.4\",\n                      outline: \"none\",\n                      fontFamily: \"inherit\"\n                    }}\n                    onInput={(e) => {\n                      e.target.style.height = \"42px\";\n                      e.target.style.height = Math.min(e.target.scrollHeight, 120) + \"px\";\n                    }}\n                  />\n\n                  <button\n                    className=\"msg-send-btn\"\n                    onClick={sendReply}\n                    disabled={!canSendReply}\n                    style={{\n                      padding: \"10px 20px\",\n                      background: sending\n                        ? \"rgba(34,197,94,0.4)\"\n                        : !hasReplyPayload\n                          ? \"rgba(148,163,184,0.15)\"\n                          : \"linear-gradient(135deg, #22c55e, #16a34a)\",\n                      color: !hasReplyPayload ? \"#64748b\" : \"white\",\n                      border: \"none\",\n                      borderRadius: \"12px\",\n                      cursor: !canSendReply ? \"not-allowed\" : \"pointer\",\n                      whiteSpace: \"nowrap\",\n                      fontSize: \"14px\",\n                      fontWeight: 600,\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: \"6px\",\n                      height: \"42px\",\n                      transition: \"all 0.15s ease\"\n                    }}\n                  >\n                    {sending ? (\n                      <>\n                        <Spinner size={14} color=\"#fff\" />\n                        <span>Отправка</span>\n                      </>\n                    ) : (\n                      <>\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                          <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\" />\n                          <polygon points=\"22 2 15 22 11 13 2 9 22 2\" />\n                        </svg>\n                        <span>Отправить</span>\n                      </>\n                    )}\n                  </button>\n                </div>\n                <div style={{ fontSize: \"11px\", color: \"#475569\", marginTop: \"6px\" }}>\n                  Enter для отправки, Shift+Enter для новой строки\n                </div>\n              </div>\n\n              {declineConfirmOpen && (\n                <div style={{\n                  position: \"absolute\",\n                  inset: 0,\n                  background: \"rgba(2,6,23,0.65)\",\n                  backdropFilter: \"blur(2px)\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  zIndex: 40,\n                  padding: \"16px\"\n                }}>\n                  <div style={{\n                    width: \"100%\",\n                    maxWidth: \"420px\",\n                    borderRadius: \"16px\",\n                    border: \"1px solid rgba(148,163,184,0.2)\",\n                    background: \"linear-gradient(145deg, rgba(15,23,42,0.96), rgba(2,6,23,0.98))\",\n                    boxShadow: \"0 18px 60px rgba(0,0,0,0.5)\",\n                    padding: \"18px\"\n                  }}>\n                    <div style={{ fontSize: \"16px\", fontWeight: 700, color: \"#f8fafc\", marginBottom: \"8px\" }}>\n                      Anfrage ablehnen\n                    </div>\n                    <div style={{ fontSize: \"13px\", lineHeight: \"1.5\", color: \"#94a3b8\", marginBottom: \"16px\" }}>\n                      Möchtest du diese Anfrage wirklich ablehnen?\n                    </div>\n                    <div style={{ display: \"flex\", gap: \"10px\", justifyContent: \"flex-end\" }}>\n                      <button\n                        type=\"button\"\n                        onClick={() => setDeclineConfirmOpen(false)}\n                        disabled={decliningOffer}\n                        style={{\n                          padding: \"10px 14px\",\n                          borderRadius: \"10px\",\n                          border: \"1px solid rgba(148,163,184,0.22)\",\n                          background: \"rgba(15,23,42,0.65)\",\n                          color: \"#cbd5e1\",\n                          cursor: decliningOffer ? \"not-allowed\" : \"pointer\"\n                        }}\n                      >\n                        Abbrechen\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={confirmDeclineOffer}\n                        disabled={decliningOffer}\n                        style={{\n                          padding: \"10px 14px\",\n                          borderRadius: \"10px\",\n                          border: \"1px solid rgba(239,68,68,0.35)\",\n                          background: \"linear-gradient(135deg, rgba(239,68,68,0.78), rgba(185,28,28,0.82))\",\n                          color: \"#fff\",\n                          fontWeight: 700,\n                          cursor: decliningOffer ? \"not-allowed\" : \"pointer\",\n                          display: \"inline-flex\",\n                          alignItems: \"center\",\n                          gap: \"6px\",\n                          minWidth: \"158px\",\n                          justifyContent: \"center\"\n                        }}\n                      >\n                        {decliningOffer ? (\n                          <>\n                            <Spinner size={14} color=\"#fff\" />\n                            <span>Bitte warten</span>\n                          </>\n                        ) : (\n                          \"Anfrage ablehnen\"\n                        )}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </>\n          ) : (\n            // Empty state\n            <div style={{\n              flex: 1,\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              color: \"#475569\"\n            }}>\n              <div style={{ textAlign: \"center\", maxWidth: \"280px\" }}>\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\" style={{ margin: \"0 auto 16px\", display: \"block\", color: \"#334155\" }}>\n                  <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\n                </svg>\n                <h3 style={{ margin: \"0 0 8px\", fontSize: \"16px\", color: \"#64748b\" }}>\n                  Выберите диалог\n                </h3>\n                <p style={{ margin: 0, fontSize: \"13px\", lineHeight: \"1.5\" }}>\n                  Выберите диалог из списка слева для просмотра сообщений и ответа\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default MessagesTab;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}